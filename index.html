<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2018-12-25 Tue 11:49 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>unpackaged.el</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Adam Porter" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="export/styles/darksun/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="export/styles/darksun/css/darksun.css"/>
<link rel="stylesheet" type="text/css" href="export/styles/darksun/css/hideshow.css"/>
<script type="text/javascript" src="export/styles/darksun/js/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="export/styles/darksun/js/jquery-ui-1.10.2.min.js"></script>
<script type="text/javascript" src="export/styles/darksun/js/jquery.localscroll-min.js"></script>
<script type="text/javascript" src="export/styles/darksun/js/jquery.scrollTo-1.4.3.1-min.js"></script>
<script type="text/javascript" src="export/styles/darksun/js/jquery.zclip.min.js"></script>
<script type="text/javascript" src="export/styles/darksun/js/darksun.js"></script>
<script type="text/javascript" src="export/styles/darksun/js/hideshow.js"></script>
<script type="text/javascript" src="export/styles/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">unpackaged.el</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orga174bc8">Faces, fonts&#xa0;&#xa0;&#xa0;<span class="tag"><span class="faces">faces</span>&#xa0;<span class="fonts">fonts</span></span></a>
<ul>
<li><a href="#orgf71c957">font-compare</a></li>
</ul>
</li>
<li><a href="#org6eabbc0">Meta&#xa0;&#xa0;&#xa0;<span class="tag"><span class="meta">meta</span></span></a></li>
<li><a href="#org91b93c7">Misc</a>
<ul>
<li><a href="#org662eca0">Track metadata from MPRIS-supporting media player&#xa0;&#xa0;&#xa0;<span class="tag"><span class="DBus">DBus</span></span></a></li>
</ul>
</li>
<li><a href="#orgdc3f2b3">Org&#xa0;&#xa0;&#xa0;<span class="tag"><span class="Org">Org</span></span></a>
<ul>
<li><a href="#orgd64d395">Agenda previews&#xa0;&#xa0;&#xa0;<span class="tag"><span class="agenda">agenda</span></span></a></li>
<li><a href="#orgf15f0f1">Convert Elisp to Org format&#xa0;&#xa0;&#xa0;<span class="tag"><span class="meta">meta</span></span></a></li>
<li><a href="#orgbcfef64">Download and attach remote files</a></li>
<li><a href="#org4505ec6">Ensure blank lines between headings and before contents</a></li>
<li><a href="#org76599cb">Surround region with emphasis or syntax characters</a></li>
<li><a href="#org88eaa2e">Refile to datetree file using earliest/latest timestamp in entry</a></li>
<li><a href="#orgd4c0eea"><code>org-return-dwim</code></a></li>
<li><a href="#orge00df26">Read-only trees</a></li>
<li><a href="#orgf7e9657">Sort tree by multiple methods at once</a></li>
</ul>
</li>
<li><a href="#orgc4a49cc">Packages&#xa0;&#xa0;&#xa0;<span class="tag"><span class="packages">packages</span></span></a>
<ul>
<li><a href="#org91403d5"><code>package-menu-upgrade-package</code>: Upgrade one package</a></li>
</ul>
</li>
<li><a href="#org0b0fcd2">Programming&#xa0;&#xa0;&#xa0;<span class="tag"><span class="programming">programming</span></span></a>
<ul>
<li><a href="#org9b47f9e"><code>iedit</code>&#xa0;&#xa0;&#xa0;<span class="tag"><span class="iedit">iedit</span>&#xa0;<span class="refactoring">refactoring</span></span></a>
<ul>
<li><a href="#orgab7ada4"><code>iedit-scoped</code></a></li>
<li><a href="#org85c7aed"><code>iedit-or-flyspell</code>&#xa0;&#xa0;&#xa0;<span class="tag"><span class="flyspell">flyspell</span>&#xa0;<span class="spell_checking">spell_checking</span></span></a></li>
</ul>
</li>
<li><a href="#org9106a34">Sort sexps</a></li>
</ul>
</li>
<li><a href="#org31882fd">Regular expressions&#xa0;&#xa0;&#xa0;<span class="tag"><span class="regular_expressions">regular_expressions</span></span></a>
<ul>
<li><a href="#org2c1880a">query-replace-rx</a></li>
</ul>
</li>
<li><a href="#orgd5f02b2">Version control&#xa0;&#xa0;&#xa0;<span class="tag"><span class="version_control">version_control</span></span></a>
<ul>
<li><a href="#org68bac0a">Magit&#xa0;&#xa0;&#xa0;<span class="tag"><span class="Magit">Magit</span></span></a>
<ul>
<li><a href="#org21a9fa9">magit-log date headers</a></li>
</ul>
</li>
<li><a href="#org3a58260"><code>smerge-mode</code></a>
<ul>
<li><a href="#org853404d">Hydra</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org9f2ecb6">Web&#xa0;&#xa0;&#xa0;<span class="tag"><span class="web">web</span></span></a>
<ul>
<li><a href="#org07a2f3d">feed-for-url&#xa0;&#xa0;&#xa0;<span class="tag"><span class="RSS">RSS</span>&#xa0;<span class="Atom">Atom</span>&#xa0;<span class="XML">XML</span></span></a></li>
</ul>
</li>
<li><a href="#org4c795e5">License</a></li>
</ul>
</div>
</div>
<a href=https://alphapapa.github.io/dont-tread-on-emacs/><img src="images/dont-tread-on-emacs-150.png" align="right"></a>

<p>
A collection of useful Emacs Lisp code that isn't substantial enough to be packaged.  This code will be maintained here so that it can be updated and improved over time.
</p>

<p>
This can be viewed directly on the <a href="http://github.com/alphapapa/unpackaged.el">repository</a> or as <a href="http://alphapapa.github.io/unpackaged.el">HTML</a>.
</p>

<p>
Contributions welcome!
</p>

<p>
Functions in this file generally use these helper packages:
</p>

<ul class="org-ul">
<li><a href="https://github.com/magnars/dash.el">dash.el</a> (including <code>dash-functional</code>)</li>
<li><a href="https://github.com/magnars/s.el">s.el</a></li>
<li><a href="https://github.com/jwiegley/use-package">use-package</a></li>
</ul>

<div id="outline-container-orga174bc8" class="outline-2">
<h2 id="orga174bc8">Faces, fonts&#xa0;&#xa0;&#xa0;<span class="tag"><span class="faces">faces</span>&#xa0;<span class="fonts">fonts</span></span></h2>
<div class="outline-text-2" id="text-orga174bc8">
</div><div id="outline-container-orgf71c957" class="outline-3">
<h3 id="orgf71c957">font-compare</h3>
<div class="outline-text-3" id="text-orgf71c957">
<p>
Compare <code>TEXT</code> displayed in <code>FONTS</code>.  <code>FONTS</code> is a list of font specs.
</p>

<p>
Interactively, prompt for <code>TEXT</code>, using <code>lorem-ipsum</code> text if nil or the empty string, and select <code>FONTS</code> with <code>x-select-font</code> (select an already-selected font to end font selection).
</p>

<p>
<b>Requires:</b>
</p>
<ul class="org-ul">
<li><a href="https://github.com/jschaf/emacs-lorem-ipsum">emacs-lorem-ipsum</a></li>
</ul>

<p>

</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">unpackaged/font-compare</span> <span style="color: #c678dd;">(</span><span style="color: #9e4c9e4c9e4c;">text</span> <span style="color: #bbe6ba32c7cd;">fonts</span><span style="color: #c678dd;">)</span>
  <span style="color: #83898d; font-weight: bold; font-style: italic;">"Compare TEXT displayed in FONTS.</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">If TEXT is nil, use `</span><span style="color: #a9a1e1; font-weight: bold; font-style: italic;">lorem-ipsum</span><span style="color: #83898d; font-weight: bold; font-style: italic;">' text.  FONTS is a list of font</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">family strings and/or font specs.</span>

<span style="color: #83898d; font-weight: bold; font-style: italic;">Interactively, prompt for TEXT, using `</span><span style="color: #a9a1e1; font-weight: bold; font-style: italic;">lorem-ipsum</span><span style="color: #83898d; font-weight: bold; font-style: italic;">' if left</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">empty, and select FONTS with `</span><span style="color: #a9a1e1; font-weight: bold; font-style: italic;">x-select-font</span><span style="color: #83898d; font-weight: bold; font-style: italic;">' (select an</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">already-selected font to end font selection)."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span> <span style="color: #98be65;">(</span><span style="color: #e011a3efa386; text-decoration: underline;">list</span> <span style="color: #da8548;">(</span><span style="color: #51afef;">pcase</span> <span style="color: #a9a1e1;">(</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">read</span><span style="text-decoration: underline;">-</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">string</span> <span style="color: #98be65;">"Text: "</span><span style="color: #a9a1e1;">)</span>
                       <span style="color: #a9a1e1;">(</span><span style="color: #98be65;">""</span> <span style="color: #cd7fcd65ce32;">nil</span><span style="color: #a9a1e1;">)</span>
                       <span style="color: #a9a1e1;">(</span><span style="color: #bae2b0b4bde3;">else</span> <span style="color: #bae2b0b4bde3;">else</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span>
                     <span style="color: #da8548;">(</span><span style="color: #51afef;">cl-loop</span> <span style="color: #91edb1e5c7aa;">for</span> <span style="color: #b3609a32bacd;">font</span> = <span style="color: #a9a1e1;">(</span><span style="color: #918b91cd9132; text-decoration: underline;">x</span><span style="text-decoration: underline;">-</span><span style="color: #e011a3efa386; text-decoration: underline;">select</span><span style="text-decoration: underline;">-</span><span style="color: #b3609a32bacd; text-decoration: underline;">font</span><span style="color: #a9a1e1;">)</span>
                              <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #990A1B;">HACK</span><span style="color: #586e75; font-weight: bold; font-style: italic;">: `</span><span style="color: #a9a1e1; font-weight: bold; font-style: italic;">x-select-font</span><span style="color: #586e75; font-weight: bold; font-style: italic;">' calls quit() when the Cancel button is</span>
                              <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">pressed, so to avoid quit()'ing, we signal in-band by selecting a</span>
                              <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">font that has already been selected.</span>
                              <span style="color: #ad9a8c4c7464;">while</span> <span style="color: #a9a1e1;">(</span><span style="color: #cb4b16; font-weight: bold;">not</span> <span style="color: #ECBE7B;">(</span><span style="color: #e011a3efa386; text-decoration: underline;">member</span> <span style="color: #b3609a32bacd;">font</span> <span style="color: #bbe6ba32c7cd;">fonts</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span>
                              <span style="color: #cd7fcd65ce32;">collect</span> <span style="color: #b3609a32bacd;">font</span> <span style="color: #e1b3bbc0bb7e;">into</span> <span style="color: #bbe6ba32c7cd;">fonts</span>
                              <span style="color: #6b65c2f6d999;">finally</span> <span style="color: #cd65b84f9999;">return</span> <span style="color: #bbe6ba32c7cd;">fonts</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #9e4c9e4c9e4c;">text</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">or</span> <span style="color: #9e4c9e4c9e4c;">text</span> <span style="color: #da8548;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">s</span><span style="text-decoration: underline;">-</span><span style="color: #7765a7b4c89a; text-decoration: underline;">word</span><span style="text-decoration: underline;">-</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">wrap</span> <span style="color: #b3609a32bacd;">80</span> <span style="color: #a9a1e1;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">s</span><span style="text-decoration: underline;">-</span><span style="color: #6b65c2f6d999; text-decoration: underline;">join</span> <span style="color: #98be65;">" "</span> <span style="color: #ECBE7B;">(</span><span style="color: #51afef;">progn</span>
                                                    <span style="color: #4db5bd;">(</span><span style="color: #51afef;">require</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">lorem-ipsum</span><span style="color: #4db5bd;">)</span>
                                                    <span style="color: #4db5bd;">(</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">seq</span><span style="text-decoration: underline;">-</span><span style="color: #6b65c2f6d999; text-decoration: underline;">random</span><span style="text-decoration: underline;">-</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">elt</span> <span style="color: #9e4c9e4c9e4c;">lorem</span>-<span style="color: #b3609a32bacd;">ipsum</span>-<span style="color: #9e4c9e4c9e4c;">text</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">with-current-buffer</span> <span style="color: #98be65;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">get</span><span style="text-decoration: underline;">-</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">buffer</span><span style="text-decoration: underline;">-</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">create</span> <span style="color: #98be65;">"*Font Compare*"</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">erase</span><span style="text-decoration: underline;">-</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">buffer</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">--each</span> <span style="color: #bbe6ba32c7cd;">fonts</span>
      <span style="color: #da8548;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #ECBE7B;">(</span><span style="color: #6b65c2f6d999;">family</span> <span style="color: #4db5bd;">(</span><span style="color: #51afef;">cl-typecase</span> <span style="color: #dcaeea;">it</span>
                      <span style="color: #a2b6da;">(</span><span style="color: #b3609a32bacd;">font</span> <span style="color: #9cb6ad;">(</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">symbol</span><span style="text-decoration: underline;">-</span><span style="color: #87cfc690d6c9; text-decoration: underline;">name</span> <span style="color: #51afef;">(</span><span style="color: #b3609a32bacd; text-decoration: underline;">font</span><span style="text-decoration: underline;">-</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">get</span> <span style="color: #dcaeea;">it</span> <span style="color: #c678dd;">:family</span><span style="color: #51afef;">)</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span>
                      <span style="color: #a2b6da;">(</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">string</span> <span style="color: #dcaeea;">it</span><span style="color: #a2b6da;">)</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">insert</span> <span style="color: #6b65c2f6d999;">family</span> <span style="color: #98be65;">": "</span>
                <span style="color: #ECBE7B;">(</span><span style="color: #cd65b84f9999; text-decoration: underline;">propertize</span> <span style="color: #9e4c9e4c9e4c;">text</span>
                            <span style="color: #51afef;">'</span><span style="color: #6b65c2f6d999; font-style: italic;">face</span> <span style="color: #4db5bd;">(</span><span style="color: #e011a3efa386; text-decoration: underline;">list</span> <span style="color: #c678dd;">:family</span> <span style="color: #6b65c2f6d999;">family</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span>
                <span style="color: #98be65;">"\n\n"</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #e011a3efa386; text-decoration: underline;">pop</span><span style="text-decoration: underline;">-</span><span style="color: #bae2b0b4bde3; text-decoration: underline;">to</span><span style="text-decoration: underline;">-</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">buffer</span> <span style="color: #da8548;">(</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">current</span><span style="text-decoration: underline;">-</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">buffer</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6eabbc0" class="outline-2">
<h2 id="org6eabbc0">Meta&#xa0;&#xa0;&#xa0;<span class="tag"><span class="meta">meta</span></span></h2>
<div class="outline-text-2" id="text-org6eabbc0">
<p>
Code used to help maintain this document.  (Note: These links don't work in GitHub's renderer.)
</p>

<ul class="org-ul">
<li></li>
</ul>
</div>
</div>

<div id="outline-container-org91b93c7" class="outline-2">
<h2 id="org91b93c7">Misc</h2>
<div class="outline-text-2" id="text-org91b93c7">
</div><div id="outline-container-org662eca0" class="outline-3">
<h3 id="org662eca0">Track metadata from MPRIS-supporting media player&#xa0;&#xa0;&#xa0;<span class="tag"><span class="DBus">DBus</span></span></h3>
<div class="outline-text-3" id="text-org662eca0">
<p>
Return the artist, album, and title of the track playing in MPRIS-supporting player.  Returns a string in format <code>ARTIST - ~ALBUM~: ~TITLE~ [PLAYER]</code>.  If no track is playing, returns nil.  If more than one player is playing, uses the first one found in DBus.  If <code>PLAYER</code> is non-nil, include the name of the player in the output string.
</p>

<p>
DBus is not a straightforward system to work with, so this may serve as a useful example, or save someone the trouble of figuring out how to get this metadata.
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">cl-defun</span> <span style="color: #c678dd;">unpackaged/mpris-track</span> <span style="color: #c678dd;">(</span><span style="color: #ECBE7B;">&amp;optional</span> <span style="color: #b3609a32bacd;">player</span><span style="color: #c678dd;">)</span>
  <span style="color: #83898d; font-weight: bold; font-style: italic;">"Return the artist, album, and title of the track playing in MPRIS-supporting player.</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">Returns a string in format \"ARTIST - ALBUM: TITLE [PLAYER]\".  If no track is</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">playing, returns nil.  If more than one player is playing, uses</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">the first one found in DBus.</span>

<span style="color: #83898d; font-weight: bold; font-style: italic;">If PLAYER is non-nil, include the name of the player in the</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">output string."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">require</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">dbus</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">when-let*</span> <span style="color: #98be65;">(</span><span style="color: #da8548;">(</span><span style="color: #ad9a8c4c7464;">mpris</span>-<span style="color: #e011a3efa386;">services</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">--select</span> <span style="color: #ECBE7B;">(</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">string</span><span style="text-decoration: underline;">-</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">prefix</span><span style="text-decoration: underline;">-</span><span style="color: #cf7ec31fb119; text-decoration: underline;">p</span> <span style="color: #98be65;">"org.mpris.MediaPlayer2."</span> <span style="color: #dcaeea;">it</span><span style="color: #ECBE7B;">)</span>
                                        <span style="color: #ECBE7B;">(</span><span style="color: #918b91cd9132; text-decoration: underline;">dbus</span><span style="text-decoration: underline;">-</span><span style="color: #e011a3efa386; text-decoration: underline;">list</span><span style="text-decoration: underline;">-</span><span style="color: #bae2b0b4bde3; text-decoration: underline;">known</span><span style="text-decoration: underline;">-</span><span style="color: #e011a3efa386; text-decoration: underline;">names</span> <span style="color: #c678dd;">:session</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span>
              <span style="color: #da8548;">(</span><span style="color: #cf7ec31fb119;">playing</span>-<span style="color: #bae2b0b4bde3;">service</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">--first</span> <span style="color: #ECBE7B;">(</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">string</span><span style="text-decoration: underline;">=</span> <span style="color: #98be65;">"Playing"</span>
                                                 <span style="color: #4db5bd;">(</span><span style="color: #918b91cd9132; text-decoration: underline;">dbus</span><span style="text-decoration: underline;">-</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">get</span><span style="text-decoration: underline;">-</span><span style="color: #87cfc690d6c9; text-decoration: underline;">property</span> <span style="color: #c678dd;">:session</span> <span style="color: #dcaeea;">it</span>
                                                                    <span style="color: #98be65;">"/org/mpris/MediaPlayer2"</span>
                                                                    <span style="color: #98be65;">"org.mpris.MediaPlayer2.Player"</span>
                                                                    <span style="color: #98be65;">"PlaybackStatus"</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span>
                                        <span style="color: #ad9a8c4c7464;">mpris</span>-<span style="color: #e011a3efa386;">services</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span>
              <span style="color: #da8548;">(</span><span style="color: #b3609a32bacd;">player</span>-<span style="color: #87cfc690d6c9;">name</span> <span style="color: #a9a1e1;">(</span><span style="color: #918b91cd9132; text-decoration: underline;">dbus</span><span style="text-decoration: underline;">-</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">get</span><span style="text-decoration: underline;">-</span><span style="color: #87cfc690d6c9; text-decoration: underline;">property</span> <span style="color: #c678dd;">:session</span> <span style="color: #cf7ec31fb119;">playing</span>-<span style="color: #bae2b0b4bde3;">service</span>
                                              <span style="color: #98be65;">"/org/mpris/MediaPlayer2"</span>
                                              <span style="color: #98be65;">"org.mpris.MediaPlayer2"</span>
                                              <span style="color: #98be65;">"Identity"</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span>
              <span style="color: #da8548;">(</span><span style="color: #e011a3efa386;">metadata</span> <span style="color: #a9a1e1;">(</span><span style="color: #918b91cd9132; text-decoration: underline;">dbus</span><span style="text-decoration: underline;">-</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">get</span><span style="text-decoration: underline;">-</span><span style="color: #87cfc690d6c9; text-decoration: underline;">property</span> <span style="color: #c678dd;">:session</span> <span style="color: #cf7ec31fb119;">playing</span>-<span style="color: #bae2b0b4bde3;">service</span>
                                           <span style="color: #98be65;">"/org/mpris/MediaPlayer2"</span>
                                           <span style="color: #98be65;">"org.mpris.MediaPlayer2.Player"</span>
                                           <span style="color: #98be65;">"Metadata"</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">`</span><span style="color: #a9a1e1; font-weight: bold; font-style: italic;">-let</span><span style="color: #586e75; font-weight: bold; font-style: italic;">' makes it easy to get the actual strings out of the nested lists of lists of strings.</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">-let</span> <span style="color: #da8548;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #ECBE7B;">(</span><span style="color: #ECBE7B;">&amp;alist</span> <span style="color: #98be65;">"xesam:artist"</span> <span style="color: #4db5bd;">(</span><span style="color: #a2b6da;">(</span><span style="color: #91edb1e5c7aa;">artists</span><span style="color: #a2b6da;">)</span><span style="color: #4db5bd;">)</span>
                    <span style="color: #98be65;">"xesam:album"</span> <span style="color: #4db5bd;">(</span><span style="color: #a2b6da;">(</span><span style="color: #918b91cd9132;">album</span><span style="color: #a2b6da;">)</span><span style="color: #4db5bd;">)</span>
                    <span style="color: #98be65;">"xesam:title"</span> <span style="color: #4db5bd;">(</span><span style="color: #a2b6da;">(</span><span style="color: #ad489b408e50;">title</span><span style="color: #a2b6da;">)</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span>
            <span style="color: #e011a3efa386;">metadata</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span>
      <span style="color: #da8548;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">format</span> <span style="color: #98be65;">"%s - %s: %s%s"</span> <span style="color: #a9a1e1;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">s</span><span style="text-decoration: underline;">-</span><span style="color: #6b65c2f6d999; text-decoration: underline;">join</span> <span style="color: #98be65;">", "</span> <span style="color: #91edb1e5c7aa;">artists</span><span style="color: #a9a1e1;">)</span> <span style="color: #918b91cd9132;">album</span> <span style="color: #ad489b408e50;">title</span>
              <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #b3609a32bacd;">player</span>
                  <span style="color: #ECBE7B;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">format</span> <span style="color: #98be65;">" [%s]"</span> <span style="color: #b3609a32bacd;">player</span>-<span style="color: #87cfc690d6c9;">name</span><span style="color: #ECBE7B;">)</span>
                <span style="color: #98be65;">""</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgdc3f2b3" class="outline-2">
<h2 id="orgdc3f2b3">Org&#xa0;&#xa0;&#xa0;<span class="tag"><span class="Org">Org</span></span></h2>
<div class="outline-text-2" id="text-orgdc3f2b3">
<p>
Code for <a href="https://orgmode.org/">Org Mode</a>.
</p>
</div>

<div id="outline-container-orgd64d395" class="outline-3">
<h3 id="orgd64d395">Agenda previews&#xa0;&#xa0;&#xa0;<span class="tag"><span class="agenda">agenda</span></span></h3>
<div class="outline-text-3" id="text-orgd64d395">
<p>
<i>Before:</i>
</p>

<p>

</p>

<p>
<i>After:</i>
</p>

<p>

</p>

<p>
<b>Requires:</b>
</p>
<ul class="org-ul">
<li><a href="https://github.com/ShingoFukuyama/ov.el">ov</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">defface</span> <span style="color: #dcaeea;">unpackaged/org-agenda-preview</span>
  <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span><span style="color: #98be65;">(</span><span style="color: #bbe6ba32c7cd;">t</span> <span style="color: #da8548;">(</span><span style="color: #c678dd;">:background</span> <span style="color: #98be65;">"black"</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #83898d; font-weight: bold; font-style: italic;">"Face for Org Agenda previews."</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">unpackaged/org-agenda-toggle-preview</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d; font-weight: bold; font-style: italic;">"Toggle overlay of current item in agenda."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if-let*</span> <span style="color: #98be65;">(</span><span style="color: #da8548;">(</span><span style="color: #87cfc690d6c9;">overlay</span> <span style="color: #a9a1e1;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">ov</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">in</span> <span style="color: #51afef;">'</span><span style="color: #e1b3bbc0bb7e; font-style: italic;">unpackaged</span><span style="color: #ECBE7B; font-style: italic;">/</span><span style="color: #7765a7b4c89a; font-style: italic;">org</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #b3609a32bacd; font-style: italic;">agenda</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #cd65b84f9999; font-style: italic;">preview</span> <span style="color: #bbe6ba32c7cd;">t</span> <span style="color: #ECBE7B;">(</span><span style="color: #e011a3efa386; text-decoration: underline;">line</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">end</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">position</span><span style="color: #ECBE7B;">)</span> <span style="color: #ECBE7B;">(</span><span style="color: #e011a3efa386; text-decoration: underline;">line</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">end</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">position</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span>
      <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Hide existing preview</span>
      <span style="color: #98be65;">(</span><span style="color: #51afef;">ov-reset</span> <span style="color: #87cfc690d6c9;">overlay</span><span style="color: #98be65;">)</span>
    <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Show preview</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">let*</span> <span style="color: #da8548;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #e1b3bbc0bb7e;">entry</span>-<span style="color: #e011a3efa386;">contents</span> <span style="color: #ECBE7B;">(</span><span style="color: #51afef;">--&gt;</span> <span style="color: #4db5bd;">(</span><span style="color: #51afef;">org-agenda-with-point-at-orig-entry</span>
                                 <span style="color: #cd7fcd65ce32;">nil</span> <span style="color: #a2b6da;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">buffer</span><span style="text-decoration: underline;">-</span><span style="color: #b3609a32bacd; text-decoration: underline;">substring</span> <span style="color: #9cb6ad;">(</span><span style="color: #51afef;">save-excursion</span>
                                                         <span style="color: #51afef;">(</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">unpackaged</span><span style="text-decoration: underline;">/</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">forward</span><span style="text-decoration: underline;">-</span><span style="color: #bae2b0b4bde3; text-decoration: underline;">to</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">entry</span><span style="text-decoration: underline;">-</span><span style="color: #ad489b408e50; text-decoration: underline;">content</span> <span style="color: #bbe6ba32c7cd;">t</span><span style="color: #51afef;">)</span>
                                                         <span style="color: #51afef;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">point</span><span style="color: #51afef;">)</span><span style="color: #9cb6ad;">)</span>
                                                       <span style="color: #9cb6ad;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">entry</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">end</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">position</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #4db5bd;">)</span>
                                <span style="color: #7765a7b4c89a;">s</span>-<span style="color: #bae2b0b4bde3;">trim</span>
                                <span style="color: #4db5bd;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">concat</span> <span style="color: #98be65;">"\n"</span> <span style="color: #dcaeea;">it</span> <span style="color: #98be65;">"\n"</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span>
      <span style="color: #da8548;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">add</span><span style="text-decoration: underline;">-</span><span style="color: #6b65c2f6d999; text-decoration: underline;">face</span><span style="text-decoration: underline;">-</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">text</span><span style="text-decoration: underline;">-</span><span style="color: #87cfc690d6c9; text-decoration: underline;">property</span> <span style="color: #87cfc690d6c9;">0</span> <span style="color: #a9a1e1;">(</span><span style="color: #cd65b84f9999; text-decoration: underline;">length</span> <span style="color: #e1b3bbc0bb7e;">entry</span>-<span style="color: #e011a3efa386;">contents</span><span style="color: #a9a1e1;">)</span>
                              <span style="color: #51afef;">'</span><span style="color: #e1b3bbc0bb7e; font-style: italic;">unpackaged</span><span style="color: #ECBE7B; font-style: italic;">/</span><span style="color: #7765a7b4c89a; font-style: italic;">org</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #b3609a32bacd; font-style: italic;">agenda</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #cd65b84f9999; font-style: italic;">preview</span> <span style="color: #cd7fcd65ce32;">nil</span> <span style="color: #e1b3bbc0bb7e;">entry</span>-<span style="color: #e011a3efa386;">contents</span><span style="color: #da8548;">)</span>
      <span style="color: #da8548;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">ov</span> <span style="color: #a9a1e1;">(</span><span style="color: #e011a3efa386; text-decoration: underline;">line</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">end</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">position</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #e011a3efa386; text-decoration: underline;">line</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">end</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">position</span><span style="color: #a9a1e1;">)</span>
          <span style="color: #51afef;">'</span><span style="color: #e1b3bbc0bb7e; font-style: italic;">unpackaged</span><span style="color: #ECBE7B; font-style: italic;">/</span><span style="color: #7765a7b4c89a; font-style: italic;">org</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #b3609a32bacd; font-style: italic;">agenda</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #cd65b84f9999; font-style: italic;">preview</span> <span style="color: #bbe6ba32c7cd;">t</span>
          <span style="color: #51afef;">'</span><span style="color: #cd7fcd65ce32; font-style: italic;">before</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #cd7fcd65ce32; font-style: italic;">string</span> <span style="color: #e1b3bbc0bb7e;">entry</span>-<span style="color: #e011a3efa386;">contents</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">unpackaged/org-forward-to-entry-content</span> <span style="color: #c678dd;">(</span><span style="color: #ECBE7B;">&amp;optional</span> <span style="color: #e011a3efa386;">unsafe</span><span style="color: #c678dd;">)</span>
  <span style="color: #83898d; font-weight: bold; font-style: italic;">"Skip headline, planning line, and all drawers in current entry.</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">If UNSAFE is non-nil, assume point is on headline."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">unless</span> <span style="color: #e011a3efa386;">unsafe</span>
    <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">To improve performance in loops (e.g. with `</span><span style="color: #a9a1e1; font-weight: bold; font-style: italic;">org-map-entries</span><span style="color: #586e75; font-weight: bold; font-style: italic;">')</span>
    <span style="color: #98be65;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #6b65c2f6d999; text-decoration: underline;">back</span><span style="text-decoration: underline;">-</span><span style="color: #bae2b0b4bde3; text-decoration: underline;">to</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">heading</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cl-loop</span> <span style="color: #91edb1e5c7aa;">for</span> <span style="color: #e011a3efa386;">element</span> = <span style="color: #98be65;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #e011a3efa386; text-decoration: underline;">element</span><span style="text-decoration: underline;">-</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">at</span><span style="text-decoration: underline;">-</span><span style="color: #ad489b408e50; text-decoration: underline;">point</span><span style="color: #98be65;">)</span>
           <span style="color: #91edb1e5c7aa;">for</span> <span style="color: #bbe6ba32c7cd;">pos</span> = <span style="color: #98be65;">(</span><span style="color: #51afef;">pcase</span> <span style="color: #e011a3efa386;">element</span>
                       <span style="color: #da8548;">(</span><span style="color: #51afef;">`</span><span style="color: #a9a1e1;">(</span><span style="color: #9e4c9e4c9e4c;">headline</span> . ,_<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #e011a3efa386; text-decoration: underline;">element</span><span style="text-decoration: underline;">-</span><span style="color: #87cfc690d6c9; text-decoration: underline;">property</span> <span style="color: #c678dd;">:contents-begin</span> <span style="color: #e011a3efa386;">element</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span>
                       <span style="color: #da8548;">(</span><span style="color: #51afef;">`</span><span style="color: #a9a1e1;">(</span>,<span style="color: #ECBE7B;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">'</span><span style="color: #918b91cd9132; font-style: italic;">planning</span> <span style="color: #51afef;">'</span><span style="color: #87cfc690d6c9; font-style: italic;">property</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #ad489b408e50; font-style: italic;">drawer</span> <span style="color: #51afef;">'</span><span style="color: #ad489b408e50; font-style: italic;">drawer</span><span style="color: #ECBE7B;">)</span> . ,_<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #e011a3efa386; text-decoration: underline;">element</span><span style="text-decoration: underline;">-</span><span style="color: #87cfc690d6c9; text-decoration: underline;">property</span> <span style="color: #c678dd;">:end</span> <span style="color: #e011a3efa386;">element</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span>
           <span style="color: #ad9a8c4c7464;">while</span> <span style="color: #bbe6ba32c7cd;">pos</span>
           <span style="color: #9e4c9e4c9e4c;">do</span> <span style="color: #98be65;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">char</span> <span style="color: #bbe6ba32c7cd;">pos</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf15f0f1" class="outline-3">
<h3 id="orgf15f0f1"><a id="ID-b86d14ff-b87c-4e2a-a513-067c0a5d3490"></a>Convert Elisp to Org format&#xa0;&#xa0;&#xa0;<span class="tag"><span class="meta">meta</span></span></h3>
<div class="outline-text-3" id="text-orgf15f0f1">
<p>
These functions convert Emacs Lisp code and docstrings to Org-formatted text, helpful for inserting into readme files (like this one).
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">unpackaged/elisp-to-org</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d; font-weight: bold; font-style: italic;">"Convert elisp code in region to Org syntax and put in kill-ring.</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">Extracts and converts docstring to Org text, and places code in</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">source block."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let*</span> <span style="color: #98be65;">(</span><span style="color: #da8548;">(</span><span style="color: #6b65c2f6d999;">raw</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">-&gt;&gt;</span> <span style="color: #ECBE7B;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">buffer</span><span style="text-decoration: underline;">-</span><span style="color: #b3609a32bacd; text-decoration: underline;">substring</span> <span style="color: #4db5bd;">(</span><span style="color: #918b91cd9132; text-decoration: underline;">region</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">beginning</span><span style="color: #4db5bd;">)</span> <span style="color: #4db5bd;">(</span><span style="color: #918b91cd9132; text-decoration: underline;">region</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">end</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span>
                   <span style="color: #ECBE7B;">(</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">replace</span><span style="text-decoration: underline;">-</span><span style="color: #6b65c2f6d999; text-decoration: underline;">regexp</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">in</span><span style="text-decoration: underline;">-</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">string</span> <span style="color: #4db5bd;">(</span><span style="color: #51afef;">rx</span> <span style="color: #91edb1e5c7aa;">bol</span><span style="color: #4db5bd;">)</span> <span style="color: #98be65;">"  "</span><span style="color: #ECBE7B;">)</span>
                   <span style="color: #ECBE7B;">(</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">replace</span><span style="text-decoration: underline;">-</span><span style="color: #6b65c2f6d999; text-decoration: underline;">regexp</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">in</span><span style="text-decoration: underline;">-</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">string</span> <span style="color: #4db5bd;">(</span><span style="color: #51afef;">rx</span> <span style="color: #91edb1e5c7aa;">bol</span> <span style="color: #a2b6da;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">1</span><span style="text-decoration: underline;">+</span> <span style="color: #e1b3bbc0bb7e;">blank</span><span style="color: #a2b6da;">)</span> <span style="color: #9e4c9e4c9e4c;">eol</span><span style="color: #4db5bd;">)</span> <span style="color: #98be65;">""</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span>
         <span style="color: #da8548;">(</span><span style="color: #b3609a32bacd;">sexp</span> <span style="color: #a9a1e1;">(</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">read</span> <span style="color: #6b65c2f6d999;">raw</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span>
         <span style="color: #da8548;">(</span><span style="color: #e011a3efa386;">docstring</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">--when-let</span> <span style="color: #ECBE7B;">(</span><span style="text-decoration: underline;">-</span><span style="color: #cd65b84f9999; text-decoration: underline;">first</span> <span style="color: #51afef;">#'</span><span style="color: #b3609a32bacd; font-style: italic;">stringp</span> <span style="color: #b3609a32bacd;">sexp</span><span style="color: #ECBE7B;">)</span>
                      <span style="color: #ECBE7B;">(</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">unpackaged</span><span style="text-decoration: underline;">/</span><span style="color: #e011a3efa386; text-decoration: underline;">docstring</span><span style="text-decoration: underline;">-</span><span style="color: #bae2b0b4bde3; text-decoration: underline;">to</span><span style="text-decoration: underline;">-</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span> <span style="color: #dcaeea;">it</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">kill</span><span style="text-decoration: underline;">-</span><span style="color: #87cfc690d6c9; text-decoration: underline;">new</span> <span style="color: #da8548;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">concat</span> <span style="color: #e011a3efa386;">docstring</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">when</span> <span style="color: #e011a3efa386;">docstring</span> <span style="color: #98be65;">"\n\n"</span><span style="color: #a9a1e1;">)</span>
                      <span style="color: #98be65;">"#+BEGIN_SRC elisp"</span> <span style="color: #98be65;">"\n"</span>
                      <span style="color: #6b65c2f6d999;">raw</span> <span style="color: #98be65;">"\n"</span>
                      <span style="color: #98be65;">"#+END_SRC"</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">unpackaged/docstring-to-org</span> <span style="color: #c678dd;">(</span><span style="color: #e011a3efa386;">docstring</span><span style="color: #c678dd;">)</span>
  <span style="color: #83898d; font-weight: bold; font-style: italic;">"Return DOCSTRING as formatted Org text.</span>

<span style="color: #83898d; font-weight: bold; font-style: italic;">Interactively, get text from region, and kill formatted Org text</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">to kill-ring."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span> <span style="color: #98be65;">(</span><span style="color: #e011a3efa386; text-decoration: underline;">list</span> <span style="color: #da8548;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">buffer</span><span style="text-decoration: underline;">-</span><span style="color: #b3609a32bacd; text-decoration: underline;">substring</span> <span style="color: #a9a1e1;">(</span><span style="color: #918b91cd9132; text-decoration: underline;">region</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">beginning</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #918b91cd9132; text-decoration: underline;">region</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">end</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cl-macrolet</span> <span style="color: #98be65;">(</span><span style="color: #da8548;">(</span><span style="color: #cd7fcd65ce32;">string</span>-<span style="color: #bbe6ba32c7cd;">buffer</span>--&gt; <span style="color: #a9a1e1;">(</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">string</span> <span style="color: #ECBE7B;">&amp;rest</span> <span style="color: #b3609a32bacd;">forms</span><span style="color: #a9a1e1;">)</span>
                                  <span style="color: #51afef;">`</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">with-temp-buffer</span>
                                     <span style="color: #ECBE7B;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">insert</span> ,<span style="color: #cd7fcd65ce32;">string</span><span style="color: #ECBE7B;">)</span>
                                     ,@<span style="color: #ECBE7B;">(</span><span style="color: #51afef;">cl-loop</span> <span style="color: #91edb1e5c7aa;">for</span> <span style="color: #e011a3efa386;">form</span> <span style="color: #e1b3bbc0bb7e;">in</span> <span style="color: #b3609a32bacd;">forms</span>
                                                <span style="color: #cd7fcd65ce32;">collect</span> <span style="color: #51afef;">`</span><span style="color: #4db5bd;">(</span><span style="color: #bbe6ba32c7cd;">goto</span>-<span style="color: #918b91cd9132;">char</span> <span style="color: #a2b6da;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #b3609a32bacd; text-decoration: underline;">min</span><span style="color: #a2b6da;">)</span><span style="color: #4db5bd;">)</span>
                                                <span style="color: #cd7fcd65ce32;">collect</span> <span style="color: #e011a3efa386;">form</span><span style="color: #ECBE7B;">)</span>
                                     <span style="color: #ECBE7B;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">buffer</span><span style="text-decoration: underline;">-</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">string</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">--&gt;</span> <span style="color: #da8548;">(</span><span style="color: #cd7fcd65ce32;">string</span>-<span style="color: #bbe6ba32c7cd;">buffer</span>--&gt; <span style="color: #e011a3efa386;">docstring</span>
                           <span style="color: #a9a1e1;">(</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">unpackaged</span><span style="text-decoration: underline;">/</span><span style="color: #7765a7b4c89a; text-decoration: underline;">caps</span><span style="text-decoration: underline;">-</span><span style="color: #bae2b0b4bde3; text-decoration: underline;">to</span><span style="text-decoration: underline;">-</span><span style="color: #bae2b0b4bde3; text-decoration: underline;">code</span> <span style="color: #ECBE7B;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #b3609a32bacd; text-decoration: underline;">min</span><span style="color: #ECBE7B;">)</span> <span style="color: #ECBE7B;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">max</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span>
                           <span style="color: #a9a1e1;">(</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">unpackaged</span><span style="text-decoration: underline;">/</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">symbol</span><span style="text-decoration: underline;">-</span><span style="color: #7765a7b4c89a; text-decoration: underline;">quotes</span><span style="text-decoration: underline;">-</span><span style="color: #bae2b0b4bde3; text-decoration: underline;">to</span><span style="text-decoration: underline;">-</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #bae2b0b4bde3; text-decoration: underline;">code</span> <span style="color: #ECBE7B;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #b3609a32bacd; text-decoration: underline;">min</span><span style="color: #ECBE7B;">)</span> <span style="color: #ECBE7B;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">max</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span>
                           <span style="color: #a9a1e1;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">unfill</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">region</span> <span style="color: #ECBE7B;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #b3609a32bacd; text-decoration: underline;">min</span><span style="color: #ECBE7B;">)</span> <span style="color: #ECBE7B;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">max</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span>
                           <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">while</span> <span style="color: #ECBE7B;">(</span><span style="color: #cf7ec31fb119; text-decoration: underline;">re</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">search</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">forward</span> <span style="color: #4db5bd;">(</span><span style="color: #51afef;">rx</span> <span style="color: #91edb1e5c7aa;">bol</span> <span style="color: #a2b6da;">(</span><span style="color: #cd7fcd65ce32;">group</span> <span style="color: #9cb6ad;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">1</span><span style="text-decoration: underline;">+</span> <span style="color: #e1b3bbc0bb7e;">blank</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #4db5bd;">)</span> <span style="color: #cd7fcd65ce32;">nil</span> <span style="color: #bbe6ba32c7cd;">t</span><span style="color: #ECBE7B;">)</span>
                             <span style="color: #ECBE7B;">(</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">replace</span><span style="text-decoration: underline;">-</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">match</span> <span style="color: #98be65;">""</span> <span style="color: #bbe6ba32c7cd;">t</span> <span style="color: #bbe6ba32c7cd;">t</span> <span style="color: #cd7fcd65ce32;">nil</span> <span style="color: #91edb1e5c7aa;">1</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span>
                           <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">when</span> <span style="color: #ECBE7B;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">looking</span><span style="text-decoration: underline;">-</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">at</span> <span style="color: #98be65;">"\""</span><span style="color: #ECBE7B;">)</span>
                             <span style="color: #ECBE7B;">(</span><span style="color: #e011a3efa386; text-decoration: underline;">delete</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">char</span> <span style="color: #91edb1e5c7aa;">1</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span>
                           <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">when</span> <span style="color: #ECBE7B;">(</span><span style="color: #51afef;">progn</span>
                                   <span style="color: #4db5bd;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">char</span> <span style="color: #a2b6da;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">max</span><span style="color: #a2b6da;">)</span><span style="color: #4db5bd;">)</span>
                                   <span style="color: #4db5bd;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">looking</span><span style="text-decoration: underline;">-</span><span style="color: #6b65c2f6d999; text-decoration: underline;">back</span> <span style="color: #98be65;">"\""</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span>
                             <span style="color: #ECBE7B;">(</span><span style="color: #e011a3efa386; text-decoration: underline;">delete</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">char</span> -<span style="color: #91edb1e5c7aa;">1</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span>
         <span style="color: #da8548;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">called</span><span style="text-decoration: underline;">-</span><span style="color: #ad489b408e50; text-decoration: underline;">interactively</span><span style="text-decoration: underline;">-</span><span style="color: #cf7ec31fb119; text-decoration: underline;">p</span><span style="color: #a9a1e1;">)</span>
             <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">progn</span>
               <span style="color: #ECBE7B;">(</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">message</span> <span style="color: #dcaeea;">it</span><span style="color: #ECBE7B;">)</span>
               <span style="color: #ECBE7B;">(</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">kill</span><span style="text-decoration: underline;">-</span><span style="color: #87cfc690d6c9; text-decoration: underline;">new</span> <span style="color: #dcaeea;">it</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span>
           <span style="color: #dcaeea;">it</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">unpackaged/caps-to-code</span> <span style="color: #c678dd;">(</span><span style="color: #cd65b84f9999;">beg</span> <span style="color: #e1b3bbc0bb7e;">end</span><span style="color: #c678dd;">)</span>
  <span style="color: #83898d; font-weight: bold; font-style: italic;">"Convert all-caps words in region to Org code emphasis."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span> <span style="color: #98be65;">"r"</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #da8548;">(</span><span style="color: #918b91cd9132;">case</span>-<span style="color: #ad489b408e50;">fold</span>-<span style="color: #ad9a8c4c7464;">search</span> <span style="color: #cd7fcd65ce32;">nil</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">save-excursion</span>
      <span style="color: #da8548;">(</span><span style="color: #51afef;">save-restriction</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #cd65b84f9999; text-decoration: underline;">narrow</span><span style="text-decoration: underline;">-</span><span style="color: #bae2b0b4bde3; text-decoration: underline;">to</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">region</span> <span style="color: #cd65b84f9999;">beg</span> <span style="color: #e1b3bbc0bb7e;">end</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">char</span> <span style="color: #ECBE7B;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #b3609a32bacd; text-decoration: underline;">min</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">while</span> <span style="color: #ECBE7B;">(</span><span style="color: #cf7ec31fb119; text-decoration: underline;">re</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">search</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">forward</span> <span style="color: #4db5bd;">(</span><span style="color: #51afef;">rx</span> <span style="color: #a2b6da;">(</span><span style="color: #51afef;">or</span> <span style="color: #918b91cd9132;">space</span> <span style="color: #91edb1e5c7aa;">bol</span><span style="color: #a2b6da;">)</span>
                                      <span style="color: #a2b6da;">(</span><span style="color: #cd7fcd65ce32;">group</span> <span style="color: #9cb6ad;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">1</span><span style="text-decoration: underline;">+</span> <span style="color: #e011a3efa386;">upper</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span>
                                      <span style="color: #a2b6da;">(</span><span style="color: #51afef;">or</span> <span style="color: #918b91cd9132;">space</span> <span style="color: #9e4c9e4c9e4c;">eol</span> <span style="color: #9cb6ad;">(</span><span style="color: #918b91cd9132;">char</span> <span style="color: #ad9a8c4c7464;">punct</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #4db5bd;">)</span>
                                  <span style="color: #cd7fcd65ce32;">nil</span> <span style="color: #bbe6ba32c7cd;">t</span><span style="color: #ECBE7B;">)</span>
          <span style="color: #ECBE7B;">(</span><span style="color: #51afef;">setf</span> <span style="color: #4db5bd;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">buffer</span><span style="text-decoration: underline;">-</span><span style="color: #b3609a32bacd; text-decoration: underline;">substring</span> <span style="color: #a2b6da;">(</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">match</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">beginning</span> <span style="color: #91edb1e5c7aa;">1</span><span style="color: #a2b6da;">)</span> <span style="color: #a2b6da;">(</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">match</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">end</span> <span style="color: #91edb1e5c7aa;">1</span><span style="color: #a2b6da;">)</span><span style="color: #4db5bd;">)</span>
                <span style="color: #4db5bd;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">concat</span> <span style="color: #98be65;">"~"</span> <span style="color: #a2b6da;">(</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">match</span><span style="text-decoration: underline;">-</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">string</span> <span style="color: #91edb1e5c7aa;">1</span><span style="color: #a2b6da;">)</span> <span style="color: #98be65;">"~"</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span>
          <span style="color: #ECBE7B;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">char</span> <span style="color: #4db5bd;">(</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">match</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">end</span> <span style="color: #87cfc690d6c9;">0</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">unpackaged/symbol-quotes-to-org-code</span> <span style="color: #c678dd;">(</span><span style="color: #cd65b84f9999;">beg</span> <span style="color: #e1b3bbc0bb7e;">end</span><span style="color: #c678dd;">)</span>
  <span style="color: #83898d; font-weight: bold; font-style: italic;">"Change Emacs `</span><span style="color: #a9a1e1; font-weight: bold; font-style: italic;">symbol</span><span style="color: #83898d; font-weight: bold; font-style: italic;">' quotes to Org =symbol= quotes in region."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span> <span style="color: #98be65;">"r"</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">save-excursion</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">save-restriction</span>
      <span style="color: #da8548;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">char</span> <span style="color: #cd65b84f9999;">beg</span><span style="color: #da8548;">)</span>
      <span style="color: #da8548;">(</span><span style="color: #cd65b84f9999; text-decoration: underline;">narrow</span><span style="text-decoration: underline;">-</span><span style="color: #bae2b0b4bde3; text-decoration: underline;">to</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">region</span> <span style="color: #cd65b84f9999;">beg</span> <span style="color: #e1b3bbc0bb7e;">end</span><span style="color: #da8548;">)</span>
      <span style="color: #da8548;">(</span><span style="color: #51afef;">while</span> <span style="color: #a9a1e1;">(</span><span style="color: #cf7ec31fb119; text-decoration: underline;">re</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">search</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">forward</span> <span style="color: #ECBE7B;">(</span><span style="color: #51afef;">rx</span> <span style="color: #4db5bd;">(</span><span style="color: #51afef;">or</span> <span style="color: #98be65;">"`"</span> <span style="color: #98be65;">"&#8216;"</span><span style="color: #4db5bd;">)</span> <span style="color: #4db5bd;">(</span><span style="color: #cd7fcd65ce32;">group</span> <span style="color: #a2b6da;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">1</span><span style="text-decoration: underline;">+</span> <span style="color: #9cb6ad;">(</span><span style="color: #51afef;">or</span> <span style="color: #98be65;">"-"</span> <span style="color: #7765a7b4c89a;">word</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #4db5bd;">)</span> <span style="color: #98be65;">"'"</span><span style="color: #ECBE7B;">)</span> <span style="color: #cd7fcd65ce32;">nil</span> <span style="color: #bbe6ba32c7cd;">t</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">replace</span><span style="text-decoration: underline;">-</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">match</span> <span style="color: #ECBE7B;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">concat</span> <span style="color: #98be65;">"~"</span> <span style="color: #4db5bd;">(</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">match</span><span style="text-decoration: underline;">-</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">string</span> <span style="color: #91edb1e5c7aa;">1</span><span style="color: #4db5bd;">)</span> <span style="color: #98be65;">"~"</span><span style="color: #ECBE7B;">)</span> <span style="color: #bbe6ba32c7cd;">t</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbcfef64" class="outline-3">
<h3 id="orgbcfef64">Download and attach remote files</h3>
<div class="outline-text-3" id="text-orgbcfef64">
<p>
Download file at <code>URL</code> and attach with <code>org-attach</code>.  Interactively, look for <code>URL</code> at point, in X clipboard, and in kill-ring, prompting if not found.  With prefix, prompt for <code>URL</code>.
</p>

<p>
<b>Requires:</b>
</p>
<ul class="org-ul">
<li><a href="https://github.com/alphapapa/org-web-tools">org-web-tools</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">unpackaged/org-attach-download</span> <span style="color: #c678dd;">(</span><span style="color: #87cfc690d6c9;">url</span><span style="color: #c678dd;">)</span>
  <span style="color: #83898d; font-weight: bold; font-style: italic;">"Download file at URL and attach with `</span><span style="color: #a9a1e1; font-weight: bold; font-style: italic;">org-attach</span><span style="color: #83898d; font-weight: bold; font-style: italic;">'.</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">Interactively, look for URL at point, in X clipboard, and in</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">kill-ring, prompting if not found.  With prefix, prompt for URL."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span> <span style="color: #98be65;">(</span><span style="color: #e011a3efa386; text-decoration: underline;">list</span> <span style="color: #da8548;">(</span><span style="color: #51afef;">if</span> <span style="color: #e1b3bbc0bb7e;">current</span>-<span style="color: #cd7fcd65ce32;">prefix</span>-<span style="color: #87cfc690d6c9;">arg</span>
                         <span style="color: #a9a1e1;">(</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">read</span><span style="text-decoration: underline;">-</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">string</span> <span style="color: #98be65;">"URL: "</span><span style="color: #a9a1e1;">)</span>
                       <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> <span style="color: #ECBE7B;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #e011a3efa386; text-decoration: underline;">element</span><span style="text-decoration: underline;">-</span><span style="color: #87cfc690d6c9; text-decoration: underline;">property</span> <span style="color: #c678dd;">:raw-link</span> <span style="color: #4db5bd;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #e011a3efa386; text-decoration: underline;">element</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">context</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span>
                           <span style="color: #ECBE7B;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #ad489b408e50; text-decoration: underline;">web</span><span style="text-decoration: underline;">-</span><span style="color: #cd65b84f9999; text-decoration: underline;">tools</span><span style="text-decoration: underline;">--</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">get</span><span style="text-decoration: underline;">-</span><span style="color: #cd65b84f9999; text-decoration: underline;">first</span><span style="text-decoration: underline;">-</span><span style="color: #87cfc690d6c9; text-decoration: underline;">url</span><span style="color: #ECBE7B;">)</span>
                           <span style="color: #ECBE7B;">(</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">read</span><span style="text-decoration: underline;">-</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">string</span> <span style="color: #98be65;">"URL: "</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> <span style="color: #98be65;">(</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">yes</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">or</span><span style="text-decoration: underline;">-</span><span style="color: #b3609a32bacd; text-decoration: underline;">no</span><span style="text-decoration: underline;">-</span><span style="color: #cf7ec31fb119; text-decoration: underline;">p</span> <span style="color: #da8548;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">concat</span> <span style="color: #98be65;">"Attach file at URL: "</span> <span style="color: #87cfc690d6c9;">url</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">let*</span> <span style="color: #da8548;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #6b65c2f6d999;">temp</span>-<span style="color: #ad489b408e50;">dir</span> <span style="color: #ECBE7B;">(</span><span style="color: #cf7ec31fb119; text-decoration: underline;">make</span><span style="text-decoration: underline;">-</span><span style="color: #6b65c2f6d999; text-decoration: underline;">temp</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">file</span> <span style="color: #98be65;">"org-attach-download-"</span> <span style="color: #51afef;">'</span><span style="color: #ad489b408e50; font-style: italic;">dir</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span>
           <span style="color: #a9a1e1;">(</span><span style="color: #b3609a32bacd;">basename</span> <span style="color: #ECBE7B;">(</span><span style="color: #918b91cd9132; text-decoration: underline;">file</span><span style="text-decoration: underline;">-</span><span style="color: #87cfc690d6c9; text-decoration: underline;">name</span><span style="text-decoration: underline;">-</span><span style="color: #bae2b0b4bde3; text-decoration: underline;">nondirectory</span> <span style="color: #4db5bd;">(</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">directory</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">file</span><span style="text-decoration: underline;">-</span><span style="color: #87cfc690d6c9; text-decoration: underline;">name</span> <span style="color: #87cfc690d6c9;">url</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span>
           <span style="color: #a9a1e1;">(</span><span style="color: #ad9a8c4c7464;">local</span>-<span style="color: #6b65c2f6d999;">path</span> <span style="color: #ECBE7B;">(</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">expand</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">file</span><span style="text-decoration: underline;">-</span><span style="color: #87cfc690d6c9; text-decoration: underline;">name</span> <span style="color: #b3609a32bacd;">basename</span> <span style="color: #6b65c2f6d999;">temp</span>-<span style="color: #ad489b408e50;">dir</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span>
           <span style="color: #7765a7b4c89a;">size</span><span style="color: #da8548;">)</span>
      <span style="color: #da8548;">(</span><span style="color: #51afef;">unwind-protect</span>
          <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">progn</span>
            <span style="color: #ECBE7B;">(</span><span style="color: #87cfc690d6c9; text-decoration: underline;">url</span><span style="text-decoration: underline;">-</span><span style="color: #cd65b84f9999; text-decoration: underline;">copy</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">file</span> <span style="color: #87cfc690d6c9;">url</span> <span style="color: #ad9a8c4c7464;">local</span>-<span style="color: #6b65c2f6d999;">path</span> <span style="color: #51afef;">'</span><span style="color: #91edb1e5c7aa; font-style: italic;">ok</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #bae2b0b4bde3; font-style: italic;">if</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #7765a7b4c89a; font-style: italic;">exists</span> <span style="color: #51afef;">'</span><span style="color: #87cfc690d6c9; font-style: italic;">keep</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #9e4c9e4c9e4c; font-style: italic;">time</span><span style="color: #ECBE7B;">)</span>
            <span style="color: #ECBE7B;">(</span><span style="color: #51afef;">setq</span> <span style="color: #7765a7b4c89a;">size</span> <span style="color: #4db5bd;">(</span><span style="color: #918b91cd9132; text-decoration: underline;">file</span><span style="text-decoration: underline;">-</span><span style="color: #7765a7b4c89a; text-decoration: underline;">size</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">human</span><span style="text-decoration: underline;">-</span><span style="color: #7765a7b4c89a; text-decoration: underline;">readable</span>
                        <span style="color: #a2b6da;">(</span><span style="color: #918b91cd9132; text-decoration: underline;">file</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">attribute</span><span style="text-decoration: underline;">-</span><span style="color: #7765a7b4c89a; text-decoration: underline;">size</span>
                         <span style="color: #9cb6ad;">(</span><span style="color: #918b91cd9132; text-decoration: underline;">file</span><span style="text-decoration: underline;">-</span><span style="color: #cf7ec31fb119; text-decoration: underline;">attributes</span> <span style="color: #ad9a8c4c7464;">local</span>-<span style="color: #6b65c2f6d999;">path</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span>
            <span style="color: #ECBE7B;">(</span><span style="color: #7765a7b4c89a;">org</span>-<span style="color: #918b91cd9132;">attach</span>-<span style="color: #918b91cd9132;">attach</span> <span style="color: #ad9a8c4c7464;">local</span>-<span style="color: #6b65c2f6d999;">path</span> <span style="color: #cd7fcd65ce32;">nil</span> <span style="color: #51afef;">'</span><span style="color: #e011a3efa386; font-style: italic;">mv</span><span style="color: #ECBE7B;">)</span>
            <span style="color: #ECBE7B;">(</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">message</span> <span style="color: #98be65;">"Attached %s (%s)"</span> <span style="color: #87cfc690d6c9;">url</span> <span style="color: #7765a7b4c89a;">size</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #e011a3efa386; text-decoration: underline;">delete</span><span style="text-decoration: underline;">-</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">directory</span> <span style="color: #6b65c2f6d999;">temp</span>-<span style="color: #ad489b408e50;">dir</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4505ec6" class="outline-3">
<h3 id="org4505ec6">Ensure blank lines between headings and before contents</h3>
<div class="outline-text-3" id="text-org4505ec6">
<p>
Ensure that blank lines exist between headings and between headings and their contents.  With prefix, operate on whole buffer.  Ensures that blank lines exist after each headings's drawers.
</p>

<p>
For those who prefer to maintain blank lines between headings, this makes it easy to automatically add them where necessary, to a subtree or the whole buffer.  It also adds blank lines after drawers.  Works well with <a href="#orgd4c0eea"><code>org-return-dwim</code></a>.
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">unpackaged/org-fix-blank-lines</span> <span style="color: #c678dd;">(</span><span style="color: #cd7fcd65ce32;">prefix</span><span style="color: #c678dd;">)</span>
    <span style="color: #83898d; font-weight: bold; font-style: italic;">"Ensure that blank lines exist between headings and between headings and their contents.</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">With prefix, operate on whole buffer.  Ensures that blank lines</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">exist after each headings's drawers."</span>
    <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span> <span style="color: #98be65;">"P"</span><span style="color: #c678dd;">)</span>
    <span style="color: #c678dd;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #cf7ec31fb119; text-decoration: underline;">map</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">entries</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #da8548;">()</span>
                       <span style="color: #da8548;">(</span><span style="color: #51afef;">org-with-wide-buffer</span>
                        <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">`</span><span style="color: #a9a1e1; font-weight: bold; font-style: italic;">org-map-entries</span><span style="color: #586e75; font-weight: bold; font-style: italic;">' narrows the buffer, which prevents us from seeing</span>
                        <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">newlines before the current heading, so we do this part widened.</span>
                        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">while</span> <span style="color: #ECBE7B;">(</span><span style="color: #cb4b16; font-weight: bold;">not</span> <span style="color: #4db5bd;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">looking</span><span style="text-decoration: underline;">-</span><span style="color: #6b65c2f6d999; text-decoration: underline;">back</span> <span style="color: #98be65;">"\n\n"</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span>
                          <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Insert blank lines before heading.</span>
                          <span style="color: #ECBE7B;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">insert</span> <span style="color: #98be65;">"\n"</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span>
                       <span style="color: #da8548;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #ECBE7B;">(</span><span style="color: #e1b3bbc0bb7e;">end</span> <span style="color: #4db5bd;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">entry</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">end</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">position</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span>
                         <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Insert blank lines before entry content</span>
                         <span style="color: #a9a1e1;">(</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">forward</span><span style="text-decoration: underline;">-</span><span style="color: #e011a3efa386; text-decoration: underline;">line</span><span style="color: #a9a1e1;">)</span>
                         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">while</span> <span style="color: #ECBE7B;">(</span><span style="color: #51afef;">and</span> <span style="color: #4db5bd;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">at</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">planning</span><span style="text-decoration: underline;">-</span><span style="color: #cf7ec31fb119; text-decoration: underline;">p</span><span style="color: #4db5bd;">)</span>
                                     <span style="color: #4db5bd;">(</span>&lt; <span style="color: #a2b6da;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">point</span><span style="color: #a2b6da;">)</span> <span style="color: #a2b6da;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">max</span><span style="color: #a2b6da;">)</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span>
                           <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Skip planning lines</span>
                           <span style="color: #ECBE7B;">(</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">forward</span><span style="text-decoration: underline;">-</span><span style="color: #e011a3efa386; text-decoration: underline;">line</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span>
                         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">while</span> <span style="color: #ECBE7B;">(</span><span style="color: #cf7ec31fb119; text-decoration: underline;">re</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">search</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">forward</span> <span style="color: #7765a7b4c89a;">org</span>-<span style="color: #ad489b408e50;">drawer</span>-<span style="color: #6b65c2f6d999;">regexp</span> <span style="color: #e1b3bbc0bb7e;">end</span> <span style="color: #bbe6ba32c7cd;">t</span><span style="color: #ECBE7B;">)</span>
                           <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Skip drawers.  You might think that `</span><span style="color: #a9a1e1; font-weight: bold; font-style: italic;">org-at-drawer-p</span><span style="color: #586e75; font-weight: bold; font-style: italic;">' would suffice, but</span>
                           <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">for some reason it doesn't work correctly when operating on hidden text.</span>
                           <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">This works, taken from `</span><span style="color: #a9a1e1; font-weight: bold; font-style: italic;">org-agenda-get-some-entry-text</span><span style="color: #586e75; font-weight: bold; font-style: italic;">'.</span>
                           <span style="color: #ECBE7B;">(</span><span style="color: #cf7ec31fb119; text-decoration: underline;">re</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">search</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">forward</span> <span style="color: #98be65;">"^[ \t]*:END:.*\n?"</span> <span style="color: #e1b3bbc0bb7e;">end</span> <span style="color: #bbe6ba32c7cd;">t</span><span style="color: #ECBE7B;">)</span>
                           <span style="color: #ECBE7B;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">char</span> <span style="color: #4db5bd;">(</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">match</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">end</span> <span style="color: #87cfc690d6c9;">0</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span>
                         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">unless</span> <span style="color: #ECBE7B;">(</span><span style="color: #51afef;">or</span> <span style="color: #4db5bd;">(</span>= <span style="color: #a2b6da;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">point</span><span style="color: #a2b6da;">)</span> <span style="color: #a2b6da;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">max</span><span style="color: #a2b6da;">)</span><span style="color: #4db5bd;">)</span>
                                     <span style="color: #4db5bd;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">at</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">heading</span><span style="text-decoration: underline;">-</span><span style="color: #cf7ec31fb119; text-decoration: underline;">p</span><span style="color: #4db5bd;">)</span>
                                     <span style="color: #4db5bd;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">looking</span><span style="text-decoration: underline;">-</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">at</span><span style="text-decoration: underline;">-</span><span style="color: #cf7ec31fb119; text-decoration: underline;">p</span> <span style="color: #98be65;">"\n"</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span>
                           <span style="color: #ECBE7B;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">insert</span> <span style="color: #98be65;">"\n"</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span>
                     <span style="color: #bbe6ba32c7cd;">t</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">if</span> <span style="color: #cd7fcd65ce32;">prefix</span>
                           <span style="color: #cd7fcd65ce32;">nil</span>
                         <span style="color: #51afef;">'</span><span style="color: #7765a7b4c89a; font-style: italic;">tree</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org76599cb" class="outline-3">
<h3 id="org76599cb">Surround region with emphasis or syntax characters</h3>
<div class="outline-text-3" id="text-org76599cb">
<p>
Define and bind interactive commands for each of <code>KEYS</code> that surround the region or insert text.  Commands are bound in <code>org-mode-map</code> to each of <code>KEYS</code>.  If the region is active, commands surround it with the key character, otherwise call <code>org-self-insert-command</code>.
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">defmacro</span> <span style="color: #c678dd;">unpackaged/def-org-maybe-surround</span> <span style="color: #c678dd;">(</span><span style="color: #ECBE7B;">&amp;rest</span> <span style="color: #91edb1e5c7aa;">keys</span><span style="color: #c678dd;">)</span>
  <span style="color: #83898d; font-weight: bold; font-style: italic;">"Define and bind interactive commands for each of KEYS that surround the region or insert text.</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">Commands are bound in `</span><span style="color: #a9a1e1; font-weight: bold; font-style: italic;">org-mode-map</span><span style="color: #83898d; font-weight: bold; font-style: italic;">' to each of KEYS.  If the</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">region is active, commands surround it with the key character,</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">otherwise call `</span><span style="color: #a9a1e1; font-weight: bold; font-style: italic;">org-self-insert-command</span><span style="color: #83898d; font-weight: bold; font-style: italic;">'."</span>
  <span style="color: #51afef;">`</span><span style="color: #c678dd;">(</span><span style="color: #51afef;">progn</span>
     ,@<span style="color: #98be65;">(</span><span style="color: #51afef;">cl-loop</span> <span style="color: #91edb1e5c7aa;">for</span> <span style="color: #bae2b0b4bde3;">key</span> <span style="color: #e1b3bbc0bb7e;">in</span> <span style="color: #91edb1e5c7aa;">keys</span>
                <span style="color: #91edb1e5c7aa;">for</span> <span style="color: #87cfc690d6c9;">name</span> = <span style="color: #da8548;">(</span><span style="color: #918b91cd9132; text-decoration: underline;">intern</span> <span style="color: #a9a1e1;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">concat</span> <span style="color: #98be65;">"unpackaged/org-maybe-surround-"</span> <span style="color: #bae2b0b4bde3;">key</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span>
                <span style="color: #91edb1e5c7aa;">for</span> <span style="color: #e011a3efa386;">docstring</span> = <span style="color: #da8548;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">format</span> <span style="color: #98be65;">"If region is active, surround it with \"%s\", otherwise call `</span><span style="color: #a9a1e1;">org-self-insert-command</span><span style="color: #98be65;">'."</span> <span style="color: #bae2b0b4bde3;">key</span><span style="color: #da8548;">)</span>
                <span style="color: #cd7fcd65ce32;">collect</span> <span style="color: #51afef;">`</span><span style="color: #da8548;">(</span><span style="color: #51afef;">defun</span> ,<span style="color: #87cfc690d6c9;">name</span> <span style="color: #a9a1e1;">()</span>
                           ,<span style="color: #e011a3efa386;">docstring</span>
                           <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">interactive</span><span style="color: #a9a1e1;">)</span>
                           <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #ECBE7B;">(</span><span style="color: #918b91cd9132; text-decoration: underline;">region</span><span style="text-decoration: underline;">-</span><span style="color: #87cfc690d6c9; text-decoration: underline;">active</span><span style="text-decoration: underline;">-</span><span style="color: #cf7ec31fb119; text-decoration: underline;">p</span><span style="color: #ECBE7B;">)</span>
                               <span style="color: #ECBE7B;">(</span><span style="color: #51afef;">let</span> <span style="color: #4db5bd;">(</span><span style="color: #a2b6da;">(</span><span style="color: #cd65b84f9999;">beg</span> <span style="color: #9cb6ad;">(</span><span style="color: #918b91cd9132; text-decoration: underline;">region</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">beginning</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span>
                                     <span style="color: #a2b6da;">(</span><span style="color: #e1b3bbc0bb7e;">end</span> <span style="color: #9cb6ad;">(</span><span style="color: #918b91cd9132; text-decoration: underline;">region</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">end</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #4db5bd;">)</span>
                                 <span style="color: #4db5bd;">(</span><span style="color: #51afef;">save-excursion</span>
                                   <span style="color: #a2b6da;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">char</span> <span style="color: #e1b3bbc0bb7e;">end</span><span style="color: #a2b6da;">)</span>
                                   <span style="color: #a2b6da;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">insert</span> ,<span style="color: #bae2b0b4bde3;">key</span><span style="color: #a2b6da;">)</span>
                                   <span style="color: #a2b6da;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">char</span> <span style="color: #cd65b84f9999;">beg</span><span style="color: #a2b6da;">)</span>
                                   <span style="color: #a2b6da;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">insert</span> ,<span style="color: #bae2b0b4bde3;">key</span><span style="color: #a2b6da;">)</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span>
                             <span style="color: #ECBE7B;">(</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">call</span><span style="text-decoration: underline;">-</span><span style="color: #ad489b408e50; text-decoration: underline;">interactively</span> <span style="color: #51afef;">#'</span><span style="color: #7765a7b4c89a;">org</span>-<span style="color: #dcaeea;">self</span>-<span style="color: #91edb1e5c7aa;">insert</span>-<span style="color: #cd7fcd65ce32;">command</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span>
                <span style="color: #cd7fcd65ce32;">collect</span> <span style="color: #51afef;">`</span><span style="color: #da8548;">(</span><span style="color: #918b91cd9132;">define</span>-<span style="color: #bae2b0b4bde3;">key</span> <span style="color: #7765a7b4c89a;">org</span>-<span style="color: #87cfc690d6c9;">mode</span>-<span style="color: #cf7ec31fb119;">map</span> <span style="color: #a9a1e1;">(</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">kbd</span> ,<span style="color: #bae2b0b4bde3;">key</span><span style="color: #a9a1e1;">)</span> <span style="color: #51afef;">#'</span>,<span style="color: #87cfc690d6c9;">name</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Used like:
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">unpackaged/def-org-maybe-surround</span> <span style="color: #98be65;">"~"</span> <span style="color: #98be65;">"="</span> <span style="color: #98be65;">"*"</span> <span style="color: #98be65;">"/"</span> <span style="color: #98be65;">"+"</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org88eaa2e" class="outline-3">
<h3 id="org88eaa2e">Refile to datetree file using earliest/latest timestamp in entry</h3>
<div class="outline-text-3" id="text-org88eaa2e">
<p>
Refile current entry to datetree using timestamp found in entry.  <code>WHICH</code> should be <code>earliest</code> or <code>latest</code>. If <code>SUBTREE</code>-P is non-nil, search whole subtree.
</p>

<p>
This is sort of like archiving to a datetree, but it uses either the earliest or latest timestamp found in the entry or subtree rather than the current date.  It's helpful if you have an entry with lots of timestamps or log entries, and you're done with it, and you want to file it in a datetree in a leaf matching either when you started working on the entry or when you finished, using the first or last timestamp found anywhere in the entry.
</p>

<p>
<i>Note:</i> If you can think of a more concise name for this command, please send it in!
</p>

<p>
<b>Requires:</b> <a href="https://github.com/alphapapa/ts.el">ts</a>
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">require</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">ts</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">unpackaged/org-refile-to-datetree-using-ts-in-entry</span> <span style="color: #c678dd;">(</span><span style="color: #6b65c2f6d999;">which</span>-<span style="color: #91edb1e5c7aa;">ts</span> <span style="color: #918b91cd9132;">file</span> <span style="color: #ECBE7B;">&amp;optional</span> <span style="color: #ad489b408e50;">subtree</span>-<span style="color: #cf7ec31fb119;">p</span><span style="color: #c678dd;">)</span>
  <span style="color: #83898d; font-weight: bold; font-style: italic;">"Refile current entry to datetree in FILE using timestamp found in entry.</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">WHICH should be `</span><span style="color: #a9a1e1; font-weight: bold; font-style: italic;">earliest</span><span style="color: #83898d; font-weight: bold; font-style: italic;">' or `</span><span style="color: #a9a1e1; font-weight: bold; font-style: italic;">latest</span><span style="color: #83898d; font-weight: bold; font-style: italic;">'. If SUBTREE-P is non-nil,</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">search whole subtree."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span> <span style="color: #98be65;">(</span><span style="color: #e011a3efa386; text-decoration: underline;">list</span> <span style="color: #da8548;">(</span><span style="color: #918b91cd9132; text-decoration: underline;">intern</span> <span style="color: #a9a1e1;">(</span><span style="color: #6b65c2f6d999; text-decoration: underline;">completing</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">read</span> <span style="color: #98be65;">"Which timestamp? "</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">(</span><span style="color: #918b91cd9132;">earliest</span> <span style="color: #7765a7b4c89a;">latest</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span>
                     <span style="color: #da8548;">(</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">read</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">file</span><span style="text-decoration: underline;">-</span><span style="color: #87cfc690d6c9; text-decoration: underline;">name</span> <span style="color: #98be65;">"File: "</span> <span style="color: #a9a1e1;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">concat</span> <span style="color: #7765a7b4c89a;">org</span>-<span style="color: #cd7fcd65ce32;">directory</span> <span style="color: #98be65;">"/"</span><span style="color: #a9a1e1;">)</span> <span style="color: #cd7fcd65ce32;">nil</span> <span style="color: #51afef;">'</span><span style="color: #b3609a32bacd; font-style: italic;">mustmatch</span> <span style="color: #cd7fcd65ce32;">nil</span>
                                     <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #ECBE7B;">(</span><span style="color: #e011a3efa386;">filename</span><span style="color: #ECBE7B;">)</span>
                                       <span style="color: #ECBE7B;">(</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">string</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">suffix</span><span style="text-decoration: underline;">-</span><span style="color: #cf7ec31fb119; text-decoration: underline;">p</span> <span style="color: #98be65;">".org"</span> <span style="color: #e011a3efa386;">filename</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span>
                     <span style="color: #e1b3bbc0bb7e;">current</span>-<span style="color: #cd7fcd65ce32;">prefix</span>-<span style="color: #87cfc690d6c9;">arg</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let*</span> <span style="color: #98be65;">(</span><span style="color: #da8548;">(</span><span style="color: #91edb1e5c7aa;">sorter</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">pcase</span> <span style="color: #6b65c2f6d999;">which</span>-<span style="color: #91edb1e5c7aa;">ts</span>
                   <span style="color: #ECBE7B;">(</span><span style="color: #51afef;">'</span><span style="color: #918b91cd9132; font-style: italic;">earliest</span> <span style="color: #51afef;">#'</span><span style="color: #91edb1e5c7aa; font-style: italic;">ts</span><span style="color: #ECBE7B; font-style: italic;">&lt;</span><span style="color: #ECBE7B;">)</span>
                   <span style="color: #ECBE7B;">(</span><span style="color: #51afef;">'</span><span style="color: #7765a7b4c89a; font-style: italic;">latest</span> <span style="color: #51afef;">#'</span><span style="color: #91edb1e5c7aa; font-style: italic;">ts</span><span style="color: #ECBE7B; font-style: italic;">&gt;</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span>
         <span style="color: #da8548;">(</span><span style="color: #9e4c9e4c9e4c;">tss</span> <span style="color: #a9a1e1;">(</span><span style="color: #e1b3bbc0bb7e;">unpackaged</span>/<span style="color: #7765a7b4c89a;">org</span>-<span style="color: #7765a7b4c89a;">timestamps</span>-<span style="color: #e1b3bbc0bb7e;">in</span>-<span style="color: #e1b3bbc0bb7e;">entry</span> <span style="color: #ad489b408e50;">subtree</span>-<span style="color: #cf7ec31fb119;">p</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span>
         <span style="color: #da8548;">(</span><span style="color: #91edb1e5c7aa;">ts</span> <span style="color: #a9a1e1;">(</span><span style="color: #b3609a32bacd; text-decoration: underline;">car</span> <span style="color: #ECBE7B;">(</span><span style="color: #918b91cd9132; text-decoration: underline;">sort</span> <span style="color: #9e4c9e4c9e4c;">tss</span> <span style="color: #91edb1e5c7aa;">sorter</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span>
         <span style="color: #da8548;">(</span><span style="color: #b3609a32bacd;">date</span> <span style="color: #a9a1e1;">(</span><span style="color: #e011a3efa386; text-decoration: underline;">list</span> <span style="color: #ECBE7B;">(</span><span style="color: #91edb1e5c7aa;">ts</span>-<span style="color: #b3609a32bacd;">month</span> <span style="color: #91edb1e5c7aa;">ts</span><span style="color: #ECBE7B;">)</span> <span style="color: #ECBE7B;">(</span><span style="color: #91edb1e5c7aa;">ts</span>-<span style="color: #e011a3efa386;">day</span> <span style="color: #91edb1e5c7aa;">ts</span><span style="color: #ECBE7B;">)</span> <span style="color: #ECBE7B;">(</span><span style="color: #91edb1e5c7aa;">ts</span>-<span style="color: #6b65c2f6d999;">year</span> <span style="color: #91edb1e5c7aa;">ts</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #e1b3bbc0bb7e;">unpackaged</span>/<span style="color: #7765a7b4c89a;">org</span>-<span style="color: #cd7fcd65ce32;">refile</span>-<span style="color: #bae2b0b4bde3;">to</span>-<span style="color: #7765a7b4c89a;">datetree</span> <span style="color: #918b91cd9132;">file</span> <span style="color: #c678dd;">:date</span> <span style="color: #b3609a32bacd;">date</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">unpackaged/org-timestamps-in-entry</span> <span style="color: #c678dd;">(</span><span style="color: #ECBE7B;">&amp;optional</span> <span style="color: #ad489b408e50;">subtree</span>-<span style="color: #cf7ec31fb119;">p</span><span style="color: #c678dd;">)</span>
  <span style="color: #83898d; font-weight: bold; font-style: italic;">"Return timestamp objects for all Org timestamps in entry.</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;"> If SUBTREE-P is non-nil (interactively, with prefix), search</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;"> whole subtree."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span> <span style="color: #98be65;">(</span><span style="color: #e011a3efa386; text-decoration: underline;">list</span> <span style="color: #e1b3bbc0bb7e;">current</span>-<span style="color: #cd7fcd65ce32;">prefix</span>-<span style="color: #87cfc690d6c9;">arg</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">save-excursion</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">let*</span> <span style="color: #da8548;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #cd65b84f9999;">beg</span> <span style="color: #ECBE7B;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">entry</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">beginning</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">position</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span>
           <span style="color: #a9a1e1;">(</span><span style="color: #e1b3bbc0bb7e;">end</span> <span style="color: #ECBE7B;">(</span><span style="color: #51afef;">if</span> <span style="color: #ad489b408e50;">subtree</span>-<span style="color: #cf7ec31fb119;">p</span>
                    <span style="color: #4db5bd;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">end</span><span style="text-decoration: underline;">-</span><span style="color: #6b65c2f6d999; text-decoration: underline;">of</span><span style="text-decoration: underline;">-</span><span style="color: #ad489b408e50; text-decoration: underline;">subtree</span><span style="color: #4db5bd;">)</span>
                  <span style="color: #4db5bd;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">entry</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">end</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">position</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span>
      <span style="color: #da8548;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">char</span> <span style="color: #cd65b84f9999;">beg</span><span style="color: #da8548;">)</span>
      <span style="color: #da8548;">(</span><span style="color: #51afef;">cl-loop</span> <span style="color: #ad9a8c4c7464;">while</span> <span style="color: #a9a1e1;">(</span><span style="color: #cf7ec31fb119; text-decoration: underline;">re</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">search</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">forward</span> <span style="color: #7765a7b4c89a;">org</span>-<span style="color: #e1b3bbc0bb7e;">tsr</span>-<span style="color: #6b65c2f6d999;">regexp</span>-<span style="color: #ad9a8c4c7464;">both</span> <span style="color: #e1b3bbc0bb7e;">end</span> <span style="color: #bbe6ba32c7cd;">t</span><span style="color: #a9a1e1;">)</span>
               <span style="color: #91edb1e5c7aa;">for</span> <span style="color: #91edb1e5c7aa;">ts</span> = <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">save-excursion</span>
                          <span style="color: #ECBE7B;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">char</span> <span style="color: #4db5bd;">(</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">match</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">beginning</span> <span style="color: #87cfc690d6c9;">0</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span>
                          <span style="color: #ECBE7B;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #e011a3efa386; text-decoration: underline;">element</span><span style="text-decoration: underline;">-</span><span style="color: #bae2b0b4bde3; text-decoration: underline;">timestamp</span><span style="text-decoration: underline;">-</span><span style="color: #cf7ec31fb119; text-decoration: underline;">parser</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span>
               <span style="color: #cd7fcd65ce32;">collect</span> <span style="color: #a9a1e1;">(</span><span style="color: #91edb1e5c7aa;">ts</span>-<span style="color: #7765a7b4c89a;">parse</span>-<span style="color: #7765a7b4c89a;">org</span> <span style="color: #91edb1e5c7aa;">ts</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">cl-defun</span> <span style="color: #c678dd;">unpackaged/org-refile-to-datetree</span> <span style="color: #c678dd;">(</span><span style="color: #918b91cd9132;">file</span> <span style="color: #ECBE7B;">&amp;key</span> <span style="color: #98be65;">(</span><span style="color: #b3609a32bacd;">date</span> <span style="color: #da8548;">(</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">calendar</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">current</span><span style="text-decoration: underline;">-</span><span style="color: #b3609a32bacd; text-decoration: underline;">date</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span> <span style="color: #e1b3bbc0bb7e;">entry</span><span style="color: #c678dd;">)</span>
  <span style="color: #83898d; font-weight: bold; font-style: italic;">"Refile ENTRY or current node to entry for DATE in datetree in FILE."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span> <span style="color: #98be65;">(</span><span style="color: #e011a3efa386; text-decoration: underline;">list</span> <span style="color: #da8548;">(</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">read</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">file</span><span style="text-decoration: underline;">-</span><span style="color: #87cfc690d6c9; text-decoration: underline;">name</span> <span style="color: #98be65;">"File: "</span> <span style="color: #a9a1e1;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">concat</span> <span style="color: #7765a7b4c89a;">org</span>-<span style="color: #cd7fcd65ce32;">directory</span> <span style="color: #98be65;">"/"</span><span style="color: #a9a1e1;">)</span> <span style="color: #cd7fcd65ce32;">nil</span> <span style="color: #51afef;">'</span><span style="color: #b3609a32bacd; font-style: italic;">mustmatch</span> <span style="color: #cd7fcd65ce32;">nil</span>
                                     <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #ECBE7B;">(</span><span style="color: #e011a3efa386;">filename</span><span style="color: #ECBE7B;">)</span>
                                       <span style="color: #ECBE7B;">(</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">string</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">suffix</span><span style="text-decoration: underline;">-</span><span style="color: #cf7ec31fb119; text-decoration: underline;">p</span> <span style="color: #98be65;">".org"</span> <span style="color: #e011a3efa386;">filename</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">If org-datetree isn't loaded, it will cut the tree but not file</span>
  <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">it anywhere, losing data. I don't know why</span>
  <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">org-datetree-file-entry-under is in a separate package, not</span>
  <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">loaded with the rest of org-mode.</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">require</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">org-datetree</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">unless</span> <span style="color: #e1b3bbc0bb7e;">entry</span>
    <span style="color: #98be65;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">cut</span><span style="text-decoration: underline;">-</span><span style="color: #ad489b408e50; text-decoration: underline;">subtree</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Using a condition-case to be extra careful. In case the refile</span>
  <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">fails in any way, put cut subtree back.</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">condition-case</span> <span style="color: #cd65b84f9999;">err</span>
      <span style="color: #98be65;">(</span><span style="color: #51afef;">with-current-buffer</span> <span style="color: #da8548;">(</span><span style="color: #51afef;">or</span> <span style="color: #a9a1e1;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #cd65b84f9999; text-decoration: underline;">find</span><span style="text-decoration: underline;">-</span><span style="color: #6b65c2f6d999; text-decoration: underline;">base</span><span style="text-decoration: underline;">-</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">buffer</span><span style="text-decoration: underline;">-</span><span style="color: #7765a7b4c89a; text-decoration: underline;">visiting</span> <span style="color: #918b91cd9132;">file</span><span style="color: #a9a1e1;">)</span>
                               <span style="color: #a9a1e1;">(</span><span style="color: #cd65b84f9999; text-decoration: underline;">find</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">file</span><span style="text-decoration: underline;">-</span><span style="color: #6b65c2f6d999; text-decoration: underline;">noselect</span> <span style="color: #918b91cd9132;">file</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span>
        <span style="color: #da8548;">(</span><span style="color: #7765a7b4c89a;">org</span>-<span style="color: #7765a7b4c89a;">datetree</span>-<span style="color: #918b91cd9132;">file</span>-<span style="color: #e1b3bbc0bb7e;">entry</span>-<span style="color: #bae2b0b4bde3;">under</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">or</span> <span style="color: #e1b3bbc0bb7e;">entry</span> <span style="color: #ECBE7B;">(</span><span style="color: #b3609a32bacd; text-decoration: underline;">car</span> <span style="color: #9e4c9e4c9e4c;">kill</span>-<span style="color: #ad489b408e50;">ring</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #b3609a32bacd;">date</span><span style="color: #da8548;">)</span>
        <span style="color: #da8548;">(</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">save</span><span style="text-decoration: underline;">-</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">buffer</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #ECBE7B;">error</span> <span style="color: #da8548;">(</span><span style="color: #b3609a32bacd;">unless</span> <span style="color: #e1b3bbc0bb7e;">entry</span>
             <span style="color: #a9a1e1;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #6b65c2f6d999; text-decoration: underline;">paste</span><span style="text-decoration: underline;">-</span><span style="color: #ad489b408e50; text-decoration: underline;">subtree</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span>
           <span style="color: #da8548;">(</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">message</span> <span style="color: #98be65;">"Unable to refile!  %s"</span> <span style="color: #cd65b84f9999;">err</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd4c0eea" class="outline-3">
<h3 id="orgd4c0eea"><code>org-return-dwim</code></h3>
<div class="outline-text-3" id="text-orgd4c0eea">
<p>
A helpful replacement for <code>org-return</code>.  With prefix, call <code>org-return</code>.
</p>

<p>
On headings, move point to position after entry content.  In lists, insert a new item or end the list, with checkbox if appropriate.  In tables, insert a new row or end the table.
</p>

<p>
Inspired by <a href="http://kitchingroup.cheme.cmu.edu/blog/2017/04/09/A-better-return-in-org-mode/">John Kitchin</a>.
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">unpackaged/org-return-dwim</span> <span style="color: #c678dd;">(</span><span style="color: #ECBE7B;">&amp;optional</span> <span style="color: #bbe6ba32c7cd;">default</span><span style="color: #c678dd;">)</span>
  <span style="color: #83898d; font-weight: bold; font-style: italic;">"A helpful replacement for `</span><span style="color: #a9a1e1; font-weight: bold; font-style: italic;">org-return</span><span style="color: #83898d; font-weight: bold; font-style: italic;">'.  With prefix, call `</span><span style="color: #a9a1e1; font-weight: bold; font-style: italic;">org-return</span><span style="color: #83898d; font-weight: bold; font-style: italic;">'.</span>

<span style="color: #83898d; font-weight: bold; font-style: italic;">On headings, move point to position after entry content.  In</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">lists, insert a new item or end the list, with checkbox if</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">appropriate.  In tables, insert a new row or end the table."</span>
  <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Inspired by John Kitchin: http://kitchingroup.cheme.cmu.edu/blog/2017/04/09/A-better-return-in-org-mode/</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span> <span style="color: #98be65;">"P"</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #bbe6ba32c7cd;">default</span>
      <span style="color: #98be65;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #cd65b84f9999; text-decoration: underline;">return</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">cond</span>
     <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Act depending on context around point.</span>

     <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #2aa198;">NOTE</span><span style="color: #586e75; font-weight: bold; font-style: italic;">: I prefer RET to not follow links, but by uncommenting this block, links will be</span>
     <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">followed.</span>

     <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">((</span><span style="color: #586e75; font-weight: bold; font-style: italic; text-decoration: underline;">eq</span><span style="color: #586e75; font-weight: bold; font-style: italic;"> 'link (</span><span style="color: #586e75; font-weight: bold; font-style: italic; text-decoration: underline;">car</span><span style="color: #586e75; font-weight: bold; font-style: italic;"> (</span><span style="color: #586e75; font-weight: bold; font-style: italic; text-decoration: underline;">org-element-context</span><span style="color: #586e75; font-weight: bold; font-style: italic;">)))</span>
     <span style="color: #586e75; font-weight: bold; font-style: italic;">;;  </span><span style="color: #586e75; font-weight: bold; font-style: italic;">;; Link: Open it.</span>
     <span style="color: #586e75; font-weight: bold; font-style: italic;">;;  </span><span style="color: #586e75; font-weight: bold; font-style: italic;">(</span><span style="color: #586e75; font-weight: bold; font-style: italic; text-decoration: underline;">org-open-at-point-global</span><span style="color: #586e75; font-weight: bold; font-style: italic;">))</span>

     <span style="color: #da8548;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">at</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">heading</span><span style="text-decoration: underline;">-</span><span style="color: #cf7ec31fb119; text-decoration: underline;">p</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Heading: Move to position after entry content.</span>
      <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #2aa198;">NOTE</span><span style="color: #586e75; font-weight: bold; font-style: italic;">: This is probably the most interesting feature of this function.</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #ECBE7B;">(</span><span style="color: #4db5bd;">(</span><span style="color: #918b91cd9132;">heading</span>-<span style="color: #cd7fcd65ce32;">start</span> <span style="color: #a2b6da;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">entry</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">beginning</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">position</span><span style="color: #a2b6da;">)</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span>
        <span style="color: #ECBE7B;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">char</span> <span style="color: #4db5bd;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">entry</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">end</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">position</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span>
        <span style="color: #ECBE7B;">(</span><span style="color: #51afef;">cond</span> <span style="color: #4db5bd;">(</span><span style="color: #a2b6da;">(</span><span style="color: #51afef;">and</span> <span style="color: #9cb6ad;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">at</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">heading</span><span style="text-decoration: underline;">-</span><span style="color: #cf7ec31fb119; text-decoration: underline;">p</span><span style="color: #9cb6ad;">)</span>
                    <span style="color: #9cb6ad;">(</span>= <span style="color: #918b91cd9132;">heading</span>-<span style="color: #cd7fcd65ce32;">start</span> <span style="color: #51afef;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">entry</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">beginning</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">position</span><span style="color: #51afef;">)</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span>
               <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Entry ends on its heading; add newline after</span>
               <span style="color: #a2b6da;">(</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">end</span><span style="text-decoration: underline;">-</span><span style="color: #6b65c2f6d999; text-decoration: underline;">of</span><span style="text-decoration: underline;">-</span><span style="color: #e011a3efa386; text-decoration: underline;">line</span><span style="color: #a2b6da;">)</span>
               <span style="color: #a2b6da;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">insert</span> <span style="color: #98be65;">"\n\n"</span><span style="color: #a2b6da;">)</span><span style="color: #4db5bd;">)</span>
              <span style="color: #4db5bd;">(</span><span style="color: #bbe6ba32c7cd;">t</span>
               <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Entry ends after its heading; back up</span>
               <span style="color: #a2b6da;">(</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">forward</span><span style="text-decoration: underline;">-</span><span style="color: #e011a3efa386; text-decoration: underline;">line</span> -<span style="color: #91edb1e5c7aa;">1</span><span style="color: #a2b6da;">)</span>
               <span style="color: #a2b6da;">(</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">end</span><span style="text-decoration: underline;">-</span><span style="color: #6b65c2f6d999; text-decoration: underline;">of</span><span style="text-decoration: underline;">-</span><span style="color: #e011a3efa386; text-decoration: underline;">line</span><span style="color: #a2b6da;">)</span>
               <span style="color: #a2b6da;">(</span><span style="color: #51afef;">when</span> <span style="color: #9cb6ad;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">at</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">heading</span><span style="text-decoration: underline;">-</span><span style="color: #cf7ec31fb119; text-decoration: underline;">p</span><span style="color: #9cb6ad;">)</span>
                 <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">At the same heading</span>
                 <span style="color: #9cb6ad;">(</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">forward</span><span style="text-decoration: underline;">-</span><span style="color: #e011a3efa386; text-decoration: underline;">line</span><span style="color: #9cb6ad;">)</span>
                 <span style="color: #9cb6ad;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">insert</span> <span style="color: #98be65;">"\n"</span><span style="color: #9cb6ad;">)</span>
                 <span style="color: #9cb6ad;">(</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">forward</span><span style="text-decoration: underline;">-</span><span style="color: #e011a3efa386; text-decoration: underline;">line</span> -<span style="color: #91edb1e5c7aa;">1</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span>
               <span style="color: #a2b6da;">(</span><span style="color: #51afef;">while</span> <span style="color: #9cb6ad;">(</span><span style="color: #cb4b16; font-weight: bold;">not</span> <span style="color: #51afef;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">looking</span><span style="text-decoration: underline;">-</span><span style="color: #6b65c2f6d999; text-decoration: underline;">back</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">rx</span> <span style="color: #98be65;">(</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">repeat</span> <span style="color: #91edb1e5c7aa;">3</span> <span style="color: #da8548;">(</span><span style="color: #cd7fcd65ce32;">seq</span> <span style="color: #a9a1e1;">(</span><span style="color: #cd65b84f9999;">optional</span> <span style="color: #e1b3bbc0bb7e;">blank</span><span style="color: #a9a1e1;">)</span> <span style="color: #98be65;">"\n"</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #9cb6ad;">)</span>
                 <span style="color: #9cb6ad;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">insert</span> <span style="color: #98be65;">"\n"</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span>
               <span style="color: #a2b6da;">(</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">forward</span><span style="text-decoration: underline;">-</span><span style="color: #e011a3efa386; text-decoration: underline;">line</span> -<span style="color: #91edb1e5c7aa;">1</span><span style="color: #a2b6da;">)</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span>

     <span style="color: #da8548;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">at</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">item</span><span style="text-decoration: underline;">-</span><span style="color: #b3609a32bacd; text-decoration: underline;">checkbox</span><span style="text-decoration: underline;">-</span><span style="color: #cf7ec31fb119; text-decoration: underline;">p</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Checkbox: Insert new item with checkbox.</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">insert</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">todo</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">heading</span> <span style="color: #cd7fcd65ce32;">nil</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span>

     <span style="color: #da8548;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">in</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">item</span><span style="text-decoration: underline;">-</span><span style="color: #cf7ec31fb119; text-decoration: underline;">p</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Plain list</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">cond</span> <span style="color: #ECBE7B;">(</span><span style="color: #4db5bd;">(</span><span style="color: #51afef;">save-excursion</span>
               <span style="color: #a2b6da;">(</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">end</span><span style="text-decoration: underline;">-</span><span style="color: #6b65c2f6d999; text-decoration: underline;">of</span><span style="text-decoration: underline;">-</span><span style="color: #e011a3efa386; text-decoration: underline;">line</span><span style="color: #a2b6da;">)</span>
               <span style="color: #a2b6da;">(</span><span style="color: #cb4b16; font-weight: bold;">not</span> <span style="color: #9cb6ad;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #e011a3efa386; text-decoration: underline;">element</span><span style="text-decoration: underline;">-</span><span style="color: #87cfc690d6c9; text-decoration: underline;">property</span> <span style="color: #c678dd;">:contents-begin</span> <span style="color: #51afef;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #e011a3efa386; text-decoration: underline;">element</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">context</span><span style="color: #51afef;">)</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #4db5bd;">)</span>
             <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Empty item: Close the list.</span>

             <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #859900;">TODO</span><span style="color: #586e75; font-weight: bold; font-style: italic;">: Do this with org functions rather than operating on the text. Can't seem to</span>
             <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">find the right function.</span>
             <span style="color: #4db5bd;">(</span><span style="color: #e011a3efa386; text-decoration: underline;">delete</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">region</span> <span style="color: #a2b6da;">(</span><span style="color: #e011a3efa386; text-decoration: underline;">line</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">beginning</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">position</span><span style="color: #a2b6da;">)</span> <span style="color: #a2b6da;">(</span><span style="color: #e011a3efa386; text-decoration: underline;">line</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">end</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">position</span><span style="color: #a2b6da;">)</span><span style="color: #4db5bd;">)</span>
             <span style="color: #4db5bd;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">insert</span> <span style="color: #98be65;">"\n"</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span>
            <span style="color: #ECBE7B;">(</span><span style="color: #bbe6ba32c7cd;">t</span>
             <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Non-empty item: Add new item.</span>
             <span style="color: #4db5bd;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">insert</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">heading</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span>

     <span style="color: #da8548;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">when</span> <span style="color: #ECBE7B;">(</span><span style="color: #918b91cd9132; text-decoration: underline;">fboundp</span> <span style="color: #51afef;">'</span><span style="color: #7765a7b4c89a; font-style: italic;">org</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #b3609a32bacd; font-style: italic;">inlinetask</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #e1b3bbc0bb7e; font-style: italic;">in</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #ad489b408e50; font-style: italic;">task</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #cf7ec31fb119; font-style: italic;">p</span><span style="color: #ECBE7B;">)</span>
        <span style="color: #ECBE7B;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #b3609a32bacd; text-decoration: underline;">inlinetask</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">in</span><span style="text-decoration: underline;">-</span><span style="color: #ad489b408e50; text-decoration: underline;">task</span><span style="text-decoration: underline;">-</span><span style="color: #cf7ec31fb119; text-decoration: underline;">p</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Inline task: Don't insert a new heading.</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #cd65b84f9999; text-decoration: underline;">return</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span>

     <span style="color: #da8548;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">at</span><span style="text-decoration: underline;">-</span><span style="color: #b3609a32bacd; text-decoration: underline;">table</span><span style="text-decoration: underline;">-</span><span style="color: #cf7ec31fb119; text-decoration: underline;">p</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">cond</span> <span style="color: #ECBE7B;">(</span><span style="color: #4db5bd;">(</span><span style="color: #51afef;">save-excursion</span>
               <span style="color: #a2b6da;">(</span><span style="color: #918b91cd9132; text-decoration: underline;">beginning</span><span style="text-decoration: underline;">-</span><span style="color: #6b65c2f6d999; text-decoration: underline;">of</span><span style="text-decoration: underline;">-</span><span style="color: #e011a3efa386; text-decoration: underline;">line</span><span style="color: #a2b6da;">)</span>
               <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">See `</span><span style="color: #a9a1e1; font-weight: bold; font-style: italic;">org-table-next-field</span><span style="color: #586e75; font-weight: bold; font-style: italic;">'.</span>
               <span style="color: #a2b6da;">(</span><span style="color: #51afef;">cl-loop</span> <span style="color: #cd7fcd65ce32;">with</span> <span style="color: #e1b3bbc0bb7e;">end</span> = <span style="color: #9cb6ad;">(</span><span style="color: #e011a3efa386; text-decoration: underline;">line</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">end</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">position</span><span style="color: #9cb6ad;">)</span>
                        <span style="color: #91edb1e5c7aa;">for</span> <span style="color: #87cfc690d6c9;">cell</span> = <span style="color: #9cb6ad;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #e011a3efa386; text-decoration: underline;">element</span><span style="text-decoration: underline;">-</span><span style="color: #b3609a32bacd; text-decoration: underline;">table</span><span style="text-decoration: underline;">-</span><span style="color: #87cfc690d6c9; text-decoration: underline;">cell</span><span style="text-decoration: underline;">-</span><span style="color: #cf7ec31fb119; text-decoration: underline;">parser</span><span style="color: #9cb6ad;">)</span>
                        <span style="color: #918b91cd9132;">always</span> <span style="color: #9cb6ad;">(</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">equal</span> <span style="color: #51afef;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #e011a3efa386; text-decoration: underline;">element</span><span style="text-decoration: underline;">-</span><span style="color: #87cfc690d6c9; text-decoration: underline;">property</span> <span style="color: #c678dd;">:contents-begin</span> <span style="color: #87cfc690d6c9;">cell</span><span style="color: #51afef;">)</span>
                                      <span style="color: #51afef;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #e011a3efa386; text-decoration: underline;">element</span><span style="text-decoration: underline;">-</span><span style="color: #87cfc690d6c9; text-decoration: underline;">property</span> <span style="color: #c678dd;">:contents-end</span> <span style="color: #87cfc690d6c9;">cell</span><span style="color: #51afef;">)</span><span style="color: #9cb6ad;">)</span>
                        <span style="color: #ad9a8c4c7464;">while</span> <span style="color: #9cb6ad;">(</span><span style="color: #cf7ec31fb119; text-decoration: underline;">re</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">search</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">forward</span> <span style="color: #98be65;">"|"</span> <span style="color: #e1b3bbc0bb7e;">end</span> <span style="color: #bbe6ba32c7cd;">t</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #4db5bd;">)</span>
             <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Empty row: end the table.</span>
             <span style="color: #4db5bd;">(</span><span style="color: #e011a3efa386; text-decoration: underline;">delete</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">region</span> <span style="color: #a2b6da;">(</span><span style="color: #e011a3efa386; text-decoration: underline;">line</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">beginning</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">position</span><span style="color: #a2b6da;">)</span> <span style="color: #a2b6da;">(</span><span style="color: #e011a3efa386; text-decoration: underline;">line</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">end</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">position</span><span style="color: #a2b6da;">)</span><span style="color: #4db5bd;">)</span>
             <span style="color: #4db5bd;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #cd65b84f9999; text-decoration: underline;">return</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span>
            <span style="color: #ECBE7B;">(</span><span style="color: #bbe6ba32c7cd;">t</span>
             <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Non-empty row: call `</span><span style="color: #a9a1e1; font-weight: bold; font-style: italic;">org-return</span><span style="color: #586e75; font-weight: bold; font-style: italic;">'.</span>
             <span style="color: #4db5bd;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #cd65b84f9999; text-decoration: underline;">return</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span>
     <span style="color: #da8548;">(</span><span style="color: #bbe6ba32c7cd;">t</span>
      <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">All other cases: call `</span><span style="color: #a9a1e1; font-weight: bold; font-style: italic;">org-return</span><span style="color: #586e75; font-weight: bold; font-style: italic;">'.</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #cd65b84f9999; text-decoration: underline;">return</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge00df26" class="outline-3">
<h3 id="orge00df26">Read-only trees</h3>
<div class="outline-text-3" id="text-orge00df26">
<p>
This code applies the <code>read-only</code> text-property to trees tagged <code>read_only</code>, preventing them from being modified accidentally.  (Note: If read-only headings appear in an Agenda buffer, it can cause slightly unusual behavior.  Usually this is not an issue.)  This was originally inspired by John Kitchin's <a href="http://kitchingroup.cheme.cmu.edu/blog/2014/09/13/Make-some-org-sections-read-only/">blog article</a> and later <a href="https://www.reddit.com/r/emacs/comments/92k7n1/guide_to_profiling_and_optimizing_an_orgrelated/">rewritten</a> in a faster version.
</p>

<p>
To use, load these functions, and then add to this hook to automatically mark read-only sections when an Org file is loaded:
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #51afef;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">add</span><span style="text-decoration: underline;">-</span><span style="color: #e011a3efa386; text-decoration: underline;">hook</span> <span style="color: #51afef;">'</span><span style="color: #7765a7b4c89a; font-style: italic;">org</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #87cfc690d6c9; font-style: italic;">mode</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #e011a3efa386; font-style: italic;">hook</span> <span style="color: #51afef;">'</span><span style="color: #e1b3bbc0bb7e; font-style: italic;">unpackaged</span><span style="color: #ECBE7B; font-style: italic;">/</span><span style="color: #7765a7b4c89a; font-style: italic;">org</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #6b65c2f6d999; font-style: italic;">mark</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #e1b3bbc0bb7e; font-style: italic;">read</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #91edb1e5c7aa; font-style: italic;">only</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
The functions may also be called interactively as needed.
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">unpackaged/org-next-heading-tagged</span> <span style="color: #c678dd;">(</span><span style="color: #918b91cd9132;">tag</span><span style="color: #c678dd;">)</span>
  <span style="color: #83898d; font-weight: bold; font-style: italic;">"Move to beginning of next heading tagged with TAG and return point, or return nil if none found."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> <span style="color: #98be65;">(</span><span style="color: #cf7ec31fb119; text-decoration: underline;">re</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">search</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">forward</span> <span style="color: #da8548;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">rx</span><span style="text-decoration: underline;">-</span><span style="color: #bae2b0b4bde3; text-decoration: underline;">to</span><span style="text-decoration: underline;">-</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">string</span> <span style="color: #51afef;">`</span><span style="color: #a9a1e1;">(</span><span style="color: #cd7fcd65ce32;">seq</span> <span style="color: #91edb1e5c7aa;">bol</span> <span style="color: #ECBE7B;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">1</span><span style="text-decoration: underline;">+</span> <span style="color: #98be65;">"*"</span><span style="color: #ECBE7B;">)</span> <span style="color: #ECBE7B;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">1</span><span style="text-decoration: underline;">+</span> <span style="color: #e1b3bbc0bb7e;">blank</span><span style="color: #ECBE7B;">)</span> <span style="color: #ECBE7B;">(</span><span style="color: #cd65b84f9999;">optional</span> <span style="color: #4db5bd;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">1</span><span style="text-decoration: underline;">+</span> <span style="color: #7765a7b4c89a;">not</span>-<span style="color: #6b65c2f6d999;">newline</span><span style="color: #4db5bd;">)</span> <span style="color: #4db5bd;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">1</span><span style="text-decoration: underline;">+</span> <span style="color: #e1b3bbc0bb7e;">blank</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span>
                                               <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Beginning of tags</span>
                                               <span style="color: #98be65;">":"</span>
                                               <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Possible other tags</span>
                                               <span style="color: #ECBE7B;">(</span><span style="color: #87cfc690d6c9;">0</span>+ <span style="color: #4db5bd;">(</span><span style="color: #cd7fcd65ce32;">seq</span> <span style="color: #a2b6da;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">1</span><span style="text-decoration: underline;">+</span> <span style="color: #9cb6ad;">(</span><span style="color: #cb4b16; font-weight: bold;">not</span> <span style="color: #51afef;">(</span><span style="color: #ad9a8c4c7464;">any</span> <span style="color: #98be65;">":"</span> <span style="color: #e1b3bbc0bb7e;">blank</span><span style="color: #51afef;">)</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span> <span style="color: #98be65;">":"</span><span style="color: #4db5bd;">)</span> <span style="color: #ECBE7B;">)</span>
                                               <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">The tag that matters</span>
                                               ,<span style="color: #918b91cd9132;">tag</span> <span style="color: #98be65;">":"</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span>
                           <span style="color: #cd7fcd65ce32;">nil</span> <span style="color: #51afef;">'</span><span style="color: #6b65c2f6d999; font-style: italic;">noerror</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">char</span> <span style="color: #da8548;">(</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">match</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">beginning</span> <span style="color: #87cfc690d6c9;">0</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">unpackaged/org-mark-read-only</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d; font-weight: bold; font-style: italic;">"Mark all entries in the buffer tagged \"read_only\" with read-only text properties."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">org-with-wide-buffer</span>
   <span style="color: #98be65;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">char</span> <span style="color: #da8548;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #b3609a32bacd; text-decoration: underline;">min</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span>
   <span style="color: #98be65;">(</span><span style="color: #51afef;">while</span> <span style="color: #da8548;">(</span><span style="color: #e1b3bbc0bb7e;">unpackaged</span>/<span style="color: #7765a7b4c89a;">org</span>-<span style="color: #918b91cd9132;">next</span>-<span style="color: #918b91cd9132;">heading</span>-<span style="color: #9e4c9e4c9e4c;">tagged</span> <span style="color: #98be65;">"read_only"</span><span style="color: #da8548;">)</span>
     <span style="color: #da8548;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">add</span><span style="text-decoration: underline;">-</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">text</span><span style="text-decoration: underline;">-</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">properties</span> <span style="color: #a9a1e1;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">point</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">end</span><span style="text-decoration: underline;">-</span><span style="color: #6b65c2f6d999; text-decoration: underline;">of</span><span style="text-decoration: underline;">-</span><span style="color: #ad489b408e50; text-decoration: underline;">subtree</span> <span style="color: #bbe6ba32c7cd;">t</span><span style="color: #a9a1e1;">)</span>
                          <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">(</span><span style="color: #e1b3bbc0bb7e;">read</span>-<span style="color: #91edb1e5c7aa;">only</span> <span style="color: #bbe6ba32c7cd;">t</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">unpackaged/org-remove-read-only</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d; font-weight: bold; font-style: italic;">"Remove read-only text properties from Org entries tagged \"read_only\" in current buffer."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #da8548;">(</span><span style="color: #7765a7b4c89a;">inhibit</span>-<span style="color: #e1b3bbc0bb7e;">read</span>-<span style="color: #91edb1e5c7aa;">only</span> <span style="color: #bbe6ba32c7cd;">t</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">org-with-wide-buffer</span>
     <span style="color: #da8548;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">char</span> <span style="color: #a9a1e1;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #b3609a32bacd; text-decoration: underline;">min</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span>
     <span style="color: #da8548;">(</span><span style="color: #51afef;">while</span> <span style="color: #a9a1e1;">(</span><span style="color: #e1b3bbc0bb7e;">unpackaged</span>/<span style="color: #7765a7b4c89a;">org</span>-<span style="color: #918b91cd9132;">next</span>-<span style="color: #918b91cd9132;">heading</span>-<span style="color: #9e4c9e4c9e4c;">tagged</span> <span style="color: #98be65;">"read_only"</span><span style="color: #a9a1e1;">)</span>
       <span style="color: #a9a1e1;">(</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">remove</span><span style="text-decoration: underline;">-</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">text</span><span style="text-decoration: underline;">-</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">properties</span> <span style="color: #ECBE7B;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">point</span><span style="color: #ECBE7B;">)</span> <span style="color: #ECBE7B;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">end</span><span style="text-decoration: underline;">-</span><span style="color: #6b65c2f6d999; text-decoration: underline;">of</span><span style="text-decoration: underline;">-</span><span style="color: #ad489b408e50; text-decoration: underline;">subtree</span> <span style="color: #bbe6ba32c7cd;">t</span><span style="color: #ECBE7B;">)</span>
                               <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">(</span><span style="color: #e1b3bbc0bb7e;">read</span>-<span style="color: #91edb1e5c7aa;">only</span> <span style="color: #bbe6ba32c7cd;">t</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf7e9657" class="outline-3">
<h3 id="orgf7e9657">Sort tree by multiple methods at once</h3>
<div class="outline-text-3" id="text-orgf7e9657">
<p>
Call <code>org-sort-entries</code> with multiple sorting methods specified in <code>KEYS</code>.
</p>

<p>
This is much easier than doing <kbd>C-c ^ KEY</kbd> several times in a row.
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">unpackaged/org-sort-multi</span> <span style="color: #c678dd;">(</span><span style="color: #91edb1e5c7aa;">keys</span><span style="color: #c678dd;">)</span>
    <span style="color: #83898d; font-weight: bold; font-style: italic;">"Call `</span><span style="color: #a9a1e1; font-weight: bold; font-style: italic;">org-sort-entries</span><span style="color: #83898d; font-weight: bold; font-style: italic;">' with multiple sorting methods specified in KEYS."</span>
    <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Message copied from `</span><span style="color: #a9a1e1; font-weight: bold; font-style: italic;">org-sort-entries</span><span style="color: #586e75; font-weight: bold; font-style: italic;">'.</span>
    <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span> <span style="color: #98be65;">(</span><span style="color: #e011a3efa386; text-decoration: underline;">list</span> <span style="color: #da8548;">(</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">read</span><span style="text-decoration: underline;">-</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">string</span> <span style="color: #98be65;">"Sort by: [a]lpha  [n]umeric  [p]riority  p[r]operty  todo[o]rder  [f]unc</span>
<span style="color: #98be65;">         [t]ime [s]cheduled  [d]eadline  [c]reated  cloc[k]ing</span>
<span style="color: #98be65;">         A/N/P/R/O/F/T/S/D/C/K means reversed: "</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
    <span style="color: #c678dd;">(</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">seq</span><span style="text-decoration: underline;">-</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">do</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #da8548;">(</span><span style="color: #bae2b0b4bde3;">key</span><span style="color: #da8548;">)</span>
              <span style="color: #da8548;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">sort</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">entries</span> <span style="color: #cd7fcd65ce32;">nil</span> <span style="color: #bae2b0b4bde3;">key</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span>
            <span style="color: #98be65;">(</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">nreverse</span> <span style="color: #91edb1e5c7aa;">keys</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc4a49cc" class="outline-2">
<h2 id="orgc4a49cc">Packages&#xa0;&#xa0;&#xa0;<span class="tag"><span class="packages">packages</span></span></h2>
<div class="outline-text-2" id="text-orgc4a49cc">
</div><div id="outline-container-org91403d5" class="outline-3">
<h3 id="org91403d5"><code>package-menu-upgrade-package</code>: Upgrade one package</h3>
<div class="outline-text-3" id="text-org91403d5">
<p>
Mark current package for upgrading (i.e. also mark obsolete version for deletion.)
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">use-package</span> <span style="color: #a9a1e1;">package</span>
  <span style="color: #c678dd;">:bind</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">:map</span> <span style="color: #9e4c9e4c9e4c;">package</span>-<span style="color: #ad489b408e50;">menu</span>-<span style="color: #87cfc690d6c9;">mode</span>-<span style="color: #cf7ec31fb119;">map</span>
              <span style="color: #98be65;">(</span><span style="color: #98be65;">"t"</span> . <span style="color: #51afef;">#'</span><span style="color: #9e4c9e4c9e4c; font-style: italic;">package</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #ad489b408e50; font-style: italic;">menu</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #cd7fcd65ce32; font-style: italic;">upgrade</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #9e4c9e4c9e4c; font-style: italic;">package</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">:config</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">package-menu-upgrade-package</span> <span style="color: #98be65;">()</span>
    <span style="color: #83898d; font-weight: bold; font-style: italic;">"Mark current package for upgrading (i.e. also mark obsolete version for deletion.)"</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">interactive</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">when-let</span> <span style="color: #da8548;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #e011a3efa386;">upgrades</span> <span style="color: #ECBE7B;">(</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">package</span><span style="text-decoration: underline;">-</span><span style="color: #ad489b408e50; text-decoration: underline;">menu</span><span style="text-decoration: underline;">--</span><span style="color: #cd65b84f9999; text-decoration: underline;">find</span><span style="text-decoration: underline;">-</span><span style="color: #e011a3efa386; text-decoration: underline;">upgrades</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span>
               <span style="color: #a9a1e1;">(</span><span style="color: #9e4c9e4c9e4c;">description</span> <span style="color: #ECBE7B;">(</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">tabulated</span><span style="text-decoration: underline;">-</span><span style="color: #e011a3efa386; text-decoration: underline;">list</span><span style="text-decoration: underline;">-</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">get</span><span style="text-decoration: underline;">-</span><span style="color: #e011a3efa386; text-decoration: underline;">id</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span>
               <span style="color: #a9a1e1;">(</span><span style="color: #87cfc690d6c9;">name</span> <span style="color: #ECBE7B;">(</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">package</span><span style="text-decoration: underline;">-</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">desc</span><span style="text-decoration: underline;">-</span><span style="color: #87cfc690d6c9; text-decoration: underline;">name</span> <span style="color: #9e4c9e4c9e4c;">description</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span>
               <span style="color: #a9a1e1;">(</span><span style="color: #ad9a8c4c7464;">upgradable</span> <span style="color: #ECBE7B;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">cdr</span> <span style="color: #4db5bd;">(</span><span style="color: #e011a3efa386; text-decoration: underline;">assq</span> <span style="color: #87cfc690d6c9;">name</span> <span style="color: #e011a3efa386;">upgrades</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span>
      <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Package is upgradable</span>
      <span style="color: #da8548;">(</span><span style="color: #51afef;">save-excursion</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">char</span> <span style="color: #ECBE7B;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #b3609a32bacd; text-decoration: underline;">min</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">while</span> <span style="color: #ECBE7B;">(</span><span style="color: #cb4b16; font-weight: bold;">not</span> <span style="color: #4db5bd;">(</span><span style="color: #cd65b84f9999; text-decoration: underline;">eobp</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span>
          <span style="color: #ECBE7B;">(</span><span style="color: #51afef;">let*</span> <span style="color: #4db5bd;">(</span><span style="color: #a2b6da;">(</span><span style="color: #e1b3bbc0bb7e;">current</span>-<span style="color: #9e4c9e4c9e4c;">description</span> <span style="color: #9cb6ad;">(</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">tabulated</span><span style="text-decoration: underline;">-</span><span style="color: #e011a3efa386; text-decoration: underline;">list</span><span style="text-decoration: underline;">-</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">get</span><span style="text-decoration: underline;">-</span><span style="color: #e011a3efa386; text-decoration: underline;">id</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span>
                 <span style="color: #a2b6da;">(</span><span style="color: #e1b3bbc0bb7e;">current</span>-<span style="color: #87cfc690d6c9;">name</span> <span style="color: #9cb6ad;">(</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">package</span><span style="text-decoration: underline;">-</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">desc</span><span style="text-decoration: underline;">-</span><span style="color: #87cfc690d6c9; text-decoration: underline;">name</span> <span style="color: #e1b3bbc0bb7e;">current</span>-<span style="color: #9e4c9e4c9e4c;">description</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #4db5bd;">)</span>
            <span style="color: #4db5bd;">(</span><span style="color: #51afef;">when</span> <span style="color: #a2b6da;">(</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">equal</span> <span style="color: #e1b3bbc0bb7e;">current</span>-<span style="color: #87cfc690d6c9;">name</span> <span style="color: #87cfc690d6c9;">name</span><span style="color: #a2b6da;">)</span>
              <span style="color: #a2b6da;">(</span><span style="color: #51afef;">cond</span> <span style="color: #9cb6ad;">(</span><span style="color: #51afef;">(</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">equal</span> <span style="color: #9e4c9e4c9e4c;">description</span> <span style="color: #e1b3bbc0bb7e;">current</span>-<span style="color: #9e4c9e4c9e4c;">description</span><span style="color: #51afef;">)</span>
                     <span style="color: #51afef;">(</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">package</span><span style="text-decoration: underline;">-</span><span style="color: #ad489b408e50; text-decoration: underline;">menu</span><span style="text-decoration: underline;">-</span><span style="color: #6b65c2f6d999; text-decoration: underline;">mark</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">install</span><span style="color: #51afef;">)</span>
                     <span style="color: #51afef;">(</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">forward</span><span style="text-decoration: underline;">-</span><span style="color: #e011a3efa386; text-decoration: underline;">line</span> -<span style="color: #91edb1e5c7aa;">1</span><span style="color: #51afef;">)</span><span style="color: #9cb6ad;">)</span>
                    <span style="color: #9cb6ad;">(</span><span style="color: #bbe6ba32c7cd;">t</span> <span style="color: #51afef;">(</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">package</span><span style="text-decoration: underline;">-</span><span style="color: #ad489b408e50; text-decoration: underline;">menu</span><span style="text-decoration: underline;">-</span><span style="color: #6b65c2f6d999; text-decoration: underline;">mark</span><span style="text-decoration: underline;">-</span><span style="color: #e011a3efa386; text-decoration: underline;">delete</span><span style="color: #51afef;">)</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span>
          <span style="color: #ECBE7B;">(</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">forward</span><span style="text-decoration: underline;">-</span><span style="color: #e011a3efa386; text-decoration: underline;">line</span> <span style="color: #91edb1e5c7aa;">1</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org0b0fcd2" class="outline-2">
<h2 id="org0b0fcd2">Programming&#xa0;&#xa0;&#xa0;<span class="tag"><span class="programming">programming</span></span></h2>
<div class="outline-text-2" id="text-org0b0fcd2">
</div><div id="outline-container-org9b47f9e" class="outline-3">
<h3 id="org9b47f9e"><code>iedit</code>&#xa0;&#xa0;&#xa0;<span class="tag"><span class="iedit">iedit</span>&#xa0;<span class="refactoring">refactoring</span></span></h3>
<div class="outline-text-3" id="text-org9b47f9e">
<p>
These commands make <code>iedit-mode</code> a bit easier to use.
</p>
</div>

<div id="outline-container-orgab7ada4" class="outline-4">
<h4 id="orgab7ada4"><code>iedit-scoped</code></h4>
<div class="outline-text-4" id="text-orgab7ada4">
<p>
Call <code>iedit-mode</code> with function-local scope, or global scope if called with a universal prefix.
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">unpackaged/iedit-scoped</span> <span style="color: #c678dd;">(</span><span style="color: #87cfc690d6c9;">orig</span>-<span style="color: #7765a7b4c89a;">fn</span><span style="color: #c678dd;">)</span>
  <span style="color: #83898d; font-weight: bold; font-style: italic;">"Call `</span><span style="color: #a9a1e1; font-weight: bold; font-style: italic;">iedit-mode</span><span style="color: #83898d; font-weight: bold; font-style: italic;">' with function-local scope, or global scope if called with a universal prefix."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">pcase-exhaustive</span> <span style="color: #e1b3bbc0bb7e;">current</span>-<span style="color: #cd7fcd65ce32;">prefix</span>-<span style="color: #87cfc690d6c9;">arg</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">'</span><span style="color: #cd7fcd65ce32; font-style: italic;">nil</span> <span style="color: #da8548;">(</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">funcall</span> <span style="color: #87cfc690d6c9;">orig</span>-<span style="color: #7765a7b4c89a;">fn</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">(</span><span style="color: #87cfc690d6c9;">0</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">'</span><span style="color: #da8548;">(</span><span style="color: #9e4c9e4c9e4c;">4</span><span style="color: #da8548;">)</span> <span style="color: #da8548;">(</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">funcall</span> <span style="color: #87cfc690d6c9;">orig</span>-<span style="color: #7765a7b4c89a;">fn</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #918b91cd9132; text-decoration: underline;">advice</span><span style="text-decoration: underline;">-</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">add</span> <span style="color: #51afef;">#'</span><span style="color: #b3609a32bacd; font-style: italic;">iedit</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #87cfc690d6c9; font-style: italic;">mode</span> <span style="color: #c678dd;">:around</span> <span style="color: #51afef;">#'</span><span style="color: #e1b3bbc0bb7e; font-style: italic;">unpackaged</span><span style="color: #ECBE7B; font-style: italic;">/</span><span style="color: #b3609a32bacd; font-style: italic;">iedit</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #918b91cd9132; font-style: italic;">scoped</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org85c7aed" class="outline-4">
<h4 id="org85c7aed"><code>iedit-or-flyspell</code>&#xa0;&#xa0;&#xa0;<span class="tag"><span class="flyspell">flyspell</span>&#xa0;<span class="spell_checking">spell_checking</span></span></h4>
<div class="outline-text-4" id="text-org85c7aed">
<p>
Toggle <code>iedit-mode</code> or correct previous misspelling with <code>flyspell</code>, depending on context.
</p>

<p>
With point in code or when <code>iedit-mode</code> is already active, toggle <code>iedit-mode</code>.  With point in a comment or string, and when <code>iedit-mode</code> is not already active, auto-correct previous misspelled word with <code>flyspell</code>.  Call this command a second time to choose a different correction.
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">unpackaged/iedit-or-flyspell</span> <span style="color: #c678dd;">()</span>
  <span style="color: #83898d; font-weight: bold; font-style: italic;">"Toggle `</span><span style="color: #a9a1e1; font-weight: bold; font-style: italic;">iedit-mode</span><span style="color: #83898d; font-weight: bold; font-style: italic;">' or correct previous misspelling with `</span><span style="color: #a9a1e1; font-weight: bold; font-style: italic;">flyspell</span><span style="color: #83898d; font-weight: bold; font-style: italic;">', depending on context.</span>

<span style="color: #83898d; font-weight: bold; font-style: italic;">With point in code or when `</span><span style="color: #a9a1e1; font-weight: bold; font-style: italic;">iedit-mode</span><span style="color: #83898d; font-weight: bold; font-style: italic;">' is already active, toggle</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">`</span><span style="color: #a9a1e1; font-weight: bold; font-style: italic;">iedit-mode</span><span style="color: #83898d; font-weight: bold; font-style: italic;">'.  With point in a comment or string, and when</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">`</span><span style="color: #a9a1e1; font-weight: bold; font-style: italic;">iedit-mode</span><span style="color: #83898d; font-weight: bold; font-style: italic;">' is not already active, auto-correct previous</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">misspelled word with `</span><span style="color: #a9a1e1; font-weight: bold; font-style: italic;">flyspell</span><span style="color: #83898d; font-weight: bold; font-style: italic;">'.  Call this command a second time</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">to choose a different correction."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">or</span> <span style="color: #b3609a32bacd;">iedit</span>-<span style="color: #87cfc690d6c9;">mode</span>
          <span style="color: #da8548;">(</span><span style="color: #51afef;">and</span> <span style="color: #a9a1e1;">(</span><span style="color: #b3609a32bacd; text-decoration: underline;">derived</span><span style="text-decoration: underline;">-</span><span style="color: #87cfc690d6c9; text-decoration: underline;">mode</span><span style="text-decoration: underline;">-</span><span style="color: #cf7ec31fb119; text-decoration: underline;">p</span> <span style="color: #51afef;">'</span><span style="color: #bbe6ba32c7cd; font-style: italic;">prog</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #87cfc690d6c9; font-style: italic;">mode</span><span style="color: #a9a1e1;">)</span>
               <span style="color: #a9a1e1;">(</span><span style="color: #cb4b16; font-weight: bold;">not</span> <span style="color: #ECBE7B;">(</span><span style="color: #51afef;">or</span> <span style="color: #4db5bd;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">nth</span> <span style="color: #9e4c9e4c9e4c;">4</span> <span style="color: #a2b6da;">(</span><span style="color: #918b91cd9132; text-decoration: underline;">syntax</span><span style="text-decoration: underline;">-</span><span style="color: #7765a7b4c89a; text-decoration: underline;">ppss</span><span style="color: #a2b6da;">)</span><span style="color: #4db5bd;">)</span>
                        <span style="color: #4db5bd;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">nth</span> <span style="color: #91edb1e5c7aa;">3</span> <span style="color: #a2b6da;">(</span><span style="color: #918b91cd9132; text-decoration: underline;">syntax</span><span style="text-decoration: underline;">-</span><span style="color: #7765a7b4c89a; text-decoration: underline;">ppss</span><span style="color: #a2b6da;">)</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span>
      <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">prog-mode is active and point is in a comment, string, or</span>
      <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">already in iedit-mode</span>
      <span style="color: #98be65;">(</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">call</span><span style="text-decoration: underline;">-</span><span style="color: #ad489b408e50; text-decoration: underline;">interactively</span> <span style="color: #51afef;">#'</span><span style="color: #b3609a32bacd; font-style: italic;">iedit</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #87cfc690d6c9; font-style: italic;">mode</span><span style="color: #98be65;">)</span>
    <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Not prog-mode or not in comment or string</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">if</span> <span style="color: #da8548;">(</span><span style="color: #cb4b16; font-weight: bold;">not</span> <span style="color: #a9a1e1;">(</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">equal</span> <span style="color: #91edb1e5c7aa;">flyspell</span>-<span style="color: #e011a3efa386;">previous</span>-<span style="color: #cd7fcd65ce32;">command</span> <span style="color: #bae2b0b4bde3;">this</span>-<span style="color: #cd7fcd65ce32;">command</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span>
        <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #cb4b16;">FIXME</span><span style="color: #586e75; font-weight: bold; font-style: italic;">: This mostly works, but if there are two words on the</span>
        <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">same line that are misspelled, it doesn't work quite right</span>
        <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">when correcting the earlier word after correcting the later</span>
        <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">one</span>

        <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">First correction; autocorrect</span>
        <span style="color: #da8548;">(</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">call</span><span style="text-decoration: underline;">-</span><span style="color: #ad489b408e50; text-decoration: underline;">interactively</span> <span style="color: #51afef;">'</span><span style="color: #91edb1e5c7aa; font-style: italic;">flyspell</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #ad489b408e50; font-style: italic;">auto</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #bbe6ba32c7cd; font-style: italic;">correct</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #e011a3efa386; font-style: italic;">previous</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #7765a7b4c89a; font-style: italic;">word</span><span style="color: #da8548;">)</span>
      <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">First correction was not wanted; use popup to choose</span>
      <span style="color: #da8548;">(</span><span style="color: #51afef;">progn</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">save-excursion</span>
          <span style="color: #ECBE7B;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">undo</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span>                       <span style="color: #586e75; font-weight: bold; font-style: italic;">; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">This doesn't move point, which I think may be the problem.</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">flyspell</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">region</span> <span style="color: #ECBE7B;">(</span><span style="color: #e011a3efa386; text-decoration: underline;">line</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">beginning</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">position</span><span style="color: #ECBE7B;">)</span> <span style="color: #ECBE7B;">(</span><span style="color: #e011a3efa386; text-decoration: underline;">line</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">end</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">position</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">call</span><span style="text-decoration: underline;">-</span><span style="color: #ad489b408e50; text-decoration: underline;">interactively</span> <span style="color: #51afef;">'</span><span style="color: #91edb1e5c7aa; font-style: italic;">flyspell</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #bbe6ba32c7cd; font-style: italic;">correct</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #e011a3efa386; font-style: italic;">previous</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #7765a7b4c89a; font-style: italic;">word</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #cf7ec31fb119; font-style: italic;">generic</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9106a34" class="outline-3">
<h3 id="org9106a34">Sort sexps</h3>
<div class="outline-text-3" id="text-org9106a34">
<p>
Sort sexps in region.  Comments stay with the code below.
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">unpackaged/sort-sexps</span> <span style="color: #c678dd;">(</span><span style="color: #cd65b84f9999;">beg</span> <span style="color: #e1b3bbc0bb7e;">end</span><span style="color: #c678dd;">)</span>
  <span style="color: #83898d; font-weight: bold; font-style: italic;">"Sort sexps in region.</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">Comments stay with the code below."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span> <span style="color: #98be65;">"r"</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cl-flet</span> <span style="color: #98be65;">(</span><span style="color: #da8548;">(</span><span style="color: #cd7fcd65ce32;">skip</span>-<span style="color: #918b91cd9132;">whitespace</span> <span style="color: #a9a1e1;">()</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">while</span> <span style="color: #ECBE7B;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">looking</span><span style="text-decoration: underline;">-</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">at</span> <span style="color: #4db5bd;">(</span><span style="color: #51afef;">rx</span> <span style="color: #a2b6da;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">1</span><span style="text-decoration: underline;">+</span> <span style="color: #9cb6ad;">(</span><span style="color: #51afef;">or</span> <span style="color: #918b91cd9132;">space</span> <span style="color: #98be65;">"\n"</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span>
                                  <span style="color: #ECBE7B;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">char</span> <span style="color: #4db5bd;">(</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">match</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">end</span> <span style="color: #87cfc690d6c9;">0</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span>
            <span style="color: #da8548;">(</span><span style="color: #cd7fcd65ce32;">skip</span>-<span style="color: #ad9a8c4c7464;">both</span> <span style="color: #a9a1e1;">()</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">while</span> <span style="color: #ECBE7B;">(</span><span style="color: #51afef;">cond</span> <span style="color: #4db5bd;">(</span><span style="color: #a2b6da;">(</span><span style="color: #51afef;">or</span> <span style="color: #9cb6ad;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">nth</span> <span style="color: #9e4c9e4c9e4c;">4</span> <span style="color: #51afef;">(</span><span style="color: #918b91cd9132; text-decoration: underline;">syntax</span><span style="text-decoration: underline;">-</span><span style="color: #7765a7b4c89a; text-decoration: underline;">ppss</span><span style="color: #51afef;">)</span><span style="color: #9cb6ad;">)</span>
                                            <span style="color: #9cb6ad;">(</span><span style="color: #51afef;">ignore-errors</span>
                                              <span style="color: #51afef;">(</span><span style="color: #51afef;">save-excursion</span>
                                                <span style="color: #c678dd;">(</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">forward</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">char</span> <span style="color: #91edb1e5c7aa;">1</span><span style="color: #c678dd;">)</span>
                                                <span style="color: #c678dd;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">nth</span> <span style="color: #9e4c9e4c9e4c;">4</span> <span style="color: #98be65;">(</span><span style="color: #918b91cd9132; text-decoration: underline;">syntax</span><span style="text-decoration: underline;">-</span><span style="color: #7765a7b4c89a; text-decoration: underline;">ppss</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span>
                                        <span style="color: #a2b6da;">(</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">forward</span><span style="text-decoration: underline;">-</span><span style="color: #e011a3efa386; text-decoration: underline;">line</span> <span style="color: #91edb1e5c7aa;">1</span><span style="color: #a2b6da;">)</span><span style="color: #4db5bd;">)</span>
                                       <span style="color: #4db5bd;">(</span><span style="color: #a2b6da;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">looking</span><span style="text-decoration: underline;">-</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">at</span> <span style="color: #9cb6ad;">(</span><span style="color: #51afef;">rx</span> <span style="color: #51afef;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">1</span><span style="text-decoration: underline;">+</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">or</span> <span style="color: #918b91cd9132;">space</span> <span style="color: #98be65;">"\n"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span>
                                        <span style="color: #a2b6da;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">char</span> <span style="color: #9cb6ad;">(</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">match</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">end</span> <span style="color: #87cfc690d6c9;">0</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">save-excursion</span>
      <span style="color: #da8548;">(</span><span style="color: #51afef;">save-restriction</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #cd65b84f9999; text-decoration: underline;">narrow</span><span style="text-decoration: underline;">-</span><span style="color: #bae2b0b4bde3; text-decoration: underline;">to</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">region</span> <span style="color: #cd65b84f9999;">beg</span> <span style="color: #e1b3bbc0bb7e;">end</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">char</span> <span style="color: #cd65b84f9999;">beg</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #cd7fcd65ce32;">skip</span>-<span style="color: #ad9a8c4c7464;">both</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">cl-destructuring-bind</span> <span style="color: #ECBE7B;">(</span><span style="color: #cd7fcd65ce32;">sexps</span> <span style="color: #e1b3bbc0bb7e;">markers</span><span style="color: #ECBE7B;">)</span>
            <span style="color: #ECBE7B;">(</span><span style="color: #51afef;">cl-loop</span> <span style="color: #9e4c9e4c9e4c;">do</span> <span style="color: #4db5bd;">(</span><span style="color: #cd7fcd65ce32;">skip</span>-<span style="color: #918b91cd9132;">whitespace</span><span style="color: #4db5bd;">)</span>
                     <span style="color: #91edb1e5c7aa;">for</span> <span style="color: #cd7fcd65ce32;">start</span> = <span style="color: #4db5bd;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">marker</span><span style="color: #4db5bd;">)</span>
                     <span style="color: #91edb1e5c7aa;">for</span> <span style="color: #b3609a32bacd;">sexp</span> = <span style="color: #4db5bd;">(</span><span style="color: #51afef;">ignore-errors</span>
                                  <span style="color: #a2b6da;">(</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">read</span> <span style="color: #9cb6ad;">(</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">current</span><span style="text-decoration: underline;">-</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">buffer</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #4db5bd;">)</span>
                     <span style="color: #91edb1e5c7aa;">for</span> <span style="color: #e1b3bbc0bb7e;">end</span> = <span style="color: #4db5bd;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">marker</span><span style="color: #4db5bd;">)</span>
                     <span style="color: #ad9a8c4c7464;">while</span> <span style="color: #b3609a32bacd;">sexp</span>
                     <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Collect the real string, then one used for sorting.</span>
                     <span style="color: #cd7fcd65ce32;">collect</span> <span style="color: #4db5bd;">(</span><span style="color: #b3609a32bacd; text-decoration: underline;">cons</span> <span style="color: #a2b6da;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">buffer</span><span style="text-decoration: underline;">-</span><span style="color: #b3609a32bacd; text-decoration: underline;">substring</span> <span style="color: #9cb6ad;">(</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">marker</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">position</span> <span style="color: #cd7fcd65ce32;">start</span><span style="color: #9cb6ad;">)</span> <span style="color: #9cb6ad;">(</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">marker</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">position</span> <span style="color: #e1b3bbc0bb7e;">end</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span>
                                   <span style="color: #a2b6da;">(</span><span style="color: #51afef;">save-excursion</span>
                                     <span style="color: #9cb6ad;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">char</span> <span style="color: #51afef;">(</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">marker</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">position</span> <span style="color: #cd7fcd65ce32;">start</span><span style="color: #51afef;">)</span><span style="color: #9cb6ad;">)</span>
                                     <span style="color: #9cb6ad;">(</span><span style="color: #cd7fcd65ce32;">skip</span>-<span style="color: #ad9a8c4c7464;">both</span><span style="color: #9cb6ad;">)</span>
                                     <span style="color: #9cb6ad;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">buffer</span><span style="text-decoration: underline;">-</span><span style="color: #b3609a32bacd; text-decoration: underline;">substring</span> <span style="color: #51afef;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">point</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">marker</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">position</span> <span style="color: #e1b3bbc0bb7e;">end</span><span style="color: #51afef;">)</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #4db5bd;">)</span>
                     <span style="color: #e1b3bbc0bb7e;">into</span> <span style="color: #cd7fcd65ce32;">sexps</span>
                     <span style="color: #cd7fcd65ce32;">collect</span> <span style="color: #4db5bd;">(</span><span style="color: #b3609a32bacd; text-decoration: underline;">cons</span> <span style="color: #cd7fcd65ce32;">start</span> <span style="color: #e1b3bbc0bb7e;">end</span><span style="color: #4db5bd;">)</span>
                     <span style="color: #e1b3bbc0bb7e;">into</span> <span style="color: #e1b3bbc0bb7e;">markers</span>
                     <span style="color: #6b65c2f6d999;">finally</span> <span style="color: #cd65b84f9999;">return</span> <span style="color: #4db5bd;">(</span><span style="color: #e011a3efa386; text-decoration: underline;">list</span> <span style="color: #cd7fcd65ce32;">sexps</span> <span style="color: #e1b3bbc0bb7e;">markers</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span>
          <span style="color: #ECBE7B;">(</span><span style="color: #51afef;">setq</span> <span style="color: #cd7fcd65ce32;">sexps</span> <span style="color: #4db5bd;">(</span><span style="color: #918b91cd9132; text-decoration: underline;">sort</span> <span style="color: #cd7fcd65ce32;">sexps</span> <span style="color: #a2b6da;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #9cb6ad;">(</span><span style="color: #ad489b408e50;">a</span> <span style="color: #ad489b408e50;">b</span><span style="color: #9cb6ad;">)</span>
                                    <span style="color: #9cb6ad;">(</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">string</span><span style="text-decoration: underline;">&lt;</span> <span style="color: #51afef;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">cdr</span> <span style="color: #ad489b408e50;">a</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">cdr</span> <span style="color: #ad489b408e50;">b</span><span style="color: #51afef;">)</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span>
          <span style="color: #ECBE7B;">(</span><span style="color: #51afef;">cl-loop</span> <span style="color: #91edb1e5c7aa;">for</span> <span style="color: #4db5bd;">(</span><span style="color: #ad9a8c4c7464;">real</span> . <span style="color: #918b91cd9132;">sort</span><span style="color: #4db5bd;">)</span> <span style="color: #e1b3bbc0bb7e;">in</span> <span style="color: #cd7fcd65ce32;">sexps</span>
                   <span style="color: #91edb1e5c7aa;">for</span> <span style="color: #4db5bd;">(</span><span style="color: #cd7fcd65ce32;">start</span> . <span style="color: #e1b3bbc0bb7e;">end</span><span style="color: #4db5bd;">)</span> <span style="color: #e1b3bbc0bb7e;">in</span> <span style="color: #e1b3bbc0bb7e;">markers</span>
                   <span style="color: #9e4c9e4c9e4c;">do</span> <span style="color: #4db5bd;">(</span><span style="color: #51afef;">progn</span>
                        <span style="color: #a2b6da;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">char</span> <span style="color: #9cb6ad;">(</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">marker</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">position</span> <span style="color: #cd7fcd65ce32;">start</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span>
                        <span style="color: #a2b6da;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">insert</span><span style="text-decoration: underline;">-</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">before</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">markers</span> <span style="color: #ad9a8c4c7464;">real</span><span style="color: #a2b6da;">)</span>
                        <span style="color: #a2b6da;">(</span><span style="color: #e011a3efa386; text-decoration: underline;">delete</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">region</span> <span style="color: #9cb6ad;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">point</span><span style="color: #9cb6ad;">)</span> <span style="color: #9cb6ad;">(</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">marker</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">position</span> <span style="color: #e1b3bbc0bb7e;">end</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org31882fd" class="outline-2">
<h2 id="org31882fd">Regular expressions&#xa0;&#xa0;&#xa0;<span class="tag"><span class="regular_expressions">regular_expressions</span></span></h2>
<div class="outline-text-2" id="text-org31882fd">
</div><div id="outline-container-org2c1880a" class="outline-3">
<h3 id="org2c1880a">query-replace-rx</h3>
<div class="outline-text-3" id="text-org2c1880a">
<p>
Call <code>query-replace-regexp</code>, reading regexp in <code>rx</code> syntax.  Automatically wraps in parens and adds <code>seq</code> to the beginning of the form.
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">unpackaged/query-replace-rx</span> <span style="color: #c678dd;">(</span><span style="color: #ECBE7B;">&amp;rest</span> _<span style="color: #c678dd;">)</span>
  <span style="color: #83898d; font-weight: bold; font-style: italic;">"Call `</span><span style="color: #a9a1e1; font-weight: bold; font-style: italic;">query-replace-regexp</span><span style="color: #83898d; font-weight: bold; font-style: italic;">', reading regexp in `</span><span style="color: #a9a1e1; font-weight: bold; font-style: italic;">rx</span><span style="color: #83898d; font-weight: bold; font-style: italic;">' syntax.</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">Automatically wraps in parens and adds `</span><span style="color: #a9a1e1; font-weight: bold; font-style: italic;">seq</span><span style="color: #83898d; font-weight: bold; font-style: italic;">' to the beginning of</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">the form."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cl-letf</span> <span style="color: #98be65;">(</span><span style="color: #da8548;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">symbol</span><span style="text-decoration: underline;">-</span><span style="color: #b3609a32bacd; text-decoration: underline;">function</span> <span style="color: #51afef;">#'</span><span style="color: #918b91cd9132; font-style: italic;">query</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #cd7fcd65ce32; font-style: italic;">replace</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #e1b3bbc0bb7e; font-style: italic;">read</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #cd7fcd65ce32; font-style: italic;">from</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #ECBE7B;">(</span><span style="color: #ECBE7B;">&amp;rest</span> _<span style="color: #ECBE7B;">)</span>
                                                           <span style="color: #ECBE7B;">(</span><span style="color: #51afef;">--&gt;</span> <span style="color: #4db5bd;">(</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">read</span><span style="text-decoration: underline;">-</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">string</span> <span style="color: #98be65;">"rx form: "</span><span style="color: #4db5bd;">)</span>
                                                                <span style="color: #4db5bd;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">concat</span> <span style="color: #98be65;">"'(seq "</span> <span style="color: #dcaeea;">it</span> <span style="color: #98be65;">")"</span><span style="color: #4db5bd;">)</span>
                                                                <span style="color: #4db5bd;">(</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">read</span> <span style="color: #dcaeea;">it</span><span style="color: #4db5bd;">)</span>
                                                                <span style="color: #4db5bd;">(</span><span style="color: #918b91cd9132; text-decoration: underline;">cadr</span> <span style="color: #dcaeea;">it</span><span style="color: #4db5bd;">)</span>
                                                                <span style="color: #4db5bd;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">rx</span><span style="text-decoration: underline;">-</span><span style="color: #bae2b0b4bde3; text-decoration: underline;">to</span><span style="text-decoration: underline;">-</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">string</span> <span style="color: #dcaeea;">it</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">call</span><span style="text-decoration: underline;">-</span><span style="color: #ad489b408e50; text-decoration: underline;">interactively</span> <span style="color: #51afef;">#'</span><span style="color: #918b91cd9132; font-style: italic;">query</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #cd7fcd65ce32; font-style: italic;">replace</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #6b65c2f6d999; font-style: italic;">regexp</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd5f02b2" class="outline-2">
<h2 id="orgd5f02b2">Version control&#xa0;&#xa0;&#xa0;<span class="tag"><span class="version_control">version_control</span></span></h2>
<div class="outline-text-2" id="text-orgd5f02b2">
</div><div id="outline-container-org68bac0a" class="outline-3">
<h3 id="org68bac0a">Magit&#xa0;&#xa0;&#xa0;<span class="tag"><span class="Magit">Magit</span></span></h3>
<div class="outline-text-3" id="text-org68bac0a">
</div><div id="outline-container-org21a9fa9" class="outline-4">
<h4 id="org21a9fa9">magit-log date headers</h4>
<div class="outline-text-4" id="text-org21a9fa9">
<p>
Add date headers to Magit log buffers.
</p>

<p>
<b>Requires:</b>
</p>
<ul class="org-ul">
<li><a href="https://github.com/ShingoFukuyama/ov.el">ov.el</a></li>
</ul>

<p>

</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">unpackaged/magit-log--add-date-headers</span> <span style="color: #c678dd;">(</span><span style="color: #ECBE7B;">&amp;rest</span> _<span style="color: #cd7fcd65ce32;">ignore</span><span style="color: #c678dd;">)</span>
  <span style="color: #83898d; font-weight: bold; font-style: italic;">"Add date headers to Magit log buffers."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> <span style="color: #98be65;">(</span><span style="color: #b3609a32bacd; text-decoration: underline;">derived</span><span style="text-decoration: underline;">-</span><span style="color: #87cfc690d6c9; text-decoration: underline;">mode</span><span style="text-decoration: underline;">-</span><span style="color: #cf7ec31fb119; text-decoration: underline;">p</span> <span style="color: #51afef;">'</span><span style="color: #cd65b84f9999; font-style: italic;">magit</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #bae2b0b4bde3; font-style: italic;">log</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #87cfc690d6c9; font-style: italic;">mode</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">save-excursion</span>
      <span style="color: #da8548;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">ov</span><span style="text-decoration: underline;">-</span><span style="color: #cf7ec31fb119; text-decoration: underline;">clear</span> <span style="color: #51afef;">'</span><span style="color: #b3609a32bacd; font-style: italic;">date</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #cd65b84f9999; font-style: italic;">header</span> <span style="color: #bbe6ba32c7cd;">t</span><span style="color: #da8548;">)</span>
      <span style="color: #da8548;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">char</span> <span style="color: #a9a1e1;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #b3609a32bacd; text-decoration: underline;">min</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span>
      <span style="color: #da8548;">(</span><span style="color: #51afef;">cl-loop</span> <span style="color: #cd7fcd65ce32;">with</span> <span style="color: #bae2b0b4bde3;">last</span>-<span style="color: #918b91cd9132;">age</span>
               <span style="color: #91edb1e5c7aa;">for</span> <span style="color: #bae2b0b4bde3;">this</span>-<span style="color: #918b91cd9132;">age</span> = <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">-some--&gt;</span> <span style="color: #ECBE7B;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">ov</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">in</span> <span style="color: #51afef;">'</span><span style="color: #cd7fcd65ce32; font-style: italic;">before</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #cd7fcd65ce32; font-style: italic;">string</span> <span style="color: #51afef;">'</span><span style="color: #ad9a8c4c7464; font-style: italic;">any</span> <span style="color: #4db5bd;">(</span><span style="color: #e011a3efa386; text-decoration: underline;">line</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">beginning</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">position</span><span style="color: #4db5bd;">)</span> <span style="color: #4db5bd;">(</span><span style="color: #e011a3efa386; text-decoration: underline;">line</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">end</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">position</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span>
                                        <span style="color: #b3609a32bacd;">car</span>
                                        <span style="color: #ECBE7B;">(</span><span style="color: #87cfc690d6c9; text-decoration: underline;">overlay</span><span style="text-decoration: underline;">-</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">get</span> <span style="color: #dcaeea;">it</span> <span style="color: #51afef;">'</span><span style="color: #cd7fcd65ce32; font-style: italic;">before</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #cd7fcd65ce32; font-style: italic;">string</span><span style="color: #ECBE7B;">)</span>
                                        <span style="color: #ECBE7B;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">get</span><span style="text-decoration: underline;">-</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">text</span><span style="text-decoration: underline;">-</span><span style="color: #87cfc690d6c9; text-decoration: underline;">property</span> <span style="color: #87cfc690d6c9;">0</span> <span style="color: #51afef;">'</span><span style="color: #bbe6ba32c7cd; font-style: italic;">display</span> <span style="color: #dcaeea;">it</span><span style="color: #ECBE7B;">)</span>
                                        <span style="color: #918b91cd9132;">cadr</span>
                                        <span style="color: #ECBE7B;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">s</span><span style="text-decoration: underline;">-</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">match</span> <span style="color: #4db5bd;">(</span><span style="color: #51afef;">rx</span> <span style="color: #a2b6da;">(</span><span style="color: #cd7fcd65ce32;">group</span> <span style="color: #9cb6ad;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">1</span><span style="text-decoration: underline;">+</span> <span style="color: #9e4c9e4c9e4c;">digit</span><span style="color: #9cb6ad;">)</span> <span style="color: #586e75; font-weight: bold; font-style: italic;">; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">number</span>
                                                            <span style="color: #98be65;">" "</span>
                                                            <span style="color: #9cb6ad;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">1</span><span style="text-decoration: underline;">+</span> <span style="color: #51afef;">(</span><span style="color: #cb4b16; font-weight: bold;">not</span> <span style="color: #e1b3bbc0bb7e;">blank</span><span style="color: #51afef;">)</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span> <span style="color: #586e75; font-weight: bold; font-style: italic;">; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">unit</span>
                                                     <span style="color: #a2b6da;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">1</span><span style="text-decoration: underline;">+</span> <span style="color: #e1b3bbc0bb7e;">blank</span><span style="color: #a2b6da;">)</span> <span style="color: #ad489b408e50;">eos</span><span style="color: #4db5bd;">)</span>
                                                 <span style="color: #dcaeea;">it</span><span style="color: #ECBE7B;">)</span>
                                        <span style="color: #918b91cd9132;">cadr</span><span style="color: #a9a1e1;">)</span>
               <span style="color: #9e4c9e4c9e4c;">do</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">when</span> <span style="color: #ECBE7B;">(</span><span style="color: #51afef;">and</span> <span style="color: #bae2b0b4bde3;">this</span>-<span style="color: #918b91cd9132;">age</span>
                             <span style="color: #4db5bd;">(</span><span style="color: #cb4b16; font-weight: bold;">not</span> <span style="color: #a2b6da;">(</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">equal</span> <span style="color: #bae2b0b4bde3;">this</span>-<span style="color: #918b91cd9132;">age</span> <span style="color: #bae2b0b4bde3;">last</span>-<span style="color: #918b91cd9132;">age</span><span style="color: #a2b6da;">)</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span>
                    <span style="color: #ECBE7B;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">ov</span> <span style="color: #4db5bd;">(</span><span style="color: #e011a3efa386; text-decoration: underline;">line</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">beginning</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">position</span><span style="color: #4db5bd;">)</span> <span style="color: #4db5bd;">(</span><span style="color: #e011a3efa386; text-decoration: underline;">line</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">beginning</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">position</span><span style="color: #4db5bd;">)</span>
                        <span style="color: #51afef;">'</span><span style="color: #91edb1e5c7aa; font-style: italic;">after</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #cd7fcd65ce32; font-style: italic;">string</span> <span style="color: #4db5bd;">(</span><span style="color: #cd65b84f9999; text-decoration: underline;">propertize</span> <span style="color: #a2b6da;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">concat</span> <span style="color: #98be65;">" "</span> <span style="color: #bae2b0b4bde3;">this</span>-<span style="color: #918b91cd9132;">age</span> <span style="color: #98be65;">"\n"</span><span style="color: #a2b6da;">)</span>
                                                  <span style="color: #51afef;">'</span><span style="color: #6b65c2f6d999; font-style: italic;">face</span> <span style="color: #51afef;">'</span><span style="color: #cd65b84f9999; font-style: italic;">magit</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #918b91cd9132; font-style: italic;">section</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #918b91cd9132; font-style: italic;">heading</span><span style="color: #4db5bd;">)</span>
                        <span style="color: #51afef;">'</span><span style="color: #b3609a32bacd; font-style: italic;">date</span><span style="color: #ECBE7B; font-style: italic;">-</span><span style="color: #cd65b84f9999; font-style: italic;">header</span> <span style="color: #bbe6ba32c7cd;">t</span><span style="color: #ECBE7B;">)</span>
                    <span style="color: #ECBE7B;">(</span><span style="color: #51afef;">setq</span> <span style="color: #bae2b0b4bde3;">last</span>-<span style="color: #918b91cd9132;">age</span> <span style="color: #bae2b0b4bde3;">this</span>-<span style="color: #918b91cd9132;">age</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span>
               <span style="color: #9e4c9e4c9e4c;">do</span> <span style="color: #a9a1e1;">(</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">forward</span><span style="text-decoration: underline;">-</span><span style="color: #e011a3efa386; text-decoration: underline;">line</span> <span style="color: #91edb1e5c7aa;">1</span><span style="color: #a9a1e1;">)</span>
               <span style="color: #e011a3efa386;">until</span> <span style="color: #a9a1e1;">(</span><span style="color: #cd65b84f9999; text-decoration: underline;">eobp</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
This isn't always perfect, because dates in a git commit log are not always in order (e.g. when commits are merged at a later date), but it's often very helpful to visually group commits by their age.
</p>
</div>
</div>
</div>

<div id="outline-container-org3a58260" class="outline-3">
<h3 id="org3a58260"><a id="ID-9d6983a6-3765-45c2-a140-34c23f381361"></a><code>smerge-mode</code></h3>
<div class="outline-text-3" id="text-org3a58260">
</div>

<div id="outline-container-org853404d" class="outline-4">
<h4 id="org853404d">Hydra</h4>
<div class="outline-text-4" id="text-org853404d">
<p>
This configuration automatically activates a helpful <code>smerge-mode</code> hydra when a file containing merge conflicts is visited from a Magit diff section.  You can manually activate the hydra with the command <code>unpackaged/smerge-hydra/body</code>.  (Inspired by <a href="https://github.com/kaushalmodi/.emacs.d/blob/master/setup-files/setup-diff.el">Kaushal Modi's Emacs config</a>.)
</p>

<p>
<b>Requires</b>:
</p>
<ul class="org-ul">
<li><a href="https://github.com/abo-abo/hydra">hydra</a></li>
<li><a href="https://magit.vc/">Magit</a></li>
</ul>

<p>

</p>

<p>
See these screencasts comparing what it's like to resolve the conflict with and with this .
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">use-package</span> <span style="color: #a9a1e1;">smerge-mode</span>
  <span style="color: #c678dd;">:config</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">defhydra</span> <span style="color: #e1b3bbc0bb7e;">unpackaged</span>/<span style="color: #b3609a32bacd;">smerge</span>-<span style="color: #cf7ec31fb119;">hydra</span>
    <span style="color: #98be65;">(</span><span style="color: #c678dd;">:color</span> <span style="color: #9e4c9e4c9e4c;">pink</span> <span style="color: #c678dd;">:hint</span> <span style="color: #cd7fcd65ce32;">nil</span> <span style="color: #c678dd;">:post</span> <span style="color: #da8548;">(</span><span style="color: #b3609a32bacd; text-decoration: underline;">smerge</span><span style="text-decoration: underline;">-</span><span style="color: #ad489b408e50; text-decoration: underline;">auto</span><span style="text-decoration: underline;">-</span><span style="color: #e011a3efa386; text-decoration: underline;">leave</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #83898d; font-weight: bold; font-style: italic;">"</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">^Move^       ^Keep^               ^Diff^                 ^Other^</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">^^-----------^^-------------------^^---------------------^^-------</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">_n_ext       _b_ase               _&lt;_: upper/base        _C_ombine</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">_p_rev       _u_pper              _=_: upper/lower       _r_esolve</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">^^           _l_ower              _&gt;_: base/lower        _k_ill current</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">^^           _a_ll                _R_efine</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">^^           _RET_: current       _E_diff</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">"</span>
    <span style="color: #98be65;">(</span><span style="color: #98be65;">"n"</span> <span style="color: #b3609a32bacd;">smerge</span>-<span style="color: #918b91cd9132;">next</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #98be65;">"p"</span> <span style="color: #b3609a32bacd;">smerge</span>-<span style="color: #87cfc690d6c9;">prev</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #98be65;">"b"</span> <span style="color: #b3609a32bacd;">smerge</span>-<span style="color: #87cfc690d6c9;">keep</span>-<span style="color: #6b65c2f6d999;">base</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #98be65;">"u"</span> <span style="color: #b3609a32bacd;">smerge</span>-<span style="color: #87cfc690d6c9;">keep</span>-<span style="color: #e011a3efa386;">upper</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #98be65;">"l"</span> <span style="color: #b3609a32bacd;">smerge</span>-<span style="color: #87cfc690d6c9;">keep</span>-<span style="color: #ad9a8c4c7464;">lower</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #98be65;">"a"</span> <span style="color: #b3609a32bacd;">smerge</span>-<span style="color: #87cfc690d6c9;">keep</span>-<span style="color: #ad9a8c4c7464;">all</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #98be65;">"RET"</span> <span style="color: #b3609a32bacd;">smerge</span>-<span style="color: #87cfc690d6c9;">keep</span>-<span style="color: #e1b3bbc0bb7e;">current</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #98be65;">"\C-m"</span> <span style="color: #b3609a32bacd;">smerge</span>-<span style="color: #87cfc690d6c9;">keep</span>-<span style="color: #e1b3bbc0bb7e;">current</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #98be65;">"&lt;"</span> <span style="color: #b3609a32bacd;">smerge</span>-<span style="color: #87cfc690d6c9;">diff</span>-<span style="color: #6b65c2f6d999;">base</span>-<span style="color: #e011a3efa386;">upper</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #98be65;">"="</span> <span style="color: #b3609a32bacd;">smerge</span>-<span style="color: #87cfc690d6c9;">diff</span>-<span style="color: #e011a3efa386;">upper</span>-<span style="color: #ad9a8c4c7464;">lower</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #98be65;">"&gt;"</span> <span style="color: #b3609a32bacd;">smerge</span>-<span style="color: #87cfc690d6c9;">diff</span>-<span style="color: #6b65c2f6d999;">base</span>-<span style="color: #ad9a8c4c7464;">lower</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #98be65;">"R"</span> <span style="color: #b3609a32bacd;">smerge</span>-<span style="color: #91edb1e5c7aa;">refine</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #98be65;">"E"</span> <span style="color: #b3609a32bacd;">smerge</span>-<span style="color: #ad489b408e50;">ediff</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #98be65;">"C"</span> <span style="color: #b3609a32bacd;">smerge</span>-<span style="color: #91edb1e5c7aa;">combine</span>-<span style="color: #cd7fcd65ce32;">with</span>-<span style="color: #918b91cd9132;">next</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #98be65;">"r"</span> <span style="color: #b3609a32bacd;">smerge</span>-<span style="color: #7765a7b4c89a;">resolve</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #98be65;">"k"</span> <span style="color: #b3609a32bacd;">smerge</span>-<span style="color: #9e4c9e4c9e4c;">kill</span>-<span style="color: #e1b3bbc0bb7e;">current</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #98be65;">"ZZ"</span> <span style="color: #da8548;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">()</span>
            <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">interactive</span><span style="color: #a9a1e1;">)</span>
            <span style="color: #a9a1e1;">(</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">save</span><span style="text-decoration: underline;">-</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">buffer</span><span style="color: #a9a1e1;">)</span>
            <span style="color: #a9a1e1;">(</span><span style="color: #cd65b84f9999; text-decoration: underline;">bury</span><span style="text-decoration: underline;">-</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">buffer</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span>
     <span style="color: #98be65;">"Save and bury buffer"</span> <span style="color: #c678dd;">:color</span> <span style="color: #cf7ec31fb119;">blue</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #98be65;">"q"</span> <span style="color: #cd7fcd65ce32;">nil</span> <span style="color: #98be65;">"cancel"</span> <span style="color: #c678dd;">:color</span> <span style="color: #cf7ec31fb119;">blue</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">:hook</span> <span style="color: #c678dd;">(</span><span style="color: #cd65b84f9999; text-decoration: underline;">magit</span><span style="text-decoration: underline;">-</span><span style="color: #87cfc690d6c9; text-decoration: underline;">diff</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">visit</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">file</span> . <span style="color: #98be65;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #da8548;">()</span>
                                   <span style="color: #da8548;">(</span><span style="color: #51afef;">when</span> <span style="color: #b3609a32bacd;">smerge</span>-<span style="color: #87cfc690d6c9;">mode</span>
                                     <span style="color: #a9a1e1;">(</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">unpackaged</span><span style="text-decoration: underline;">/</span><span style="color: #b3609a32bacd; text-decoration: underline;">smerge</span><span style="text-decoration: underline;">-</span><span style="color: #cf7ec31fb119; text-decoration: underline;">hydra</span><span style="text-decoration: underline;">/</span><span style="color: #6b65c2f6d999; text-decoration: underline;">body</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org9f2ecb6" class="outline-2">
<h2 id="org9f2ecb6">Web&#xa0;&#xa0;&#xa0;<span class="tag"><span class="web">web</span></span></h2>
<div class="outline-text-2" id="text-org9f2ecb6">
</div><div id="outline-container-org07a2f3d" class="outline-3">
<h3 id="org07a2f3d">feed-for-url&#xa0;&#xa0;&#xa0;<span class="tag"><span class="RSS">RSS</span>&#xa0;<span class="Atom">Atom</span>&#xa0;<span class="XML">XML</span></span></h3>
<div class="outline-text-3" id="text-org07a2f3d">
<p>
Return ATOM or RSS feed <code>URL</code> for web page at <code>URL</code>.  Interactively, insert the <code>URL</code> at point.  <code>PREFER</code> may be <code>atom</code> (the default) or <code>rss</code>.  When <code>ALL</code> is non-nil, return all feed URLs of all types; otherwise, return only one feed <code>URL</code>, preferring the preferred type.
</p>

<p>
<b>Requires:</b>
</p>
<ul class="org-ul">
<li><a href="https://github.com/tali713/esxml">esxml</a></li>
<li><a href="https://github.com/alphapapa/org-web-tools">org-web-tools</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">cl-defun</span> <span style="color: #c678dd;">unpackaged/feed-for-url</span> <span style="color: #c678dd;">(</span><span style="color: #87cfc690d6c9;">url</span> <span style="color: #ECBE7B;">&amp;key</span> <span style="color: #98be65;">(</span><span style="color: #e1b3bbc0bb7e;">prefer</span> <span style="color: #51afef;">'</span><span style="color: #cf7ec31fb119; font-style: italic;">atom</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #ad9a8c4c7464;">all</span> <span style="color: #cd7fcd65ce32;">nil</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #83898d; font-weight: bold; font-style: italic;">"Return feed URL for web page at URL.</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">Interactively, insert the URL at point.  PREFER may be</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">`</span><span style="color: #a9a1e1; font-weight: bold; font-style: italic;">atom</span><span style="color: #83898d; font-weight: bold; font-style: italic;">' (the default) or `</span><span style="color: #a9a1e1; font-weight: bold; font-style: italic;">rss</span><span style="color: #83898d; font-weight: bold; font-style: italic;">'.  When ALL is non-nil, return all</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">feed URLs of all types; otherwise, return only one feed URL,</span>
<span style="color: #83898d; font-weight: bold; font-style: italic;">preferring the preferred type."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span> <span style="color: #98be65;">(</span><span style="color: #e011a3efa386; text-decoration: underline;">list</span> <span style="color: #da8548;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #ad489b408e50; text-decoration: underline;">web</span><span style="text-decoration: underline;">-</span><span style="color: #cd65b84f9999; text-decoration: underline;">tools</span><span style="text-decoration: underline;">--</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">get</span><span style="text-decoration: underline;">-</span><span style="color: #cd65b84f9999; text-decoration: underline;">first</span><span style="text-decoration: underline;">-</span><span style="color: #87cfc690d6c9; text-decoration: underline;">url</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">require</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">esxml-query</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">require</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">org-web-tools</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">cl-flet</span> <span style="color: #98be65;">(</span><span style="color: #da8548;">(</span><span style="color: #87cfc690d6c9;">feed</span>-<span style="color: #cf7ec31fb119;">p</span> <span style="color: #a9a1e1;">(</span><span style="color: #cf7ec31fb119;">type</span><span style="color: #a9a1e1;">)</span>
                    <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Return t if TYPE appears to be an RSS/ATOM feed</span>
                    <span style="color: #a9a1e1;">(</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">string</span><span style="text-decoration: underline;">-</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">match</span><span style="text-decoration: underline;">-</span><span style="color: #cf7ec31fb119; text-decoration: underline;">p</span> <span style="color: #ECBE7B;">(</span><span style="color: #51afef;">rx</span> <span style="color: #98be65;">"application/"</span> <span style="color: #4db5bd;">(</span><span style="color: #51afef;">or</span> <span style="color: #98be65;">"rss"</span> <span style="color: #98be65;">"atom"</span><span style="color: #4db5bd;">)</span> <span style="color: #98be65;">"+xml"</span><span style="color: #ECBE7B;">)</span>
                                    <span style="color: #cf7ec31fb119;">type</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">let*</span> <span style="color: #da8548;">(</span><span style="color: #a9a1e1;">(</span><span style="color: #87cfc690d6c9;">preferred</span>-<span style="color: #cf7ec31fb119;">type</span> <span style="color: #ECBE7B;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">format</span> <span style="color: #98be65;">"application/%s+xml"</span> <span style="color: #4db5bd;">(</span><span style="color: #cd7fcd65ce32; text-decoration: underline;">symbol</span><span style="text-decoration: underline;">-</span><span style="color: #87cfc690d6c9; text-decoration: underline;">name</span> <span style="color: #e1b3bbc0bb7e;">prefer</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span>
           <span style="color: #a9a1e1;">(</span><span style="color: #e1b3bbc0bb7e;">html</span> <span style="color: #ECBE7B;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #ad489b408e50; text-decoration: underline;">web</span><span style="text-decoration: underline;">-</span><span style="color: #cd65b84f9999; text-decoration: underline;">tools</span><span style="text-decoration: underline;">--</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">get</span><span style="text-decoration: underline;">-</span><span style="color: #87cfc690d6c9; text-decoration: underline;">url</span> <span style="color: #87cfc690d6c9;">url</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span>
           <span style="color: #a9a1e1;">(</span><span style="color: #b3609a32bacd;">dom</span> <span style="color: #ECBE7B;">(</span><span style="color: #51afef;">with-temp-buffer</span>
                  <span style="color: #4db5bd;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">insert</span> <span style="color: #e1b3bbc0bb7e;">html</span><span style="color: #4db5bd;">)</span>
                  <span style="color: #4db5bd;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">libxml</span><span style="text-decoration: underline;">-</span><span style="color: #7765a7b4c89a; text-decoration: underline;">parse</span><span style="text-decoration: underline;">-</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">html</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">region</span> <span style="color: #a2b6da;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #b3609a32bacd; text-decoration: underline;">min</span><span style="color: #a2b6da;">)</span> <span style="color: #a2b6da;">(</span><span style="color: #ad489b408e50; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">max</span><span style="color: #a2b6da;">)</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span>
           <span style="color: #a9a1e1;">(</span><span style="color: #7765a7b4c89a;">potential</span>-<span style="color: #87cfc690d6c9;">feeds</span> <span style="color: #ECBE7B;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">esxml</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">query</span><span style="text-decoration: underline;">-</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">all</span> <span style="color: #98be65;">"link[rel=alternate]"</span> <span style="color: #b3609a32bacd;">dom</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span>
           <span style="color: #a9a1e1;">(</span><span style="color: #cd65b84f9999;">return</span> <span style="color: #ECBE7B;">(</span><span style="color: #51afef;">if</span> <span style="color: #ad9a8c4c7464;">all</span>
                       <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Return all URLs</span>
                       <span style="color: #4db5bd;">(</span><span style="color: #51afef;">cl-loop</span> <span style="color: #91edb1e5c7aa;">for</span> <span style="color: #a2b6da;">(</span><span style="color: #918b91cd9132;">tag</span> <span style="color: #91edb1e5c7aa;">attrs</span><span style="color: #a2b6da;">)</span> <span style="color: #e1b3bbc0bb7e;">in</span> <span style="color: #7765a7b4c89a;">potential</span>-<span style="color: #87cfc690d6c9;">feeds</span>
                                <span style="color: #cd7fcd65ce32;">when</span> <span style="color: #a2b6da;">(</span><span style="color: #87cfc690d6c9;">feed</span>-<span style="color: #cf7ec31fb119;">p</span> <span style="color: #9cb6ad;">(</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">alist</span><span style="text-decoration: underline;">-</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">get</span> <span style="color: #51afef;">'</span><span style="color: #cf7ec31fb119; font-style: italic;">type</span> <span style="color: #91edb1e5c7aa;">attrs</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span>
                                <span style="color: #cd7fcd65ce32;">collect</span> <span style="color: #a2b6da;">(</span><span style="color: #87cfc690d6c9; text-decoration: underline;">url</span><span style="text-decoration: underline;">-</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">expand</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">file</span><span style="text-decoration: underline;">-</span><span style="color: #87cfc690d6c9; text-decoration: underline;">name</span> <span style="color: #9cb6ad;">(</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">alist</span><span style="text-decoration: underline;">-</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">get</span> <span style="color: #51afef;">'</span><span style="color: #87cfc690d6c9; font-style: italic;">href</span> <span style="color: #91edb1e5c7aa;">attrs</span><span style="color: #9cb6ad;">)</span> <span style="color: #87cfc690d6c9;">url</span><span style="color: #a2b6da;">)</span><span style="color: #4db5bd;">)</span>
                     <span style="color: #4db5bd;">(</span><span style="color: #51afef;">or</span>
                      <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Return the first URL of preferred type</span>
                      <span style="color: #a2b6da;">(</span><span style="color: #51afef;">cl-loop</span> <span style="color: #91edb1e5c7aa;">for</span> <span style="color: #9cb6ad;">(</span><span style="color: #918b91cd9132;">tag</span> <span style="color: #91edb1e5c7aa;">attrs</span><span style="color: #9cb6ad;">)</span> <span style="color: #e1b3bbc0bb7e;">in</span> <span style="color: #7765a7b4c89a;">potential</span>-<span style="color: #87cfc690d6c9;">feeds</span>
                               <span style="color: #cd7fcd65ce32;">when</span> <span style="color: #9cb6ad;">(</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">equal</span> <span style="color: #87cfc690d6c9;">preferred</span>-<span style="color: #cf7ec31fb119;">type</span> <span style="color: #51afef;">(</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">alist</span><span style="text-decoration: underline;">-</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">get</span> <span style="color: #51afef;">'</span><span style="color: #cf7ec31fb119; font-style: italic;">type</span> <span style="color: #91edb1e5c7aa;">attrs</span><span style="color: #51afef;">)</span><span style="color: #9cb6ad;">)</span>
                               <span style="color: #cd65b84f9999;">return</span> <span style="color: #9cb6ad;">(</span><span style="color: #87cfc690d6c9; text-decoration: underline;">url</span><span style="text-decoration: underline;">-</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">expand</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">file</span><span style="text-decoration: underline;">-</span><span style="color: #87cfc690d6c9; text-decoration: underline;">name</span> <span style="color: #51afef;">(</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">alist</span><span style="text-decoration: underline;">-</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">get</span> <span style="color: #51afef;">'</span><span style="color: #87cfc690d6c9; font-style: italic;">href</span> <span style="color: #91edb1e5c7aa;">attrs</span><span style="color: #51afef;">)</span> <span style="color: #87cfc690d6c9;">url</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span>
                      <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Return the first URL of non-preferred type</span>
                      <span style="color: #a2b6da;">(</span><span style="color: #51afef;">cl-loop</span> <span style="color: #91edb1e5c7aa;">for</span> <span style="color: #9cb6ad;">(</span><span style="color: #918b91cd9132;">tag</span> <span style="color: #91edb1e5c7aa;">attrs</span><span style="color: #9cb6ad;">)</span> <span style="color: #e1b3bbc0bb7e;">in</span> <span style="color: #7765a7b4c89a;">potential</span>-<span style="color: #87cfc690d6c9;">feeds</span>
                               <span style="color: #cd7fcd65ce32;">when</span> <span style="color: #9cb6ad;">(</span><span style="color: #87cfc690d6c9;">feed</span>-<span style="color: #cf7ec31fb119;">p</span> <span style="color: #51afef;">(</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">alist</span><span style="text-decoration: underline;">-</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">get</span> <span style="color: #51afef;">'</span><span style="color: #cf7ec31fb119; font-style: italic;">type</span> <span style="color: #91edb1e5c7aa;">attrs</span><span style="color: #51afef;">)</span><span style="color: #9cb6ad;">)</span>
                               <span style="color: #cd65b84f9999;">return</span> <span style="color: #9cb6ad;">(</span><span style="color: #87cfc690d6c9; text-decoration: underline;">url</span><span style="text-decoration: underline;">-</span><span style="color: #9e4c9e4c9e4c; text-decoration: underline;">expand</span><span style="text-decoration: underline;">-</span><span style="color: #918b91cd9132; text-decoration: underline;">file</span><span style="text-decoration: underline;">-</span><span style="color: #87cfc690d6c9; text-decoration: underline;">name</span> <span style="color: #51afef;">(</span><span style="color: #ad9a8c4c7464; text-decoration: underline;">alist</span><span style="text-decoration: underline;">-</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">get</span> <span style="color: #51afef;">'</span><span style="color: #87cfc690d6c9; font-style: italic;">href</span> <span style="color: #91edb1e5c7aa;">attrs</span><span style="color: #51afef;">)</span> <span style="color: #87cfc690d6c9;">url</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #4db5bd;">)</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #da8548;">)</span>
      <span style="color: #da8548;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span><span style="color: #e1b3bbc0bb7e; text-decoration: underline;">called</span><span style="text-decoration: underline;">-</span><span style="color: #ad489b408e50; text-decoration: underline;">interactively</span><span style="text-decoration: underline;">-</span><span style="color: #cf7ec31fb119; text-decoration: underline;">p</span><span style="color: #a9a1e1;">)</span>
          <span style="color: #a9a1e1;">(</span><span style="color: #91edb1e5c7aa; text-decoration: underline;">insert</span> <span style="color: #ECBE7B;">(</span><span style="color: #51afef;">if</span> <span style="color: #4db5bd;">(</span><span style="color: #bbe6ba32c7cd; text-decoration: underline;">listp</span> <span style="color: #cd65b84f9999;">return</span><span style="color: #4db5bd;">)</span>
                      <span style="color: #4db5bd;">(</span><span style="color: #7765a7b4c89a; text-decoration: underline;">s</span><span style="text-decoration: underline;">-</span><span style="color: #6b65c2f6d999; text-decoration: underline;">join</span> <span style="color: #98be65;">" "</span> <span style="color: #cd65b84f9999;">return</span><span style="color: #4db5bd;">)</span>
                    <span style="color: #cd65b84f9999;">return</span><span style="color: #ECBE7B;">)</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #cd65b84f9999;">return</span><span style="color: #da8548;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4c795e5" class="outline-2">
<h2 id="org4c795e5">License</h2>
<div class="outline-text-2" id="text-org4c795e5">
<p>
GPLv3
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Adam Porter</p>
<p class="date">Created: 2018-12-25 Tue 11:49</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
