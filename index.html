<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2019-01-04 Fri 00:13 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>unpackaged.el</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Adam Porter" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="export/styles/darksun/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="export/styles/darksun/css/darksun.css"/>
<link rel="stylesheet" type="text/css" href="export/styles/darksun/css/hideshow.css"/>
<script type="text/javascript" src="export/styles/darksun/js/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="export/styles/darksun/js/jquery-ui-1.10.2.min.js"></script>
<script type="text/javascript" src="export/styles/darksun/js/jquery.localscroll-min.js"></script>
<script type="text/javascript" src="export/styles/darksun/js/jquery.scrollTo-1.4.3.1-min.js"></script>
<script type="text/javascript" src="export/styles/darksun/js/jquery.zclip.min.js"></script>
<script type="text/javascript" src="export/styles/darksun/js/darksun.js"></script>
<script type="text/javascript" src="export/styles/darksun/js/hideshow.js"></script>
<script type="text/javascript" src="export/styles/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">unpackaged.el</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgb70e7d5">Usage</a></li>
<li><a href="#orgb30d0df">Faces, fonts&#xa0;&#xa0;&#xa0;<span class="tag"><span class="faces">faces</span>&#xa0;<span class="fonts">fonts</span></span></a>
<ul>
<li><a href="#org16b563d">font-compare</a></li>
</ul>
</li>
<li><a href="#org50ccf60">Meta&#xa0;&#xa0;&#xa0;<span class="tag"><span class="meta">meta</span></span></a></li>
<li><a href="#orgb75a688">Misc</a>
<ul>
<li><a href="#org991a5de">Track metadata from MPRIS-supporting media player&#xa0;&#xa0;&#xa0;<span class="tag"><span class="DBus">DBus</span></span></a></li>
</ul>
</li>
<li><a href="#orgab94a98">Org&#xa0;&#xa0;&#xa0;<span class="tag"><span class="Org">Org</span></span></a>
<ul>
<li><a href="#org315e677">Agenda previews&#xa0;&#xa0;&#xa0;<span class="tag"><span class="agenda">agenda</span></span></a></li>
<li><a href="#org8e486cb">Convert Elisp to Org format&#xa0;&#xa0;&#xa0;<span class="tag"><span class="meta">meta</span></span></a></li>
<li><a href="#org2cc7e24">Download and attach remote files</a></li>
<li><a href="#org0384ca8">Ensure blank lines between headings and before contents</a></li>
<li><a href="#orga4c9ed7">Export to HTML with <i>useful</i> anchors</a></li>
<li><a href="#orgce0779e">Surround region with emphasis or syntax characters</a></li>
<li><a href="#orgd039929">Refile to datetree file using earliest/latest timestamp in entry</a></li>
<li><a href="#org0033a67"><code>org-return-dwim</code></a></li>
<li><a href="#orgdff242d">Read-only trees</a></li>
<li><a href="#orgbb432b1">Sort tree by multiple methods at once</a></li>
</ul>
</li>
<li><a href="#orgc9ecae2">Packages&#xa0;&#xa0;&#xa0;<span class="tag"><span class="packages">packages</span></span></a>
<ul>
<li><a href="#org1e3db48">Delete all installed versions of a package</a></li>
<li><a href="#org121bcc8">Upgrade a <code>quelpa-use-package</code> form's package</a></li>
<li><a href="#org2578630">Upgrade one package in the package menu</a></li>
</ul>
</li>
<li><a href="#orga38630c">Programming&#xa0;&#xa0;&#xa0;<span class="tag"><span class="programming">programming</span></span></a>
<ul>
<li><a href="#orgfbcf0e1">Flexibly fill/unfill paragraphs</a></li>
<li><a href="#org3602adb"><code>iedit</code>&#xa0;&#xa0;&#xa0;<span class="tag"><span class="iedit">iedit</span>&#xa0;<span class="refactoring">refactoring</span></span></a>
<ul>
<li><a href="#org2aac221"><code>iedit-scoped</code></a></li>
<li><a href="#orgbd7ee18"><code>iedit-or-flyspell</code>&#xa0;&#xa0;&#xa0;<span class="tag"><span class="flyspell">flyspell</span>&#xa0;<span class="spell_checking">spell_checking</span></span></a></li>
</ul>
</li>
<li><a href="#orgac2ff5c">Sort sexps</a></li>
</ul>
</li>
<li><a href="#org57a1311">Regular expressions&#xa0;&#xa0;&#xa0;<span class="tag"><span class="regular_expressions">regular_expressions</span></span></a>
<ul>
<li><a href="#org8f60cdc">query-replace-rx</a></li>
</ul>
</li>
<li><a href="#org31c4239">Version control&#xa0;&#xa0;&#xa0;<span class="tag"><span class="version_control">version_control</span></span></a>
<ul>
<li><a href="#org64ad416">Magit&#xa0;&#xa0;&#xa0;<span class="tag"><span class="Magit">Magit</span></span></a>
<ul>
<li><a href="#org3d9ea45">Improved <code>magit-status</code> command</a></li>
<li><a href="#org181ac38">magit-log date headers</a></li>
</ul>
</li>
<li><a href="#org4e7db72"><code>smerge-mode</code></a>
<ul>
<li><a href="#orge21f20f">Hydra</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org7ea7337">Web&#xa0;&#xa0;&#xa0;<span class="tag"><span class="web">web</span></span></a>
<ul>
<li><a href="#orgf046479">feed-for-url&#xa0;&#xa0;&#xa0;<span class="tag"><span class="RSS">RSS</span>&#xa0;<span class="Atom">Atom</span>&#xa0;<span class="XML">XML</span></span></a></li>
</ul>
</li>
<li><a href="#org7e9d2a5">License</a></li>
</ul>
</div>
</div>
<a href=https://alphapapa.github.io/dont-tread-on-emacs/><img src="images/dont-tread-on-emacs-150.png" align="right"></a>

<p>
A collection of useful Emacs Lisp code that isn't substantial enough to be packaged.  This code will be maintained here so that it can be updated and improved over time.
</p>

<p>
This can be viewed directly on the <a href="http://github.com/alphapapa/unpackaged.el">repository</a> or as <a href="http://alphapapa.github.io/unpackaged.el">HTML</a>.
</p>

<p>
Contributions welcome!
</p>

<p>
Functions in this file generally use these helper packages:
</p>

<ul class="org-ul">
<li><a href="https://github.com/magnars/dash.el">dash.el</a> (including <code>dash-functional</code>)</li>
<li><a href="https://github.com/magnars/s.el">s.el</a></li>
<li><a href="https://github.com/jwiegley/use-package">use-package</a></li>
</ul>

<div id="outline-container-orgb70e7d5" class="outline-2">
<h2 id="orgb70e7d5">Usage</h2>
<div class="outline-text-2" id="text-orgb70e7d5">
<p>
There are two ways to use the code in this "unpackage":
</p>

<dl class="org-dl">
<dt>Buffet</dt><dd>Choose the the parts you want and copy them into your init files.</dd>
<dt>Whole-hog</dt><dd>Load the file <code>unpackaged.el</code>, which is tangled from this Org file, e.g. <code>(require 'unpackaged)</code>.</dd>
</dl>

<p>
In general, the author will attempt to avoid code that modifies Emacs state by simply loading the tangled "unpackage," but this is not strictly guaranteed.  Please report any problems.
</p>

<p>
An easy way to "whole-hog it" is to use <a href="https://framagit.org/steckerhalter/quelpa-use-package">quelpa-use-package</a> like this:
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #9aaccb;">(</span><span style="color: #86aed5;">use-package</span> <span style="color: #5b8583;">unpackaged</span>
  <span style="color: #86aed5;">:quelpa</span> <span style="color: #5b8583;">(</span><span style="color: #909990999099;">unpackaged</span> <span style="color: #86aed5;">:fetcher</span> <span style="color: #700070007000;">github</span> <span style="color: #86aed5;">:repo</span> <span style="color: #858253;">"alphapapa/unpackaged.el"</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb30d0df" class="outline-2">
<h2 id="orgb30d0df">Faces, fonts&#xa0;&#xa0;&#xa0;<span class="tag"><span class="faces">faces</span>&#xa0;<span class="fonts">fonts</span></span></h2>
<div class="outline-text-2" id="text-orgb30d0df">
</div><div id="outline-container-org16b563d" class="outline-3">
<h3 id="org16b563d">font-compare</h3>
<div class="outline-text-3" id="text-org16b563d">
<p>
Compare <code>TEXT</code> displayed in <code>FONTS</code>.  <code>FONTS</code> is a list of font specs.
</p>

<p>
Interactively, prompt for <code>TEXT</code>, using <code>lorem-ipsum</code> text if nil or the empty string, and select <code>FONTS</code> with <code>x-select-font</code> (select an already-selected font to end font selection).
</p>

<p>
<b>Requires:</b>
</p>
<ul class="org-ul">
<li><a href="https://github.com/jschaf/emacs-lorem-ipsum">emacs-lorem-ipsum</a></li>
</ul>

<p>

</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #9aaccb;">(</span><span style="color: #86aed5;">defvar</span> <span style="color: #fdfdd5;">lorem-ipsum-text</span><span style="color: #9aaccb;">)</span>

<span style="color: #9aaccb;">(</span><span style="color: #86aed5;">defun</span> <span style="color: #fdfdd5;">unpackaged/font-compare</span> <span style="color: #5b8583;">(</span><span style="color: #78cc78cc78cc;">text</span> <span style="color: #9a009a009a00;">fonts</span><span style="color: #5b8583;">)</span>
  <span style="color: #52534d; font-weight: bold; font-style: italic;">"Compare TEXT displayed in FONTS.</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">If TEXT is nil, use `</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">lorem-ipsum</span><span style="color: #52534d; font-weight: bold; font-style: italic;">' text.  FONTS is a list of font</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">family strings and/or font specs.</span>

<span style="color: #52534d; font-weight: bold; font-style: italic;">Interactively, prompt for TEXT, using `</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">lorem-ipsum</span><span style="color: #52534d; font-weight: bold; font-style: italic;">' if left</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">empty, and select FONTS with `</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">x-select-font</span><span style="color: #52534d; font-weight: bold; font-style: italic;">' (select an</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">already-selected font to end font selection)."</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">interactive</span> <span style="color: #6688aa;">(</span><span style="color: #83cc83cc83cc; text-decoration: underline;">list</span> <span style="color: #858253;">(</span><span style="color: #86aed5;">pcase</span> <span style="color: #8686ae;">(</span><span style="color: #909990999099; text-decoration: underline;">read</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">string</span> <span style="color: #858253;">"Text: "</span><span style="color: #8686ae;">)</span>
                       <span style="color: #8686ae;">(</span><span style="color: #858253;">""</span> <span style="color: #a6cca6cca6cc;">nil</span><span style="color: #8686ae;">)</span>
                       <span style="color: #8686ae;">(</span><span style="color: #a6cca6cca6cc;">else</span> <span style="color: #a6cca6cca6cc;">else</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
                     <span style="color: #858253;">(</span><span style="color: #86aed5;">cl-loop</span> <span style="color: #ba4cba4cba4c;">for</span> <span style="color: #9a009a009a00;">font</span> = <span style="color: #8686ae;">(</span><span style="color: #6c006c006c00; text-decoration: underline;">x</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">select</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">font</span><span style="color: #8686ae;">)</span>
                              <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #990A1B;">HACK</span><span style="color: #586e75; font-weight: bold; font-style: italic;">: `</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">x-select-font</span><span style="color: #586e75; font-weight: bold; font-style: italic;">' calls quit() when the Cancel button is</span>
                              <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">pressed, so to avoid quit()'ing, we signal in-band by selecting a</span>
                              <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">font that has already been selected.</span>
                              <span style="color: #b0668cf47099;">while</span> <span style="color: #8686ae;">(</span><span style="color: #cb4b16; font-weight: bold;">not</span> <span style="color: #858253;">(</span><span style="color: #83cc83cc83cc; text-decoration: underline;">member</span> <span style="color: #9a009a009a00;">font</span> <span style="color: #9a009a009a00;">fonts</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span>
                              <span style="color: #a6cca6cca6cc;">collect</span> <span style="color: #9a009a009a00;">font</span> <span style="color: #909990999099;">into</span> <span style="color: #9a009a009a00;">fonts</span>
                              <span style="color: #700070007000;">finally</span> <span style="color: #a36673883b99;">return</span> <span style="color: #9a009a009a00;">fonts</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">setq</span> <span style="color: #78cc78cc78cc;">text</span> <span style="color: #6688aa;">(</span><span style="color: #86aed5;">or</span> <span style="color: #78cc78cc78cc;">text</span> <span style="color: #858253;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">s</span><span style="text-decoration: underline;">-</span><span style="color: #a6ffad95b400; text-decoration: underline;">word</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">wrap</span> <span style="color: #9a009a009a00;">80</span> <span style="color: #8686ae;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">s</span><span style="text-decoration: underline;">-</span><span style="color: #700070007000; text-decoration: underline;">join</span> <span style="color: #858253;">" "</span> <span style="color: #858253;">(</span><span style="color: #86aed5;">progn</span>
                                                    <span style="color: #dd8844;">(</span><span style="color: #86aed5;">require</span> <span style="color: #5b8583;">'</span><span style="color: #5b8583;">lorem-ipsum</span><span style="color: #dd8844;">)</span>
                                                    <span style="color: #dd8844;">(</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">seq</span><span style="text-decoration: underline;">-</span><span style="color: #700070007000; text-decoration: underline;">random</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">elt</span> <span style="color: #78cc78cc78cc;">lorem</span>-<span style="color: #9a009a009a00;">ipsum</span>-<span style="color: #78cc78cc78cc;">text</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">with-current-buffer</span> <span style="color: #6688aa;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">get</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">buffer</span><span style="text-decoration: underline;">-</span><span style="color: #78cc78cc78cc; text-decoration: underline;">create</span> <span style="color: #858253;">"*Font Compare*"</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #b0668cf47099; text-decoration: underline;">erase</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">buffer</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #86aed5;">--each</span> <span style="color: #9a009a009a00;">fonts</span>
      <span style="color: #858253;">(</span><span style="color: #86aed5;">let</span> <span style="color: #8686ae;">(</span><span style="color: #858253;">(</span><span style="color: #700070007000;">family</span> <span style="color: #dd8844;">(</span><span style="color: #86aed5;">cl-typecase</span> <span style="color: #fdfdd5;">it</span>
                      <span style="color: #a2b6da;">(</span><span style="color: #9a009a009a00;">font</span> <span style="color: #9cb6ad;">(</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">symbol</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">name</span> <span style="color: #9aaccb;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">font</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">get</span> <span style="color: #fdfdd5;">it</span> <span style="color: #86aed5;">:family</span><span style="color: #9aaccb;">)</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span>
                      <span style="color: #a2b6da;">(</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">string</span> <span style="color: #fdfdd5;">it</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span>
        <span style="color: #8686ae;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">insert</span> <span style="color: #700070007000;">family</span> <span style="color: #858253;">": "</span>
                <span style="color: #858253;">(</span><span style="color: #a36673883b99; text-decoration: underline;">propertize</span> <span style="color: #78cc78cc78cc;">text</span>
                            <span style="color: #5b8583;">'</span><span style="color: #700070007000;">face</span> <span style="color: #dd8844;">(</span><span style="color: #83cc83cc83cc; text-decoration: underline;">list</span> <span style="color: #86aed5;">:family</span> <span style="color: #700070007000;">family</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span>
                <span style="color: #858253;">"\n\n"</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #83cc83cc83cc; text-decoration: underline;">pop</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">to</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">buffer</span> <span style="color: #858253;">(</span><span style="color: #909990999099; text-decoration: underline;">current</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">buffer</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org50ccf60" class="outline-2">
<h2 id="org50ccf60">Meta&#xa0;&#xa0;&#xa0;<span class="tag"><span class="meta">meta</span></span></h2>
<div class="outline-text-2" id="text-org50ccf60">
<p>
Code used to help maintain this document.  (Note: These links don't work in GitHub's renderer.)
</p>

<ul class="org-ul">
<li></li>
</ul>
</div>
</div>

<div id="outline-container-orgb75a688" class="outline-2">
<h2 id="orgb75a688">Misc</h2>
<div class="outline-text-2" id="text-orgb75a688">
</div><div id="outline-container-org991a5de" class="outline-3">
<h3 id="org991a5de">Track metadata from MPRIS-supporting media player&#xa0;&#xa0;&#xa0;<span class="tag"><span class="DBus">DBus</span></span></h3>
<div class="outline-text-3" id="text-org991a5de">
<p>
Return the artist, album, and title of the track playing in MPRIS-supporting player.  Returns a string in format <code>ARTIST - ~ALBUM~: ~TITLE~ [PLAYER]</code>.  If no track is playing, returns nil.  If more than one player is playing, uses the first one found in DBus.  If <code>PLAYER</code> is non-nil, include the name of the player in the output string.
</p>

<p>
DBus is not a straightforward system to work with, so this may serve as a useful example, or save someone the trouble of figuring out how to get this metadata.
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #9aaccb;">(</span><span style="color: #86aed5;">cl-defun</span> <span style="color: #fdfdd5;">unpackaged/mpris-track</span> <span style="color: #5b8583;">(</span><span style="color: #8686ae;">&amp;optional</span> <span style="color: #9a009a009a00;">player</span><span style="color: #5b8583;">)</span>
  <span style="color: #52534d; font-weight: bold; font-style: italic;">"Return the artist, album, and title of the track playing in MPRIS-supporting player.</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">Returns a string in format \"ARTIST - ALBUM: TITLE [PLAYER]\".  If no track is</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">playing, returns nil.  If more than one player is playing, uses</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">the first one found in DBus.</span>

<span style="color: #52534d; font-weight: bold; font-style: italic;">If PLAYER is non-nil, include the name of the player in the</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">output string."</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">require</span> <span style="color: #5b8583;">'</span><span style="color: #5b8583;">dbus</span><span style="color: #5b8583;">)</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">when-let*</span> <span style="color: #6688aa;">(</span><span style="color: #858253;">(</span><span style="color: #b0668cf47099;">mpris</span>-<span style="color: #83cc83cc83cc;">services</span> <span style="color: #8686ae;">(</span><span style="color: #86aed5;">--select</span> <span style="color: #858253;">(</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">string</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">prefix</span><span style="text-decoration: underline;">-</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">p</span> <span style="color: #858253;">"org.mpris.MediaPlayer2."</span> <span style="color: #fdfdd5;">it</span><span style="color: #858253;">)</span>
                                        <span style="color: #858253;">(</span><span style="color: #6c006c006c00; text-decoration: underline;">dbus</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">list</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">known</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">names</span> <span style="color: #86aed5;">:session</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
              <span style="color: #858253;">(</span><span style="color: #a9ba7fd34edf;">playing</span>-<span style="color: #a6cca6cca6cc;">service</span> <span style="color: #8686ae;">(</span><span style="color: #86aed5;">--first</span> <span style="color: #858253;">(</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">string</span><span style="text-decoration: underline;">=</span> <span style="color: #858253;">"Playing"</span>
                                                 <span style="color: #dd8844;">(</span><span style="color: #6c006c006c00; text-decoration: underline;">dbus</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">get</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">property</span> <span style="color: #86aed5;">:session</span> <span style="color: #fdfdd5;">it</span>
                                                                    <span style="color: #858253;">"/org/mpris/MediaPlayer2"</span>
                                                                    <span style="color: #858253;">"org.mpris.MediaPlayer2.Player"</span>
                                                                    <span style="color: #858253;">"PlaybackStatus"</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span>
                                        <span style="color: #b0668cf47099;">mpris</span>-<span style="color: #83cc83cc83cc;">services</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
              <span style="color: #858253;">(</span><span style="color: #9a009a009a00;">player</span>-<span style="color: #7ccc7ccc7ccc;">name</span> <span style="color: #8686ae;">(</span><span style="color: #6c006c006c00; text-decoration: underline;">dbus</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">get</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">property</span> <span style="color: #86aed5;">:session</span> <span style="color: #a9ba7fd34edf;">playing</span>-<span style="color: #a6cca6cca6cc;">service</span>
                                              <span style="color: #858253;">"/org/mpris/MediaPlayer2"</span>
                                              <span style="color: #858253;">"org.mpris.MediaPlayer2"</span>
                                              <span style="color: #858253;">"Identity"</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
              <span style="color: #858253;">(</span><span style="color: #83cc83cc83cc;">metadata</span> <span style="color: #8686ae;">(</span><span style="color: #6c006c006c00; text-decoration: underline;">dbus</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">get</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">property</span> <span style="color: #86aed5;">:session</span> <span style="color: #a9ba7fd34edf;">playing</span>-<span style="color: #a6cca6cca6cc;">service</span>
                                           <span style="color: #858253;">"/org/mpris/MediaPlayer2"</span>
                                           <span style="color: #858253;">"org.mpris.MediaPlayer2.Player"</span>
                                           <span style="color: #858253;">"Metadata"</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span>
    <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">`</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">-let</span><span style="color: #586e75; font-weight: bold; font-style: italic;">' makes it easy to get the actual strings out of the nested lists of lists of strings.</span>
    <span style="color: #6688aa;">(</span><span style="color: #86aed5;">-let</span> <span style="color: #858253;">(</span><span style="color: #8686ae;">(</span><span style="color: #858253;">(</span><span style="color: #8686ae;">&amp;alist</span> <span style="color: #858253;">"xesam:artist"</span> <span style="color: #dd8844;">(</span><span style="color: #a2b6da;">(</span><span style="color: #ba4cba4cba4c;">artists</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span>
                    <span style="color: #858253;">"xesam:album"</span> <span style="color: #dd8844;">(</span><span style="color: #a2b6da;">(</span><span style="color: #6c006c006c00;">album</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span>
                    <span style="color: #858253;">"xesam:title"</span> <span style="color: #dd8844;">(</span><span style="color: #a2b6da;">(</span><span style="color: #afaa9b418aed;">title</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span>
            <span style="color: #83cc83cc83cc;">metadata</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
      <span style="color: #858253;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">format</span> <span style="color: #858253;">"%s - %s: %s%s"</span> <span style="color: #8686ae;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">s</span><span style="text-decoration: underline;">-</span><span style="color: #700070007000; text-decoration: underline;">join</span> <span style="color: #858253;">", "</span> <span style="color: #ba4cba4cba4c;">artists</span><span style="color: #8686ae;">)</span> <span style="color: #6c006c006c00;">album</span> <span style="color: #afaa9b418aed;">title</span>
              <span style="color: #8686ae;">(</span><span style="color: #86aed5;">if</span> <span style="color: #9a009a009a00;">player</span>
                  <span style="color: #858253;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">format</span> <span style="color: #858253;">" [%s]"</span> <span style="color: #9a009a009a00;">player</span>-<span style="color: #7ccc7ccc7ccc;">name</span><span style="color: #858253;">)</span>
                <span style="color: #858253;">""</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgab94a98" class="outline-2">
<h2 id="orgab94a98">Org&#xa0;&#xa0;&#xa0;<span class="tag"><span class="Org">Org</span></span></h2>
<div class="outline-text-2" id="text-orgab94a98">
<p>
Code for <a href="https://orgmode.org/">Org Mode</a>.
</p>
</div>


<div id="outline-container-org315e677" class="outline-3">
<h3 id="org315e677">Agenda previews&#xa0;&#xa0;&#xa0;<span class="tag"><span class="agenda">agenda</span></span></h3>
<div class="outline-text-3" id="text-org315e677">
<p>
<i>Before:</i>
</p>

<p>

</p>

<p>
<i>After:</i>
</p>

<p>

</p>

<p>
<b>Requires:</b>
</p>
<ul class="org-ul">
<li><a href="https://github.com/ShingoFukuyama/ov.el">ov</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #9aaccb;">(</span><span style="color: #86aed5;">defface</span> <span style="color: #fdfdd5;">unpackaged/org-agenda-preview</span>
  <span style="color: #5b8583;">'</span><span style="color: #5b8583;">(</span><span style="color: #6688aa;">(</span><span style="color: #9a009a009a00;">t</span> <span style="color: #858253;">(</span><span style="color: #86aed5;">:background</span> <span style="color: #858253;">"black"</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span>
  <span style="color: #52534d; font-weight: bold; font-style: italic;">"Face for Org Agenda previews."</span>
  <span style="color: #86aed5;">:group</span> <span style="color: #5b8583;">'</span><span style="color: #a6ffad95b400;">org</span><span style="color: #9aaccb;">)</span>

<span style="color: #9aaccb;">(</span><span style="color: #86aed5;">defun</span> <span style="color: #fdfdd5;">unpackaged/org-agenda-toggle-preview</span> <span style="color: #5b8583;">()</span>
  <span style="color: #52534d; font-weight: bold; font-style: italic;">"Toggle overlay of current item in agenda."</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">interactive</span><span style="color: #5b8583;">)</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">if-let*</span> <span style="color: #6688aa;">(</span><span style="color: #858253;">(</span><span style="color: #7ccc7ccc7ccc;">overlay</span> <span style="color: #8686ae;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">ov</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">in</span> <span style="color: #5b8583;">'</span><span style="color: #909990999099;">unpackaged</span>/<span style="color: #a6ffad95b400;">org</span>-<span style="color: #9a009a009a00;">agenda</span>-<span style="color: #a36673883b99;">preview</span> <span style="color: #9a009a009a00;">t</span> <span style="color: #858253;">(</span><span style="color: #83cc83cc83cc; text-decoration: underline;">line</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">end</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">position</span><span style="color: #858253;">)</span> <span style="color: #858253;">(</span><span style="color: #83cc83cc83cc; text-decoration: underline;">line</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">end</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">position</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span>
      <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Hide existing preview</span>
      <span style="color: #6688aa;">(</span><span style="color: #86aed5;">ov-reset</span> <span style="color: #7ccc7ccc7ccc;">overlay</span><span style="color: #6688aa;">)</span>
    <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Show preview</span>
    <span style="color: #6688aa;">(</span><span style="color: #86aed5;">let*</span> <span style="color: #858253;">(</span><span style="color: #8686ae;">(</span><span style="color: #909990999099;">entry</span>-<span style="color: #83cc83cc83cc;">contents</span> <span style="color: #858253;">(</span><span style="color: #86aed5;">--&gt;</span> <span style="color: #dd8844;">(</span><span style="color: #86aed5;">org-agenda-with-point-at-orig-entry</span>
                                 <span style="color: #a6cca6cca6cc;">nil</span> <span style="color: #a2b6da;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">buffer</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">substring</span> <span style="color: #9cb6ad;">(</span><span style="color: #86aed5;">save-excursion</span>
                                                         <span style="color: #9aaccb;">(</span><span style="color: #909990999099; text-decoration: underline;">unpackaged</span><span style="text-decoration: underline;">/</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">forward</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">to</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">entry</span><span style="text-decoration: underline;">-</span><span style="color: #afaa9b418aed; text-decoration: underline;">content</span> <span style="color: #9a009a009a00;">t</span><span style="color: #9aaccb;">)</span>
                                                         <span style="color: #9aaccb;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">point</span><span style="color: #9aaccb;">)</span><span style="color: #9cb6ad;">)</span>
                                                       <span style="color: #9cb6ad;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">entry</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">end</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">position</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span>
                                <span style="color: #a6ffad95b400;">s</span>-<span style="color: #a6cca6cca6cc;">trim</span>
                                <span style="color: #dd8844;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">concat</span> <span style="color: #858253;">"\n"</span> <span style="color: #fdfdd5;">it</span> <span style="color: #858253;">"\n"</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
      <span style="color: #858253;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">add</span><span style="text-decoration: underline;">-</span><span style="color: #700070007000; text-decoration: underline;">face</span><span style="text-decoration: underline;">-</span><span style="color: #78cc78cc78cc; text-decoration: underline;">text</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">property</span> <span style="color: #7ccc7ccc7ccc;">0</span> <span style="color: #8686ae;">(</span><span style="color: #a36673883b99; text-decoration: underline;">length</span> <span style="color: #909990999099;">entry</span>-<span style="color: #83cc83cc83cc;">contents</span><span style="color: #8686ae;">)</span>
                              <span style="color: #5b8583;">'</span><span style="color: #909990999099;">unpackaged</span>/<span style="color: #a6ffad95b400;">org</span>-<span style="color: #9a009a009a00;">agenda</span>-<span style="color: #a36673883b99;">preview</span> <span style="color: #a6cca6cca6cc;">nil</span> <span style="color: #909990999099;">entry</span>-<span style="color: #83cc83cc83cc;">contents</span><span style="color: #858253;">)</span>
      <span style="color: #858253;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">ov</span> <span style="color: #8686ae;">(</span><span style="color: #83cc83cc83cc; text-decoration: underline;">line</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">end</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">position</span><span style="color: #8686ae;">)</span> <span style="color: #8686ae;">(</span><span style="color: #83cc83cc83cc; text-decoration: underline;">line</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">end</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">position</span><span style="color: #8686ae;">)</span>
          <span style="color: #5b8583;">'</span><span style="color: #909990999099;">unpackaged</span>/<span style="color: #a6ffad95b400;">org</span>-<span style="color: #9a009a009a00;">agenda</span>-<span style="color: #a36673883b99;">preview</span> <span style="color: #9a009a009a00;">t</span>
          <span style="color: #5b8583;">'</span><span style="color: #a6cca6cca6cc;">before</span>-<span style="color: #a6cca6cca6cc;">string</span> <span style="color: #909990999099;">entry</span>-<span style="color: #83cc83cc83cc;">contents</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span>

<span style="color: #9aaccb;">(</span><span style="color: #86aed5;">defun</span> <span style="color: #fdfdd5;">unpackaged/org-forward-to-entry-content</span> <span style="color: #5b8583;">(</span><span style="color: #8686ae;">&amp;optional</span> <span style="color: #83cc83cc83cc;">unsafe</span><span style="color: #5b8583;">)</span>
  <span style="color: #52534d; font-weight: bold; font-style: italic;">"Skip headline, planning line, and all drawers in current entry.</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">If UNSAFE is non-nil, assume point is on headline."</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">unless</span> <span style="color: #83cc83cc83cc;">unsafe</span>
    <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">To improve performance in loops (e.g. with `</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">org-map-entries</span><span style="color: #586e75; font-weight: bold; font-style: italic;">')</span>
    <span style="color: #6688aa;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #700070007000; text-decoration: underline;">back</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">to</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">heading</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">cl-loop</span> <span style="color: #ba4cba4cba4c;">for</span> <span style="color: #83cc83cc83cc;">element</span> = <span style="color: #6688aa;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">element</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">at</span><span style="text-decoration: underline;">-</span><span style="color: #afaa9b418aed; text-decoration: underline;">point</span><span style="color: #6688aa;">)</span>
           <span style="color: #ba4cba4cba4c;">for</span> <span style="color: #9a009a009a00;">pos</span> = <span style="color: #6688aa;">(</span><span style="color: #86aed5;">pcase</span> <span style="color: #83cc83cc83cc;">element</span>
                       <span style="color: #858253;">(</span><span style="color: #5b8583;">`</span><span style="color: #8686ae;">(</span><span style="color: #78cc78cc78cc;">headline</span> . ,_<span style="color: #8686ae;">)</span> <span style="color: #8686ae;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">element</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">property</span> <span style="color: #86aed5;">:contents-begin</span> <span style="color: #83cc83cc83cc;">element</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
                       <span style="color: #858253;">(</span><span style="color: #5b8583;">`</span><span style="color: #8686ae;">(</span>,<span style="color: #858253;">(</span><span style="color: #86aed5;">or</span> <span style="color: #5b8583;">'</span><span style="color: #6c006c006c00;">planning</span> <span style="color: #5b8583;">'</span><span style="color: #7ccc7ccc7ccc;">property</span>-<span style="color: #afaa9b418aed;">drawer</span> <span style="color: #5b8583;">'</span><span style="color: #afaa9b418aed;">drawer</span><span style="color: #858253;">)</span> . ,_<span style="color: #8686ae;">)</span> <span style="color: #8686ae;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">element</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">property</span> <span style="color: #86aed5;">:end</span> <span style="color: #83cc83cc83cc;">element</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span>
           <span style="color: #b0668cf47099;">while</span> <span style="color: #9a009a009a00;">pos</span>
           <span style="color: #78cc78cc78cc;">do</span> <span style="color: #6688aa;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">char</span> <span style="color: #9a009a009a00;">pos</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8e486cb" class="outline-3">
<h3 id="org8e486cb"><a id="ID-b86d14ff-b87c-4e2a-a513-067c0a5d3490"></a>Convert Elisp to Org format&#xa0;&#xa0;&#xa0;<span class="tag"><span class="meta">meta</span></span></h3>
<div class="outline-text-3" id="text-org8e486cb">
<p>
These functions convert Emacs Lisp code and docstrings to Org-formatted text, helpful for inserting into readme files (like this one).
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #9aaccb;">(</span><span style="color: #86aed5;">defun</span> <span style="color: #fdfdd5;">unpackaged/elisp-to-org</span> <span style="color: #5b8583;">()</span>
  <span style="color: #52534d; font-weight: bold; font-style: italic;">"Convert elisp code in region to Org syntax and put in kill-ring.</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">Extracts and converts docstring to Org text, and places code in</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">source block."</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">interactive</span><span style="color: #5b8583;">)</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">let*</span> <span style="color: #6688aa;">(</span><span style="color: #858253;">(</span><span style="color: #700070007000;">raw</span> <span style="color: #8686ae;">(</span><span style="color: #86aed5;">-&gt;&gt;</span> <span style="color: #858253;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">buffer</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">substring</span> <span style="color: #dd8844;">(</span><span style="color: #6c006c006c00; text-decoration: underline;">region</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">beginning</span><span style="color: #dd8844;">)</span> <span style="color: #dd8844;">(</span><span style="color: #6c006c006c00; text-decoration: underline;">region</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">end</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span>
                   <span style="color: #858253;">(</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">replace</span><span style="text-decoration: underline;">-</span><span style="color: #700070007000; text-decoration: underline;">regexp</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">in</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">string</span> <span style="color: #dd8844;">(</span><span style="color: #86aed5;">rx</span> <span style="color: #ba4cba4cba4c;">bol</span><span style="color: #dd8844;">)</span> <span style="color: #858253;">"  "</span><span style="color: #858253;">)</span>
                   <span style="color: #858253;">(</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">replace</span><span style="text-decoration: underline;">-</span><span style="color: #700070007000; text-decoration: underline;">regexp</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">in</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">string</span> <span style="color: #dd8844;">(</span><span style="color: #86aed5;">rx</span> <span style="color: #ba4cba4cba4c;">bol</span> <span style="color: #a2b6da;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">1</span><span style="text-decoration: underline;">+</span> <span style="color: #909990999099;">blank</span><span style="color: #a2b6da;">)</span> <span style="color: #78cc78cc78cc;">eol</span><span style="color: #dd8844;">)</span> <span style="color: #858253;">""</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
         <span style="color: #858253;">(</span><span style="color: #9a009a009a00;">sexp</span> <span style="color: #8686ae;">(</span><span style="color: #909990999099; text-decoration: underline;">read</span> <span style="color: #700070007000;">raw</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
         <span style="color: #858253;">(</span><span style="color: #83cc83cc83cc;">docstring</span> <span style="color: #8686ae;">(</span><span style="color: #86aed5;">--when-let</span> <span style="color: #858253;">(</span><span style="text-decoration: underline;">-</span><span style="color: #a36673883b99; text-decoration: underline;">first</span> <span style="color: #5b8583;">#'</span><span style="color: #9a009a009a00;">stringp</span> <span style="color: #9a009a009a00;">sexp</span><span style="color: #858253;">)</span>
                      <span style="color: #858253;">(</span><span style="color: #909990999099; text-decoration: underline;">unpackaged</span><span style="text-decoration: underline;">/</span><span style="color: #83cc83cc83cc; text-decoration: underline;">docstring</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">to</span><span style="text-decoration: underline;">-</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span> <span style="color: #fdfdd5;">it</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #78cc78cc78cc; text-decoration: underline;">kill</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">new</span> <span style="color: #858253;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">concat</span> <span style="color: #83cc83cc83cc;">docstring</span> <span style="color: #8686ae;">(</span><span style="color: #86aed5;">when</span> <span style="color: #83cc83cc83cc;">docstring</span> <span style="color: #858253;">"\n\n"</span><span style="color: #8686ae;">)</span>
                      <span style="color: #858253;">"#+BEGIN_SRC elisp"</span> <span style="color: #858253;">"\n"</span>
                      <span style="color: #700070007000;">raw</span> <span style="color: #858253;">"\n"</span>
                      <span style="color: #858253;">"#+END_SRC"</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span>

<span style="color: #9aaccb;">(</span><span style="color: #86aed5;">defun</span> <span style="color: #fdfdd5;">unpackaged/docstring-to-org</span> <span style="color: #5b8583;">(</span><span style="color: #83cc83cc83cc;">docstring</span><span style="color: #5b8583;">)</span>
  <span style="color: #52534d; font-weight: bold; font-style: italic;">"Return DOCSTRING as formatted Org text.</span>

<span style="color: #52534d; font-weight: bold; font-style: italic;">Interactively, get text from region, and kill formatted Org text</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">to kill-ring."</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">interactive</span> <span style="color: #6688aa;">(</span><span style="color: #83cc83cc83cc; text-decoration: underline;">list</span> <span style="color: #858253;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">buffer</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">substring</span> <span style="color: #8686ae;">(</span><span style="color: #6c006c006c00; text-decoration: underline;">region</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">beginning</span><span style="color: #8686ae;">)</span> <span style="color: #8686ae;">(</span><span style="color: #6c006c006c00; text-decoration: underline;">region</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">end</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">cl-macrolet</span> <span style="color: #6688aa;">(</span><span style="color: #858253;">(</span><span style="color: #a6cca6cca6cc;">string</span>-<span style="color: #9a009a009a00;">buffer</span>--&gt; <span style="color: #8686ae;">(</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">string</span> <span style="color: #8686ae;">&amp;rest</span> <span style="color: #9a009a009a00;">forms</span><span style="color: #8686ae;">)</span>
                                  <span style="color: #5b8583;">`</span><span style="color: #8686ae;">(</span><span style="color: #86aed5;">with-temp-buffer</span>
                                     <span style="color: #858253;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">insert</span> ,<span style="color: #a6cca6cca6cc;">string</span><span style="color: #858253;">)</span>
                                     ,@<span style="color: #858253;">(</span><span style="color: #86aed5;">cl-loop</span> <span style="color: #ba4cba4cba4c;">for</span> <span style="color: #83cc83cc83cc;">form</span> <span style="color: #909990999099;">in</span> <span style="color: #9a009a009a00;">forms</span>
                                                <span style="color: #a6cca6cca6cc;">collect</span> <span style="color: #5b8583;">`</span><span style="color: #dd8844;">(</span><span style="color: #9a009a009a00;">goto</span>-<span style="color: #6c006c006c00;">char</span> <span style="color: #a2b6da;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">min</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span>
                                                <span style="color: #a6cca6cca6cc;">collect</span> <span style="color: #83cc83cc83cc;">form</span><span style="color: #858253;">)</span>
                                     <span style="color: #858253;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">buffer</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">string</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #86aed5;">--&gt;</span> <span style="color: #858253;">(</span><span style="color: #a6cca6cca6cc;">string</span>-<span style="color: #9a009a009a00;">buffer</span>--&gt; <span style="color: #83cc83cc83cc;">docstring</span>
                           <span style="color: #8686ae;">(</span><span style="color: #909990999099; text-decoration: underline;">unpackaged</span><span style="text-decoration: underline;">/</span><span style="color: #a6ffad95b400; text-decoration: underline;">caps</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">to</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">code</span> <span style="color: #858253;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">min</span><span style="color: #858253;">)</span> <span style="color: #858253;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">max</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span>
                           <span style="color: #8686ae;">(</span><span style="color: #909990999099; text-decoration: underline;">unpackaged</span><span style="text-decoration: underline;">/</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">symbol</span><span style="text-decoration: underline;">-</span><span style="color: #a6ffad95b400; text-decoration: underline;">quotes</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">to</span><span style="text-decoration: underline;">-</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">code</span> <span style="color: #858253;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">min</span><span style="color: #858253;">)</span> <span style="color: #858253;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">max</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span>
                           <span style="color: #8686ae;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">unfill</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">region</span> <span style="color: #858253;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">min</span><span style="color: #858253;">)</span> <span style="color: #858253;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">max</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span>
                           <span style="color: #8686ae;">(</span><span style="color: #86aed5;">while</span> <span style="color: #858253;">(</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">re</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">search</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">forward</span> <span style="color: #dd8844;">(</span><span style="color: #86aed5;">rx</span> <span style="color: #ba4cba4cba4c;">bol</span> <span style="color: #a2b6da;">(</span><span style="color: #a6cca6cca6cc;">group</span> <span style="color: #9cb6ad;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">1</span><span style="text-decoration: underline;">+</span> <span style="color: #909990999099;">blank</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span> <span style="color: #a6cca6cca6cc;">nil</span> <span style="color: #9a009a009a00;">t</span><span style="color: #858253;">)</span>
                             <span style="color: #858253;">(</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">replace</span><span style="text-decoration: underline;">-</span><span style="color: #78cc78cc78cc; text-decoration: underline;">match</span> <span style="color: #858253;">""</span> <span style="color: #9a009a009a00;">t</span> <span style="color: #9a009a009a00;">t</span> <span style="color: #a6cca6cca6cc;">nil</span> <span style="color: #ba4cba4cba4c;">1</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span>
                           <span style="color: #8686ae;">(</span><span style="color: #86aed5;">when</span> <span style="color: #858253;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">looking</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">at</span> <span style="color: #858253;">"\""</span><span style="color: #858253;">)</span>
                             <span style="color: #858253;">(</span><span style="color: #83cc83cc83cc; text-decoration: underline;">delete</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">char</span> <span style="color: #ba4cba4cba4c;">1</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span>
                           <span style="color: #8686ae;">(</span><span style="color: #86aed5;">when</span> <span style="color: #858253;">(</span><span style="color: #86aed5;">progn</span>
                                   <span style="color: #dd8844;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">char</span> <span style="color: #a2b6da;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">max</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span>
                                   <span style="color: #dd8844;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">looking</span><span style="text-decoration: underline;">-</span><span style="color: #700070007000; text-decoration: underline;">back</span> <span style="color: #858253;">"\""</span> <span style="color: #a6cca6cca6cc;">nil</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span>
                             <span style="color: #858253;">(</span><span style="color: #83cc83cc83cc; text-decoration: underline;">delete</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">char</span> -<span style="color: #ba4cba4cba4c;">1</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
         <span style="color: #858253;">(</span><span style="color: #86aed5;">if</span> <span style="color: #8686ae;">(</span><span style="color: #909990999099; text-decoration: underline;">called</span><span style="text-decoration: underline;">-</span><span style="color: #afaa9b418aed; text-decoration: underline;">interactively</span><span style="text-decoration: underline;">-</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">p</span> <span style="color: #5b8583;">'</span><span style="color: #83cc83cc83cc;">interactive</span><span style="color: #8686ae;">)</span>
             <span style="color: #8686ae;">(</span><span style="color: #86aed5;">progn</span>
               <span style="color: #858253;">(</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">message</span> <span style="color: #fdfdd5;">it</span><span style="color: #858253;">)</span>
               <span style="color: #858253;">(</span><span style="color: #78cc78cc78cc; text-decoration: underline;">kill</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">new</span> <span style="color: #fdfdd5;">it</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span>
           <span style="color: #fdfdd5;">it</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span>

<span style="color: #9aaccb;">(</span><span style="color: #86aed5;">defun</span> <span style="color: #fdfdd5;">unpackaged/caps-to-code</span> <span style="color: #5b8583;">(</span><span style="color: #a36673883b99;">beg</span> <span style="color: #909990999099;">end</span><span style="color: #5b8583;">)</span>
  <span style="color: #52534d; font-weight: bold; font-style: italic;">"Convert all-caps words in region to Org code emphasis."</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">interactive</span> <span style="color: #858253;">"r"</span><span style="color: #5b8583;">)</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">let</span> <span style="color: #6688aa;">(</span><span style="color: #858253;">(</span><span style="color: #6c006c006c00;">case</span>-<span style="color: #afaa9b418aed;">fold</span>-<span style="color: #b0668cf47099;">search</span> <span style="color: #a6cca6cca6cc;">nil</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #86aed5;">save-excursion</span>
      <span style="color: #858253;">(</span><span style="color: #86aed5;">save-restriction</span>
        <span style="color: #8686ae;">(</span><span style="color: #a36673883b99; text-decoration: underline;">narrow</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">to</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">region</span> <span style="color: #a36673883b99;">beg</span> <span style="color: #909990999099;">end</span><span style="color: #8686ae;">)</span>
        <span style="color: #8686ae;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">char</span> <span style="color: #858253;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">min</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span>
        <span style="color: #8686ae;">(</span><span style="color: #86aed5;">while</span> <span style="color: #858253;">(</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">re</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">search</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">forward</span> <span style="color: #dd8844;">(</span><span style="color: #86aed5;">rx</span> <span style="color: #a2b6da;">(</span><span style="color: #86aed5;">or</span> <span style="color: #6c006c006c00;">space</span> <span style="color: #ba4cba4cba4c;">bol</span><span style="color: #a2b6da;">)</span>
                                      <span style="color: #a2b6da;">(</span><span style="color: #a6cca6cca6cc;">group</span> <span style="color: #9cb6ad;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">1</span><span style="text-decoration: underline;">+</span> <span style="color: #83cc83cc83cc;">upper</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span>
                                      <span style="color: #a2b6da;">(</span><span style="color: #86aed5;">or</span> <span style="color: #6c006c006c00;">space</span> <span style="color: #78cc78cc78cc;">eol</span> <span style="color: #9cb6ad;">(</span><span style="color: #6c006c006c00;">char</span> <span style="color: #b0668cf47099;">punct</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span>
                                  <span style="color: #a6cca6cca6cc;">nil</span> <span style="color: #9a009a009a00;">t</span><span style="color: #858253;">)</span>
          <span style="color: #858253;">(</span><span style="color: #86aed5;">setf</span> <span style="color: #dd8844;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">buffer</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">substring</span> <span style="color: #a2b6da;">(</span><span style="color: #78cc78cc78cc; text-decoration: underline;">match</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">beginning</span> <span style="color: #ba4cba4cba4c;">1</span><span style="color: #a2b6da;">)</span> <span style="color: #a2b6da;">(</span><span style="color: #78cc78cc78cc; text-decoration: underline;">match</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">end</span> <span style="color: #ba4cba4cba4c;">1</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span>
                <span style="color: #dd8844;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">concat</span> <span style="color: #858253;">"~"</span> <span style="color: #a2b6da;">(</span><span style="color: #78cc78cc78cc; text-decoration: underline;">match</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">string</span> <span style="color: #ba4cba4cba4c;">1</span><span style="color: #a2b6da;">)</span> <span style="color: #858253;">"~"</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span>
          <span style="color: #858253;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">char</span> <span style="color: #dd8844;">(</span><span style="color: #78cc78cc78cc; text-decoration: underline;">match</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">end</span> <span style="color: #7ccc7ccc7ccc;">0</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span>

<span style="color: #9aaccb;">(</span><span style="color: #86aed5;">defun</span> <span style="color: #fdfdd5;">unpackaged/symbol-quotes-to-org-code</span> <span style="color: #5b8583;">(</span><span style="color: #a36673883b99;">beg</span> <span style="color: #909990999099;">end</span><span style="color: #5b8583;">)</span>
  <span style="color: #52534d; font-weight: bold; font-style: italic;">"Change Emacs `</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">symbol</span><span style="color: #52534d; font-weight: bold; font-style: italic;">' quotes to Org =symbol= quotes in region."</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">interactive</span> <span style="color: #858253;">"r"</span><span style="color: #5b8583;">)</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">save-excursion</span>
    <span style="color: #6688aa;">(</span><span style="color: #86aed5;">save-restriction</span>
      <span style="color: #858253;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">char</span> <span style="color: #a36673883b99;">beg</span><span style="color: #858253;">)</span>
      <span style="color: #858253;">(</span><span style="color: #a36673883b99; text-decoration: underline;">narrow</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">to</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">region</span> <span style="color: #a36673883b99;">beg</span> <span style="color: #909990999099;">end</span><span style="color: #858253;">)</span>
      <span style="color: #858253;">(</span><span style="color: #86aed5;">while</span> <span style="color: #8686ae;">(</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">re</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">search</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">forward</span> <span style="color: #858253;">(</span><span style="color: #86aed5;">rx</span> <span style="color: #dd8844;">(</span><span style="color: #86aed5;">or</span> <span style="color: #858253;">"`"</span> <span style="color: #858253;">"&#8216;"</span><span style="color: #dd8844;">)</span> <span style="color: #dd8844;">(</span><span style="color: #a6cca6cca6cc;">group</span> <span style="color: #a2b6da;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">1</span><span style="text-decoration: underline;">+</span> <span style="color: #9cb6ad;">(</span><span style="color: #86aed5;">or</span> <span style="color: #858253;">"-"</span> <span style="color: #a6ffad95b400;">word</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span> <span style="color: #858253;">"'"</span><span style="color: #858253;">)</span> <span style="color: #a6cca6cca6cc;">nil</span> <span style="color: #9a009a009a00;">t</span><span style="color: #8686ae;">)</span>
        <span style="color: #8686ae;">(</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">replace</span><span style="text-decoration: underline;">-</span><span style="color: #78cc78cc78cc; text-decoration: underline;">match</span> <span style="color: #858253;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">concat</span> <span style="color: #858253;">"~"</span> <span style="color: #dd8844;">(</span><span style="color: #78cc78cc78cc; text-decoration: underline;">match</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">string</span> <span style="color: #ba4cba4cba4c;">1</span><span style="color: #dd8844;">)</span> <span style="color: #858253;">"~"</span><span style="color: #858253;">)</span> <span style="color: #9a009a009a00;">t</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2cc7e24" class="outline-3">
<h3 id="org2cc7e24">Download and attach remote files</h3>
<div class="outline-text-3" id="text-org2cc7e24">
<p>
Download file at <code>URL</code> and attach with <code>org-attach</code>.  Interactively, look for <code>URL</code> at point, in X clipboard, and in kill-ring, prompting if not found.  With prefix, prompt for <code>URL</code>.
</p>

<p>
<b>Requires:</b>
</p>
<ul class="org-ul">
<li><a href="https://github.com/alphapapa/org-web-tools">org-web-tools</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #9aaccb;">(</span><span style="color: #86aed5;">defun</span> <span style="color: #fdfdd5;">unpackaged/org-attach-download</span> <span style="color: #5b8583;">(</span><span style="color: #7ccc7ccc7ccc;">url</span><span style="color: #5b8583;">)</span>
  <span style="color: #52534d; font-weight: bold; font-style: italic;">"Download file at URL and attach with `</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">org-attach</span><span style="color: #52534d; font-weight: bold; font-style: italic;">'.</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">Interactively, look for URL at point, in X clipboard, and in</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">kill-ring, prompting if not found.  With prefix, prompt for URL."</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">interactive</span> <span style="color: #6688aa;">(</span><span style="color: #83cc83cc83cc; text-decoration: underline;">list</span> <span style="color: #858253;">(</span><span style="color: #86aed5;">if</span> <span style="color: #909990999099;">current</span>-<span style="color: #a6cca6cca6cc;">prefix</span>-<span style="color: #7ccc7ccc7ccc;">arg</span>
                         <span style="color: #8686ae;">(</span><span style="color: #909990999099; text-decoration: underline;">read</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">string</span> <span style="color: #858253;">"URL: "</span><span style="color: #8686ae;">)</span>
                       <span style="color: #8686ae;">(</span><span style="color: #86aed5;">or</span> <span style="color: #858253;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">element</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">property</span> <span style="color: #86aed5;">:raw-link</span> <span style="color: #dd8844;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">element</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">context</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span>
                           <span style="color: #858253;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #afaa9b418aed; text-decoration: underline;">web</span><span style="text-decoration: underline;">-</span><span style="color: #a36673883b99; text-decoration: underline;">tools</span><span style="text-decoration: underline;">--</span><span style="color: #9a009a009a00; text-decoration: underline;">get</span><span style="text-decoration: underline;">-</span><span style="color: #a36673883b99; text-decoration: underline;">first</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">url</span><span style="color: #858253;">)</span>
                           <span style="color: #858253;">(</span><span style="color: #909990999099; text-decoration: underline;">read</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">string</span> <span style="color: #858253;">"URL: "</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">when</span> <span style="color: #6688aa;">(</span><span style="color: #b0668cf47099; text-decoration: underline;">yes</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">or</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">no</span><span style="text-decoration: underline;">-</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">p</span> <span style="color: #858253;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">concat</span> <span style="color: #858253;">"Attach file at URL: "</span> <span style="color: #7ccc7ccc7ccc;">url</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #86aed5;">let*</span> <span style="color: #858253;">(</span><span style="color: #8686ae;">(</span><span style="color: #700070007000;">temp</span>-<span style="color: #afaa9b418aed;">dir</span> <span style="color: #858253;">(</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">make</span><span style="text-decoration: underline;">-</span><span style="color: #700070007000; text-decoration: underline;">temp</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">file</span> <span style="color: #858253;">"org-attach-download-"</span> <span style="color: #5b8583;">'</span><span style="color: #afaa9b418aed;">dir</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span>
           <span style="color: #8686ae;">(</span><span style="color: #9a009a009a00;">basename</span> <span style="color: #858253;">(</span><span style="color: #6c006c006c00; text-decoration: underline;">file</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">name</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">nondirectory</span> <span style="color: #dd8844;">(</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">directory</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">file</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">name</span> <span style="color: #7ccc7ccc7ccc;">url</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span>
           <span style="color: #8686ae;">(</span><span style="color: #b0668cf47099;">local</span>-<span style="color: #700070007000;">path</span> <span style="color: #858253;">(</span><span style="color: #78cc78cc78cc; text-decoration: underline;">expand</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">file</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">name</span> <span style="color: #9a009a009a00;">basename</span> <span style="color: #700070007000;">temp</span>-<span style="color: #afaa9b418aed;">dir</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span>
           <span style="color: #a6ffad95b400;">size</span><span style="color: #858253;">)</span>
      <span style="color: #858253;">(</span><span style="color: #86aed5;">unwind-protect</span>
          <span style="color: #8686ae;">(</span><span style="color: #86aed5;">progn</span>
            <span style="color: #858253;">(</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">url</span><span style="text-decoration: underline;">-</span><span style="color: #a36673883b99; text-decoration: underline;">copy</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">file</span> <span style="color: #7ccc7ccc7ccc;">url</span> <span style="color: #b0668cf47099;">local</span>-<span style="color: #700070007000;">path</span> <span style="color: #5b8583;">'</span><span style="color: #ba4cba4cba4c;">ok</span>-<span style="color: #a6cca6cca6cc;">if</span>-<span style="color: #a6ffad95b400;">exists</span> <span style="color: #5b8583;">'</span><span style="color: #7ccc7ccc7ccc;">keep</span>-<span style="color: #78cc78cc78cc;">time</span><span style="color: #858253;">)</span>
            <span style="color: #858253;">(</span><span style="color: #86aed5;">setq</span> <span style="color: #a6ffad95b400;">size</span> <span style="color: #dd8844;">(</span><span style="color: #6c006c006c00; text-decoration: underline;">file</span><span style="text-decoration: underline;">-</span><span style="color: #a6ffad95b400; text-decoration: underline;">size</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">human</span><span style="text-decoration: underline;">-</span><span style="color: #a6ffad95b400; text-decoration: underline;">readable</span>
                        <span style="color: #a2b6da;">(</span><span style="color: #6c006c006c00; text-decoration: underline;">file</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">attribute</span><span style="text-decoration: underline;">-</span><span style="color: #a6ffad95b400; text-decoration: underline;">size</span>
                         <span style="color: #9cb6ad;">(</span><span style="color: #6c006c006c00; text-decoration: underline;">file</span><span style="text-decoration: underline;">-</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">attributes</span> <span style="color: #b0668cf47099;">local</span>-<span style="color: #700070007000;">path</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span>
            <span style="color: #858253;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">attach</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">attach</span> <span style="color: #b0668cf47099;">local</span>-<span style="color: #700070007000;">path</span> <span style="color: #a6cca6cca6cc;">nil</span> <span style="color: #5b8583;">'</span><span style="color: #83cc83cc83cc;">mv</span><span style="color: #858253;">)</span>
            <span style="color: #858253;">(</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">message</span> <span style="color: #858253;">"Attached %s (%s)"</span> <span style="color: #7ccc7ccc7ccc;">url</span> <span style="color: #a6ffad95b400;">size</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span>
        <span style="color: #8686ae;">(</span><span style="color: #83cc83cc83cc; text-decoration: underline;">delete</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">directory</span> <span style="color: #700070007000;">temp</span>-<span style="color: #afaa9b418aed;">dir</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org0384ca8" class="outline-3">
<h3 id="org0384ca8">Ensure blank lines between headings and before contents</h3>
<div class="outline-text-3" id="text-org0384ca8">
<p>
Ensure that blank lines exist between headings and between headings and their contents.  With prefix, operate on whole buffer.  Ensures that blank lines exist after each headings's drawers.
</p>

<p>
For those who prefer to maintain blank lines between headings, this makes it easy to automatically add them where necessary, to a subtree or the whole buffer.  It also adds blank lines after drawers.  Works well with <a href="#org0033a67"><code>org-return-dwim</code></a>.
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #9aaccb;">(</span><span style="color: #86aed5;">defun</span> <span style="color: #fdfdd5;">unpackaged/org-fix-blank-lines</span> <span style="color: #5b8583;">(</span><span style="color: #a6cca6cca6cc;">prefix</span><span style="color: #5b8583;">)</span>
    <span style="color: #52534d; font-weight: bold; font-style: italic;">"Ensure that blank lines exist between headings and between headings and their contents.</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">With prefix, operate on whole buffer.  Ensures that blank lines</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">exist after each headings's drawers."</span>
    <span style="color: #5b8583;">(</span><span style="color: #86aed5;">interactive</span> <span style="color: #858253;">"P"</span><span style="color: #5b8583;">)</span>
    <span style="color: #5b8583;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">map</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">entries</span> <span style="color: #6688aa;">(</span><span style="color: #86aed5;">lambda</span> <span style="color: #858253;">()</span>
                       <span style="color: #858253;">(</span><span style="color: #86aed5;">org-with-wide-buffer</span>
                        <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">`</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">org-map-entries</span><span style="color: #586e75; font-weight: bold; font-style: italic;">' narrows the buffer, which prevents us from seeing</span>
                        <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">newlines before the current heading, so we do this part widened.</span>
                        <span style="color: #8686ae;">(</span><span style="color: #86aed5;">while</span> <span style="color: #858253;">(</span><span style="color: #cb4b16; font-weight: bold;">not</span> <span style="color: #dd8844;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">looking</span><span style="text-decoration: underline;">-</span><span style="color: #700070007000; text-decoration: underline;">back</span> <span style="color: #858253;">"\n\n"</span> <span style="color: #a6cca6cca6cc;">nil</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span>
                          <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Insert blank lines before heading.</span>
                          <span style="color: #858253;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">insert</span> <span style="color: #858253;">"\n"</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
                       <span style="color: #858253;">(</span><span style="color: #86aed5;">let</span> <span style="color: #8686ae;">(</span><span style="color: #858253;">(</span><span style="color: #909990999099;">end</span> <span style="color: #dd8844;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">entry</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">end</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">position</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span>
                         <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Insert blank lines before entry content</span>
                         <span style="color: #8686ae;">(</span><span style="color: #b0668cf47099; text-decoration: underline;">forward</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">line</span><span style="color: #8686ae;">)</span>
                         <span style="color: #8686ae;">(</span><span style="color: #86aed5;">while</span> <span style="color: #858253;">(</span><span style="color: #86aed5;">and</span> <span style="color: #dd8844;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">at</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">planning</span><span style="text-decoration: underline;">-</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">p</span><span style="color: #dd8844;">)</span>
                                     <span style="color: #dd8844;">(</span>&lt; <span style="color: #a2b6da;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">point</span><span style="color: #a2b6da;">)</span> <span style="color: #a2b6da;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">max</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span>
                           <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Skip planning lines</span>
                           <span style="color: #858253;">(</span><span style="color: #b0668cf47099; text-decoration: underline;">forward</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">line</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span>
                         <span style="color: #8686ae;">(</span><span style="color: #86aed5;">while</span> <span style="color: #858253;">(</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">re</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">search</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">forward</span> <span style="color: #a6ffad95b400;">org</span>-<span style="color: #afaa9b418aed;">drawer</span>-<span style="color: #700070007000;">regexp</span> <span style="color: #909990999099;">end</span> <span style="color: #9a009a009a00;">t</span><span style="color: #858253;">)</span>
                           <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Skip drawers.  You might think that `</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">org-at-drawer-p</span><span style="color: #586e75; font-weight: bold; font-style: italic;">' would suffice, but</span>
                           <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">for some reason it doesn't work correctly when operating on hidden text.</span>
                           <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">This works, taken from `</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">org-agenda-get-some-entry-text</span><span style="color: #586e75; font-weight: bold; font-style: italic;">'.</span>
                           <span style="color: #858253;">(</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">re</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">search</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">forward</span> <span style="color: #858253;">"^[ \t]*:END:.*\n?"</span> <span style="color: #909990999099;">end</span> <span style="color: #9a009a009a00;">t</span><span style="color: #858253;">)</span>
                           <span style="color: #858253;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">char</span> <span style="color: #dd8844;">(</span><span style="color: #78cc78cc78cc; text-decoration: underline;">match</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">end</span> <span style="color: #7ccc7ccc7ccc;">0</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span>
                         <span style="color: #8686ae;">(</span><span style="color: #86aed5;">unless</span> <span style="color: #858253;">(</span><span style="color: #86aed5;">or</span> <span style="color: #dd8844;">(</span>= <span style="color: #a2b6da;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">point</span><span style="color: #a2b6da;">)</span> <span style="color: #a2b6da;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">max</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span>
                                     <span style="color: #dd8844;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">at</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">heading</span><span style="text-decoration: underline;">-</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">p</span><span style="color: #dd8844;">)</span>
                                     <span style="color: #dd8844;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">looking</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">at</span><span style="text-decoration: underline;">-</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">p</span> <span style="color: #858253;">"\n"</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span>
                           <span style="color: #858253;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">insert</span> <span style="color: #858253;">"\n"</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span>
                     <span style="color: #9a009a009a00;">t</span> <span style="color: #6688aa;">(</span><span style="color: #86aed5;">if</span> <span style="color: #a6cca6cca6cc;">prefix</span>
                           <span style="color: #a6cca6cca6cc;">nil</span>
                         <span style="color: #5b8583;">'</span><span style="color: #a6ffad95b400;">tree</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga4c9ed7" class="outline-3">
<h3 id="orga4c9ed7">Export to HTML with <i>useful</i> anchors</h3>
<div class="outline-text-3" id="text-orga4c9ed7">
<p>
This minor mode causes Org HTML export to use heading titles for HTML IDs and anchors.  For example, instead of:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #fdfdd5;">li</span>&gt;&lt;<span style="color: #fdfdd5;">a</span> <span style="color: #fdfdd5;">href</span>=<span style="color: #858253;">"#org11177f0"</span>&gt;Usage...
&lt;<span style="color: #fdfdd5;">li</span>&gt;&lt;<span style="color: #fdfdd5;">a</span> <span style="color: #fdfdd5;">href</span>=<span style="color: #858253;">"#orge2a172e"</span>&gt;Faces, fonts...
</pre>
</div>

<p>
You get:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #fdfdd5;">li</span>&gt;&lt;<span style="color: #fdfdd5;">a</span> <span style="color: #fdfdd5;">href</span>=<span style="color: #858253;">"#Usage"</span>&gt;Usage...
&lt;<span style="color: #fdfdd5;">li</span>&gt;&lt;<span style="color: #fdfdd5;">a</span> <span style="color: #fdfdd5;">href</span>=<span style="color: #858253;">"#Faces%2C%20fonts"</span>&gt;Faces, fonts...
</pre>
</div>

<p>
So links to sections of the exported HTML will remain useful, rather than being different, random numbers every time the document is exported.
</p>

<p>
Note that this is somewhat of a hack, and it probably breaks some feature deep inside Org Export.  But it seems to work, and it solves the problem!
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #9aaccb;">(</span><span style="color: #86aed5;">define-minor-mode</span> <span style="color: #fdfdd5;">unpackaged/org-export-html-with-useful-ids-mode</span>
  <span style="color: #52534d; font-weight: bold; font-style: italic;">"Attempt to export Org as HTML with useful link IDs.</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">Instead of random IDs like \"#orga1b2c3\", use heading titles,</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">made unique when necessary."</span>
  <span style="color: #86aed5;">:global</span> <span style="color: #9a009a009a00;">t</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">if</span> <span style="color: #909990999099;">unpackaged</span>/<span style="color: #a6ffad95b400;">org</span>-<span style="color: #83cc83cc83cc;">export</span>-<span style="color: #909990999099;">html</span>-<span style="color: #a6cca6cca6cc;">with</span>-<span style="color: #78cc78cc78cc;">useful</span>-<span style="color: #afaa9b418aed;">ids</span>-<span style="color: #7ccc7ccc7ccc;">mode</span>
      <span style="color: #6688aa;">(</span><span style="color: #86aed5;">progn</span>
        <span style="color: #858253;">(</span><span style="color: #6c006c006c00; text-decoration: underline;">advice</span><span style="text-decoration: underline;">-</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">add</span> <span style="color: #5b8583;">#'</span><span style="color: #a6ffad95b400;">org</span>-<span style="color: #83cc83cc83cc;">export</span>-<span style="color: #7ccc7ccc7ccc;">new</span>-<span style="color: #afaa9b418aed;">title</span>-<span style="color: #ba4cba4cba4c;">reference</span> <span style="color: #86aed5;">:override</span> <span style="color: #5b8583;">#'</span><span style="color: #909990999099;">unpackaged</span>/<span style="color: #a6ffad95b400;">org</span>-<span style="color: #83cc83cc83cc;">export</span>-<span style="color: #7ccc7ccc7ccc;">new</span>-<span style="color: #afaa9b418aed;">title</span>-<span style="color: #ba4cba4cba4c;">reference</span><span style="color: #858253;">)</span>
        <span style="color: #858253;">(</span><span style="color: #6c006c006c00; text-decoration: underline;">advice</span><span style="text-decoration: underline;">-</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">add</span> <span style="color: #5b8583;">#'</span><span style="color: #a6ffad95b400;">org</span>-<span style="color: #83cc83cc83cc;">export</span>-<span style="color: #9a009a009a00;">get</span>-<span style="color: #ba4cba4cba4c;">reference</span> <span style="color: #86aed5;">:override</span> <span style="color: #5b8583;">#'</span><span style="color: #909990999099;">unpackaged</span>/<span style="color: #a6ffad95b400;">org</span>-<span style="color: #83cc83cc83cc;">export</span>-<span style="color: #9a009a009a00;">get</span>-<span style="color: #ba4cba4cba4c;">reference</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #6c006c006c00; text-decoration: underline;">advice</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">remove</span> <span style="color: #5b8583;">#'</span><span style="color: #a6ffad95b400;">org</span>-<span style="color: #83cc83cc83cc;">export</span>-<span style="color: #7ccc7ccc7ccc;">new</span>-<span style="color: #afaa9b418aed;">title</span>-<span style="color: #ba4cba4cba4c;">reference</span> <span style="color: #5b8583;">#'</span><span style="color: #909990999099;">unpackaged</span>/<span style="color: #a6ffad95b400;">org</span>-<span style="color: #83cc83cc83cc;">export</span>-<span style="color: #7ccc7ccc7ccc;">new</span>-<span style="color: #afaa9b418aed;">title</span>-<span style="color: #ba4cba4cba4c;">reference</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #6c006c006c00; text-decoration: underline;">advice</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">remove</span> <span style="color: #5b8583;">#'</span><span style="color: #a6ffad95b400;">org</span>-<span style="color: #83cc83cc83cc;">export</span>-<span style="color: #9a009a009a00;">get</span>-<span style="color: #ba4cba4cba4c;">reference</span> <span style="color: #5b8583;">#'</span><span style="color: #909990999099;">unpackaged</span>/<span style="color: #a6ffad95b400;">org</span>-<span style="color: #83cc83cc83cc;">export</span>-<span style="color: #9a009a009a00;">get</span>-<span style="color: #ba4cba4cba4c;">reference</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span>

<span style="color: #9aaccb;">(</span><span style="color: #86aed5;">defun</span> <span style="color: #fdfdd5;">unpackaged/org-export-get-reference</span> <span style="color: #5b8583;">(</span><span style="color: #9a009a009a00;">datum</span> <span style="color: #a9ba7fd34edf;">info</span><span style="color: #5b8583;">)</span>
  <span style="color: #52534d; font-weight: bold; font-style: italic;">"Like `</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">org-export-get-reference</span><span style="color: #52534d; font-weight: bold; font-style: italic;">', except uses heading titles instead of random numbers."</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">let</span> <span style="color: #6688aa;">(</span><span style="color: #858253;">(</span><span style="color: #afaa9b418aed;">cache</span> <span style="color: #8686ae;">(</span><span style="color: #909990999099; text-decoration: underline;">plist</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">get</span> <span style="color: #a9ba7fd34edf;">info</span> <span style="color: #86aed5;">:internal-references</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #86aed5;">or</span> <span style="color: #858253;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">car</span> <span style="color: #8686ae;">(</span><span style="color: #6c006c006c00; text-decoration: underline;">rassq</span> <span style="color: #9a009a009a00;">datum</span> <span style="color: #afaa9b418aed;">cache</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
        <span style="color: #858253;">(</span><span style="color: #86aed5;">let*</span> <span style="color: #8686ae;">(</span><span style="color: #858253;">(</span><span style="color: #a6cca6cca6cc;">crossrefs</span> <span style="color: #dd8844;">(</span><span style="color: #909990999099; text-decoration: underline;">plist</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">get</span> <span style="color: #a9ba7fd34edf;">info</span> <span style="color: #86aed5;">:crossrefs</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span>
               <span style="color: #858253;">(</span><span style="color: #78cc78cc78cc;">cells</span> <span style="color: #dd8844;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">export</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">search</span><span style="text-decoration: underline;">-</span><span style="color: #78cc78cc78cc; text-decoration: underline;">cells</span> <span style="color: #9a009a009a00;">datum</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span>
               <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Preserve any pre-existing association between</span>
               <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">a search cell and a reference, i.e., when some</span>
               <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">previously published document referenced a location</span>
               <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">within current file (see</span>
               <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">`</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">org-publish-resolve-external-link</span><span style="color: #586e75; font-weight: bold; font-style: italic;">').</span>
               <span style="color: #586e75; font-weight: bold; font-style: italic;">;;</span>
               <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">However, there is no guarantee that search cells are</span>
               <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">unique, e.g., there might be duplicate custom ID or</span>
               <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">two headings with the same title in the file.</span>
               <span style="color: #586e75; font-weight: bold; font-style: italic;">;;</span>
               <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">As a consequence, before re-using any reference to</span>
               <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">an element or object, we check that it doesn't refer</span>
               <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">to a previous element or object.</span>
               <span style="color: #858253;">(</span><span style="color: #7ccc7ccc7ccc;">new</span> <span style="color: #dd8844;">(</span><span style="color: #86aed5;">or</span> <span style="color: #a2b6da;">(</span><span style="color: #83cc83cc83cc; text-decoration: underline;">cl</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">some</span>
                         <span style="color: #9cb6ad;">(</span><span style="color: #86aed5;">lambda</span> <span style="color: #9aaccb;">(</span><span style="color: #7ccc7ccc7ccc;">cell</span><span style="color: #9aaccb;">)</span>
                           <span style="color: #9aaccb;">(</span><span style="color: #86aed5;">let</span> <span style="color: #5b8583;">(</span><span style="color: #6688aa;">(</span><span style="color: #a6cca6cca6cc;">stored</span> <span style="color: #858253;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">cdr</span> <span style="color: #8686ae;">(</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">assoc</span> <span style="color: #7ccc7ccc7ccc;">cell</span> <span style="color: #a6cca6cca6cc;">crossrefs</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span>
                             <span style="color: #5b8583;">(</span><span style="color: #86aed5;">when</span> <span style="color: #a6cca6cca6cc;">stored</span>
                               <span style="color: #6688aa;">(</span><span style="color: #86aed5;">let</span> <span style="color: #858253;">(</span><span style="color: #8686ae;">(</span><span style="color: #909990999099;">old</span> <span style="color: #858253;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">export</span><span style="text-decoration: underline;">-</span><span style="color: #a6ffad95b400; text-decoration: underline;">format</span><span style="text-decoration: underline;">-</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">reference</span> <span style="color: #a6cca6cca6cc;">stored</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
                                 <span style="color: #858253;">(</span><span style="color: #86aed5;">and</span> <span style="color: #8686ae;">(</span><span style="color: #cb4b16; font-weight: bold;">not</span> <span style="color: #858253;">(</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">assoc</span> <span style="color: #909990999099;">old</span> <span style="color: #afaa9b418aed;">cache</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span> <span style="color: #a6cca6cca6cc;">stored</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span><span style="color: #9cb6ad;">)</span>
                         <span style="color: #78cc78cc78cc;">cells</span><span style="color: #a2b6da;">)</span>
                        <span style="color: #a2b6da;">(</span><span style="color: #86aed5;">when</span> <span style="color: #9cb6ad;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">element</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">property</span> <span style="color: #86aed5;">:raw-value</span> <span style="color: #9a009a009a00;">datum</span><span style="color: #9cb6ad;">)</span>
                          <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Heading with a title</span>
                          <span style="color: #9cb6ad;">(</span><span style="color: #909990999099; text-decoration: underline;">unpackaged</span><span style="text-decoration: underline;">/</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">export</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">new</span><span style="text-decoration: underline;">-</span><span style="color: #afaa9b418aed; text-decoration: underline;">title</span><span style="text-decoration: underline;">-</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">reference</span>
                           <span style="color: #9aaccb;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">substring</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">no</span><span style="text-decoration: underline;">-</span><span style="color: #78cc78cc78cc; text-decoration: underline;">properties</span> <span style="color: #5b8583;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">element</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">property</span> <span style="color: #86aed5;">:raw-value</span> <span style="color: #9a009a009a00;">datum</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span>
                           <span style="color: #afaa9b418aed;">cache</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span>
                        <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #2aa198;">NOTE</span><span style="color: #586e75; font-weight: bold; font-style: italic;">: This probably breaks some Org Export</span>
                        <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">feature, but if it does what I need, fine.</span>
                        <span style="color: #a2b6da;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">export</span><span style="text-decoration: underline;">-</span><span style="color: #a6ffad95b400; text-decoration: underline;">format</span><span style="text-decoration: underline;">-</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">reference</span>
                         <span style="color: #9cb6ad;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">export</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">new</span><span style="text-decoration: underline;">-</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">reference</span> <span style="color: #afaa9b418aed;">cache</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span>
               <span style="color: #858253;">(</span><span style="color: #ba4cba4cba4c;">reference</span>-<span style="color: #a6cca6cca6cc;">string</span> <span style="color: #7ccc7ccc7ccc;">new</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span>
          <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Cache contains both data already associated to</span>
          <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">a reference and in-use internal references, so as to make</span>
          <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">unique references.</span>
          <span style="color: #8686ae;">(</span><span style="color: #86aed5;">dolist</span> <span style="color: #858253;">(</span><span style="color: #7ccc7ccc7ccc;">cell</span> <span style="color: #78cc78cc78cc;">cells</span><span style="color: #858253;">)</span> <span style="color: #858253;">(</span><span style="color: #86aed5;">push</span> <span style="color: #dd8844;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">cons</span> <span style="color: #7ccc7ccc7ccc;">cell</span> <span style="color: #7ccc7ccc7ccc;">new</span><span style="color: #dd8844;">)</span> <span style="color: #afaa9b418aed;">cache</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span>
          <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Retain a direct association between reference string and</span>
          <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">DATUM since (1) not every object or element can be given</span>
          <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">a search cell (2) it permits quick lookup.</span>
          <span style="color: #8686ae;">(</span><span style="color: #86aed5;">push</span> <span style="color: #858253;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">cons</span> <span style="color: #ba4cba4cba4c;">reference</span>-<span style="color: #a6cca6cca6cc;">string</span> <span style="color: #9a009a009a00;">datum</span><span style="color: #858253;">)</span> <span style="color: #afaa9b418aed;">cache</span><span style="color: #8686ae;">)</span>
          <span style="color: #8686ae;">(</span><span style="color: #909990999099; text-decoration: underline;">plist</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">put</span> <span style="color: #a9ba7fd34edf;">info</span> <span style="color: #86aed5;">:internal-references</span> <span style="color: #afaa9b418aed;">cache</span><span style="color: #8686ae;">)</span>
          <span style="color: #ba4cba4cba4c;">reference</span>-<span style="color: #a6cca6cca6cc;">string</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span>

<span style="color: #9aaccb;">(</span><span style="color: #86aed5;">defun</span> <span style="color: #fdfdd5;">unpackaged/org-export-new-title-reference</span> <span style="color: #5b8583;">(</span><span style="color: #afaa9b418aed;">title</span> <span style="color: #afaa9b418aed;">cache</span><span style="color: #5b8583;">)</span>
  <span style="color: #52534d; font-weight: bold; font-style: italic;">"Return new reference for title that is unique in CACHE."</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">cl-macrolet</span> <span style="color: #6688aa;">(</span><span style="color: #858253;">(</span><span style="color: #ba4cba4cba4c;">inc</span>-<span style="color: #a6cca6cca6cc;">suffixf</span> <span style="color: #8686ae;">(</span><span style="color: #83cc83cc83cc;">place</span><span style="color: #8686ae;">)</span>
                             <span style="color: #5b8583;">`</span><span style="color: #8686ae;">(</span><span style="color: #86aed5;">progn</span>
                                <span style="color: #858253;">(</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">string</span><span style="text-decoration: underline;">-</span><span style="color: #78cc78cc78cc; text-decoration: underline;">match</span> <span style="color: #dd8844;">(</span><span style="color: #86aed5;">rx</span> <span style="color: #6c006c006c00;">bos</span>
                                                  <span style="color: #a2b6da;">(</span><span style="color: #78cc78cc78cc;">minimal</span>-<span style="color: #78cc78cc78cc;">match</span> <span style="color: #9cb6ad;">(</span><span style="color: #a6cca6cca6cc;">group</span> <span style="color: #9aaccb;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">1</span><span style="text-decoration: underline;">+</span> <span style="color: #78cc78cc78cc;">anything</span><span style="color: #9aaccb;">)</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span>
                                                  <span style="color: #a2b6da;">(</span><span style="color: #a36673883b99;">optional</span> <span style="color: #858253;">"--"</span> <span style="color: #9cb6ad;">(</span><span style="color: #a6cca6cca6cc;">group</span> <span style="color: #9aaccb;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">1</span><span style="text-decoration: underline;">+</span> <span style="color: #78cc78cc78cc;">digit</span><span style="color: #9aaccb;">)</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span>
                                                  <span style="color: #afaa9b418aed;">eos</span><span style="color: #dd8844;">)</span>
                                              ,<span style="color: #83cc83cc83cc;">place</span><span style="color: #858253;">)</span>
                                <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #990A1B;">HACK</span><span style="color: #586e75; font-weight: bold; font-style: italic;">: `</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">s1</span><span style="color: #586e75; font-weight: bold; font-style: italic;">' instead of a gensym.</span>
                                <span style="color: #858253;">(</span><span style="color: #86aed5;">-let*</span> <span style="color: #dd8844;">(</span><span style="color: #a2b6da;">(</span><span style="color: #9cb6ad;">(</span><span style="color: #ba4cba4cba4c;">s1</span> <span style="color: #b0668cf47099;">suffix</span><span style="color: #9cb6ad;">)</span> <span style="color: #9cb6ad;">(</span><span style="color: #83cc83cc83cc; text-decoration: underline;">list</span> <span style="color: #9aaccb;">(</span><span style="color: #78cc78cc78cc; text-decoration: underline;">match</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">string</span> <span style="color: #ba4cba4cba4c;">1</span> ,<span style="color: #83cc83cc83cc;">place</span><span style="color: #9aaccb;">)</span>
                                                           <span style="color: #9aaccb;">(</span><span style="color: #78cc78cc78cc; text-decoration: underline;">match</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">string</span> <span style="color: #b0668cf47099;">2</span> ,<span style="color: #83cc83cc83cc;">place</span><span style="color: #9aaccb;">)</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span>
                                        <span style="color: #a2b6da;">(</span><span style="color: #b0668cf47099;">suffix</span> <span style="color: #9cb6ad;">(</span><span style="color: #86aed5;">if</span> <span style="color: #b0668cf47099;">suffix</span>
                                                    <span style="color: #9aaccb;">(</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">string</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">to</span><span style="text-decoration: underline;">-</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">number</span> <span style="color: #b0668cf47099;">suffix</span><span style="color: #9aaccb;">)</span>
                                                  <span style="color: #7ccc7ccc7ccc;">0</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span>
                                  <span style="color: #dd8844;">(</span><span style="color: #86aed5;">setf</span> ,<span style="color: #83cc83cc83cc;">place</span> <span style="color: #a2b6da;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">format</span> <span style="color: #858253;">"%s--%s"</span> <span style="color: #ba4cba4cba4c;">s1</span> <span style="color: #9cb6ad;">(</span><span style="color: #86aed5;">cl-incf</span> <span style="color: #b0668cf47099;">suffix</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #86aed5;">let*</span> <span style="color: #858253;">(</span><span style="color: #8686ae;">(</span><span style="color: #700070007000;">ref</span> <span style="color: #858253;">(</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">url</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">hexify</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">string</span> <span style="color: #afaa9b418aed;">title</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
      <span style="color: #858253;">(</span><span style="color: #86aed5;">while</span> <span style="color: #8686ae;">(</span><span style="color: #86aed5;">--any</span> <span style="color: #858253;">(</span><span style="color: #b0668cf47099; text-decoration: underline;">equal</span> <span style="color: #700070007000;">ref</span> <span style="color: #dd8844;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">car</span> <span style="color: #fdfdd5;">it</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span>
                    <span style="color: #afaa9b418aed;">cache</span><span style="color: #8686ae;">)</span>
        <span style="color: #8686ae;">(</span><span style="color: #ba4cba4cba4c;">inc</span>-<span style="color: #a6cca6cca6cc;">suffixf</span> <span style="color: #700070007000;">ref</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
      <span style="color: #700070007000;">ref</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgce0779e" class="outline-3">
<h3 id="orgce0779e">Surround region with emphasis or syntax characters</h3>
<div class="outline-text-3" id="text-orgce0779e">
<p>
Define and bind interactive commands for each of <code>KEYS</code> that surround the region or insert text.  Commands are bound in <code>org-mode-map</code> to each of <code>KEYS</code>.  If the region is active, commands surround it with the key character, otherwise call <code>org-self-insert-command</code>.
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #9aaccb;">(</span><span style="color: #86aed5;">defmacro</span> <span style="color: #fdfdd5;">unpackaged/def-org-maybe-surround</span> <span style="color: #5b8583;">(</span><span style="color: #8686ae;">&amp;rest</span> <span style="color: #ba4cba4cba4c;">keys</span><span style="color: #5b8583;">)</span>
  <span style="color: #52534d; font-weight: bold; font-style: italic;">"Define and bind interactive commands for each of KEYS that surround the region or insert text.</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">Commands are bound in `</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">org-mode-map</span><span style="color: #52534d; font-weight: bold; font-style: italic;">' to each of KEYS.  If the</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">region is active, commands surround it with the key character,</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">otherwise call `</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">org-self-insert-command</span><span style="color: #52534d; font-weight: bold; font-style: italic;">'."</span>
  <span style="color: #5b8583;">`</span><span style="color: #5b8583;">(</span><span style="color: #86aed5;">progn</span>
     ,@<span style="color: #6688aa;">(</span><span style="color: #86aed5;">cl-loop</span> <span style="color: #ba4cba4cba4c;">for</span> <span style="color: #a6cca6cca6cc;">key</span> <span style="color: #909990999099;">in</span> <span style="color: #ba4cba4cba4c;">keys</span>
                <span style="color: #ba4cba4cba4c;">for</span> <span style="color: #7ccc7ccc7ccc;">name</span> = <span style="color: #858253;">(</span><span style="color: #6c006c006c00; text-decoration: underline;">intern</span> <span style="color: #8686ae;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">concat</span> <span style="color: #858253;">"unpackaged/org-maybe-surround-"</span> <span style="color: #a6cca6cca6cc;">key</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
                <span style="color: #ba4cba4cba4c;">for</span> <span style="color: #83cc83cc83cc;">docstring</span> = <span style="color: #858253;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">format</span> <span style="color: #858253;">"If region is active, surround it with \"%s\", otherwise call `</span><span style="color: #5b8583;">org-self-insert-command</span><span style="color: #858253;">'."</span> <span style="color: #a6cca6cca6cc;">key</span><span style="color: #858253;">)</span>
                <span style="color: #a6cca6cca6cc;">collect</span> <span style="color: #5b8583;">`</span><span style="color: #858253;">(</span><span style="color: #86aed5;">defun</span> ,<span style="color: #7ccc7ccc7ccc;">name</span> <span style="color: #8686ae;">()</span>
                           ,<span style="color: #83cc83cc83cc;">docstring</span>
                           <span style="color: #8686ae;">(</span><span style="color: #86aed5;">interactive</span><span style="color: #8686ae;">)</span>
                           <span style="color: #8686ae;">(</span><span style="color: #86aed5;">if</span> <span style="color: #858253;">(</span><span style="color: #6c006c006c00; text-decoration: underline;">region</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">active</span><span style="text-decoration: underline;">-</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">p</span><span style="color: #858253;">)</span>
                               <span style="color: #858253;">(</span><span style="color: #86aed5;">let</span> <span style="color: #dd8844;">(</span><span style="color: #a2b6da;">(</span><span style="color: #a36673883b99;">beg</span> <span style="color: #9cb6ad;">(</span><span style="color: #6c006c006c00; text-decoration: underline;">region</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">beginning</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span>
                                     <span style="color: #a2b6da;">(</span><span style="color: #909990999099;">end</span> <span style="color: #9cb6ad;">(</span><span style="color: #6c006c006c00; text-decoration: underline;">region</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">end</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span>
                                 <span style="color: #dd8844;">(</span><span style="color: #86aed5;">save-excursion</span>
                                   <span style="color: #a2b6da;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">char</span> <span style="color: #909990999099;">end</span><span style="color: #a2b6da;">)</span>
                                   <span style="color: #a2b6da;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">insert</span> ,<span style="color: #a6cca6cca6cc;">key</span><span style="color: #a2b6da;">)</span>
                                   <span style="color: #a2b6da;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">char</span> <span style="color: #a36673883b99;">beg</span><span style="color: #a2b6da;">)</span>
                                   <span style="color: #a2b6da;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">insert</span> ,<span style="color: #a6cca6cca6cc;">key</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span>
                             <span style="color: #858253;">(</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">call</span><span style="text-decoration: underline;">-</span><span style="color: #afaa9b418aed; text-decoration: underline;">interactively</span> <span style="color: #5b8583;">#'</span><span style="color: #a6ffad95b400;">org</span>-<span style="color: #fdfdd5;">self</span>-<span style="color: #ba4cba4cba4c;">insert</span>-<span style="color: #a6cca6cca6cc;">command</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
                <span style="color: #a6cca6cca6cc;">collect</span> <span style="color: #5b8583;">`</span><span style="color: #858253;">(</span><span style="color: #6c006c006c00;">define</span>-<span style="color: #a6cca6cca6cc;">key</span> <span style="color: #a6ffad95b400;">org</span>-<span style="color: #7ccc7ccc7ccc;">mode</span>-<span style="color: #a9ba7fd34edf;">map</span> <span style="color: #8686ae;">(</span><span style="color: #b0668cf47099; text-decoration: underline;">kbd</span> ,<span style="color: #a6cca6cca6cc;">key</span><span style="color: #8686ae;">)</span> <span style="color: #5b8583;">#'</span>,<span style="color: #7ccc7ccc7ccc;">name</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span>
</pre>
</div>

<p>
Used like:
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #9aaccb;">(</span><span style="color: #86aed5;">unpackaged/def-org-maybe-surround</span> <span style="color: #858253;">"~"</span> <span style="color: #858253;">"="</span> <span style="color: #858253;">"*"</span> <span style="color: #858253;">"/"</span> <span style="color: #858253;">"+"</span><span style="color: #9aaccb;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd039929" class="outline-3">
<h3 id="orgd039929">Refile to datetree file using earliest/latest timestamp in entry</h3>
<div class="outline-text-3" id="text-orgd039929">
<p>
Refile current entry to datetree using timestamp found in entry.  <code>WHICH</code> should be <code>earliest</code> or <code>latest</code>. If <code>SUBTREE</code>-P is non-nil, search whole subtree.
</p>

<p>
This is sort of like archiving to a datetree, but it uses either the earliest or latest timestamp found in the entry or subtree rather than the current date.  It's helpful if you have an entry with lots of timestamps or log entries, and you're done with it, and you want to file it in a datetree in a leaf matching either when you started working on the entry or when you finished, using the first or last timestamp found anywhere in the entry.
</p>

<p>
<i>Note:</i> If you can think of a more concise name for this command, please send it in!
</p>

<p>
<b>Requires:</b> <a href="https://github.com/alphapapa/ts.el">ts</a>
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #9aaccb;">(</span><span style="color: #86aed5;">defun</span> <span style="color: #fdfdd5;">unpackaged/org-refile-to-datetree-using-ts-in-entry</span> <span style="color: #5b8583;">(</span><span style="color: #700070007000;">which</span>-<span style="color: #ba4cba4cba4c;">ts</span> <span style="color: #6c006c006c00;">file</span> <span style="color: #8686ae;">&amp;optional</span> <span style="color: #afaa9b418aed;">subtree</span>-<span style="color: #a9ba7fd34edf;">p</span><span style="color: #5b8583;">)</span>
  <span style="color: #52534d; font-weight: bold; font-style: italic;">"Refile current entry to datetree in FILE using timestamp found in entry.</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">WHICH should be `</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">earliest</span><span style="color: #52534d; font-weight: bold; font-style: italic;">' or `</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">latest</span><span style="color: #52534d; font-weight: bold; font-style: italic;">'. If SUBTREE-P is non-nil,</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">search whole subtree."</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">interactive</span> <span style="color: #6688aa;">(</span><span style="color: #83cc83cc83cc; text-decoration: underline;">list</span> <span style="color: #858253;">(</span><span style="color: #6c006c006c00; text-decoration: underline;">intern</span> <span style="color: #8686ae;">(</span><span style="color: #700070007000; text-decoration: underline;">completing</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">read</span> <span style="color: #858253;">"Which timestamp? "</span> <span style="color: #5b8583;">'</span><span style="color: #858253;">(</span><span style="color: #6c006c006c00;">earliest</span> <span style="color: #a6ffad95b400;">latest</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
                     <span style="color: #858253;">(</span><span style="color: #909990999099; text-decoration: underline;">read</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">file</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">name</span> <span style="color: #858253;">"File: "</span> <span style="color: #8686ae;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">concat</span> <span style="color: #a6ffad95b400;">org</span>-<span style="color: #a6cca6cca6cc;">directory</span> <span style="color: #858253;">"/"</span><span style="color: #8686ae;">)</span> <span style="color: #a6cca6cca6cc;">nil</span> <span style="color: #5b8583;">'</span><span style="color: #9a009a009a00;">mustmatch</span> <span style="color: #a6cca6cca6cc;">nil</span>
                                     <span style="color: #8686ae;">(</span><span style="color: #86aed5;">lambda</span> <span style="color: #858253;">(</span><span style="color: #83cc83cc83cc;">filename</span><span style="color: #858253;">)</span>
                                       <span style="color: #858253;">(</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">string</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">suffix</span><span style="text-decoration: underline;">-</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">p</span> <span style="color: #858253;">".org"</span> <span style="color: #83cc83cc83cc;">filename</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
                     <span style="color: #909990999099;">current</span>-<span style="color: #a6cca6cca6cc;">prefix</span>-<span style="color: #7ccc7ccc7ccc;">arg</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">require</span> <span style="color: #5b8583;">'</span><span style="color: #5b8583;">ts</span><span style="color: #5b8583;">)</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">let*</span> <span style="color: #6688aa;">(</span><span style="color: #858253;">(</span><span style="color: #ba4cba4cba4c;">sorter</span> <span style="color: #8686ae;">(</span><span style="color: #86aed5;">pcase</span> <span style="color: #700070007000;">which</span>-<span style="color: #ba4cba4cba4c;">ts</span>
                   <span style="color: #858253;">(</span><span style="color: #5b8583;">'</span><span style="color: #6c006c006c00;">earliest</span> <span style="color: #5b8583;">#'</span><span style="color: #ba4cba4cba4c;">ts</span>&lt;<span style="color: #858253;">)</span>
                   <span style="color: #858253;">(</span><span style="color: #5b8583;">'</span><span style="color: #a6ffad95b400;">latest</span> <span style="color: #5b8583;">#'</span><span style="color: #ba4cba4cba4c;">ts</span>&gt;<span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
         <span style="color: #858253;">(</span><span style="color: #78cc78cc78cc;">tss</span> <span style="color: #8686ae;">(</span><span style="color: #909990999099; text-decoration: underline;">unpackaged</span><span style="text-decoration: underline;">/</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #a6ffad95b400; text-decoration: underline;">timestamps</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">in</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">entry</span> <span style="color: #afaa9b418aed;">subtree</span>-<span style="color: #a9ba7fd34edf;">p</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
         <span style="color: #858253;">(</span><span style="color: #ba4cba4cba4c;">ts</span> <span style="color: #8686ae;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">car</span> <span style="color: #858253;">(</span><span style="color: #6c006c006c00; text-decoration: underline;">sort</span> <span style="color: #78cc78cc78cc;">tss</span> <span style="color: #ba4cba4cba4c;">sorter</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
         <span style="color: #858253;">(</span><span style="color: #9a009a009a00;">date</span> <span style="color: #8686ae;">(</span><span style="color: #83cc83cc83cc; text-decoration: underline;">list</span> <span style="color: #858253;">(</span><span style="color: #ba4cba4cba4c;">ts</span>-<span style="color: #9a009a009a00;">month</span> <span style="color: #ba4cba4cba4c;">ts</span><span style="color: #858253;">)</span> <span style="color: #858253;">(</span><span style="color: #ba4cba4cba4c;">ts</span>-<span style="color: #83cc83cc83cc;">day</span> <span style="color: #ba4cba4cba4c;">ts</span><span style="color: #858253;">)</span> <span style="color: #858253;">(</span><span style="color: #ba4cba4cba4c;">ts</span>-<span style="color: #700070007000;">year</span> <span style="color: #ba4cba4cba4c;">ts</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #909990999099; text-decoration: underline;">unpackaged</span><span style="text-decoration: underline;">/</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">refile</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">to</span><span style="text-decoration: underline;">-</span><span style="color: #a6ffad95b400; text-decoration: underline;">datetree</span> <span style="color: #6c006c006c00;">file</span> <span style="color: #86aed5;">:date</span> <span style="color: #9a009a009a00;">date</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span>

<span style="color: #9aaccb;">(</span><span style="color: #86aed5;">defun</span> <span style="color: #fdfdd5;">unpackaged/org-timestamps-in-entry</span> <span style="color: #5b8583;">(</span><span style="color: #8686ae;">&amp;optional</span> <span style="color: #afaa9b418aed;">subtree</span>-<span style="color: #a9ba7fd34edf;">p</span><span style="color: #5b8583;">)</span>
  <span style="color: #52534d; font-weight: bold; font-style: italic;">"Return timestamp objects for all Org timestamps in entry.</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;"> If SUBTREE-P is non-nil (interactively, with prefix), search</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;"> whole subtree."</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">interactive</span> <span style="color: #6688aa;">(</span><span style="color: #83cc83cc83cc; text-decoration: underline;">list</span> <span style="color: #909990999099;">current</span>-<span style="color: #a6cca6cca6cc;">prefix</span>-<span style="color: #7ccc7ccc7ccc;">arg</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">save-excursion</span>
    <span style="color: #6688aa;">(</span><span style="color: #86aed5;">let*</span> <span style="color: #858253;">(</span><span style="color: #8686ae;">(</span><span style="color: #a36673883b99;">beg</span> <span style="color: #858253;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">entry</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">beginning</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">position</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span>
           <span style="color: #8686ae;">(</span><span style="color: #909990999099;">end</span> <span style="color: #858253;">(</span><span style="color: #86aed5;">if</span> <span style="color: #afaa9b418aed;">subtree</span>-<span style="color: #a9ba7fd34edf;">p</span>
                    <span style="color: #dd8844;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">end</span><span style="text-decoration: underline;">-</span><span style="color: #700070007000; text-decoration: underline;">of</span><span style="text-decoration: underline;">-</span><span style="color: #afaa9b418aed; text-decoration: underline;">subtree</span><span style="color: #dd8844;">)</span>
                  <span style="color: #dd8844;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">entry</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">end</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">position</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
      <span style="color: #858253;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">char</span> <span style="color: #a36673883b99;">beg</span><span style="color: #858253;">)</span>
      <span style="color: #858253;">(</span><span style="color: #86aed5;">cl-loop</span> <span style="color: #b0668cf47099;">while</span> <span style="color: #8686ae;">(</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">re</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">search</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">forward</span> <span style="color: #a6ffad95b400;">org</span>-<span style="color: #909990999099;">tsr</span>-<span style="color: #700070007000;">regexp</span>-<span style="color: #b0668cf47099;">both</span> <span style="color: #909990999099;">end</span> <span style="color: #9a009a009a00;">t</span><span style="color: #8686ae;">)</span>
               <span style="color: #ba4cba4cba4c;">for</span> <span style="color: #ba4cba4cba4c;">ts</span> = <span style="color: #8686ae;">(</span><span style="color: #86aed5;">save-excursion</span>
                          <span style="color: #858253;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">char</span> <span style="color: #dd8844;">(</span><span style="color: #78cc78cc78cc; text-decoration: underline;">match</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">beginning</span> <span style="color: #7ccc7ccc7ccc;">0</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span>
                          <span style="color: #858253;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">element</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">timestamp</span><span style="text-decoration: underline;">-</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">parser</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span>
               <span style="color: #a6cca6cca6cc;">collect</span> <span style="color: #8686ae;">(</span><span style="color: #ba4cba4cba4c;">ts</span>-<span style="color: #a6ffad95b400;">parse</span>-<span style="color: #a6ffad95b400;">org</span> <span style="color: #ba4cba4cba4c;">ts</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span>

<span style="color: #9aaccb;">(</span><span style="color: #86aed5;">cl-defun</span> <span style="color: #fdfdd5;">unpackaged/org-refile-to-datetree</span> <span style="color: #5b8583;">(</span><span style="color: #6c006c006c00;">file</span> <span style="color: #8686ae;">&amp;key</span> <span style="color: #6688aa;">(</span><span style="color: #9a009a009a00;">date</span> <span style="color: #858253;">(</span><span style="color: #b0668cf47099; text-decoration: underline;">calendar</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">current</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">date</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span> <span style="color: #909990999099;">entry</span><span style="color: #5b8583;">)</span>
  <span style="color: #52534d; font-weight: bold; font-style: italic;">"Refile ENTRY or current node to entry for DATE in datetree in FILE."</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">interactive</span> <span style="color: #6688aa;">(</span><span style="color: #83cc83cc83cc; text-decoration: underline;">list</span> <span style="color: #858253;">(</span><span style="color: #909990999099; text-decoration: underline;">read</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">file</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">name</span> <span style="color: #858253;">"File: "</span> <span style="color: #8686ae;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">concat</span> <span style="color: #a6ffad95b400;">org</span>-<span style="color: #a6cca6cca6cc;">directory</span> <span style="color: #858253;">"/"</span><span style="color: #8686ae;">)</span> <span style="color: #a6cca6cca6cc;">nil</span> <span style="color: #5b8583;">'</span><span style="color: #9a009a009a00;">mustmatch</span> <span style="color: #a6cca6cca6cc;">nil</span>
                                     <span style="color: #8686ae;">(</span><span style="color: #86aed5;">lambda</span> <span style="color: #858253;">(</span><span style="color: #83cc83cc83cc;">filename</span><span style="color: #858253;">)</span>
                                       <span style="color: #858253;">(</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">string</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">suffix</span><span style="text-decoration: underline;">-</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">p</span> <span style="color: #858253;">".org"</span> <span style="color: #83cc83cc83cc;">filename</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span>
  <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">If org-datetree isn't loaded, it will cut the tree but not file</span>
  <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">it anywhere, losing data. I don't know why</span>
  <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">org-datetree-file-entry-under is in a separate package, not</span>
  <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">loaded with the rest of org-mode.</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">require</span> <span style="color: #5b8583;">'</span><span style="color: #5b8583;">org-datetree</span><span style="color: #5b8583;">)</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">unless</span> <span style="color: #909990999099;">entry</span>
    <span style="color: #6688aa;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">cut</span><span style="text-decoration: underline;">-</span><span style="color: #afaa9b418aed; text-decoration: underline;">subtree</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span>
  <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Using a condition-case to be extra careful. In case the refile</span>
  <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">fails in any way, put cut subtree back.</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">condition-case</span> <span style="color: #a36673883b99;">err</span>
      <span style="color: #6688aa;">(</span><span style="color: #86aed5;">with-current-buffer</span> <span style="color: #858253;">(</span><span style="color: #86aed5;">or</span> <span style="color: #8686ae;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #a36673883b99; text-decoration: underline;">find</span><span style="text-decoration: underline;">-</span><span style="color: #700070007000; text-decoration: underline;">base</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">buffer</span><span style="text-decoration: underline;">-</span><span style="color: #a6ffad95b400; text-decoration: underline;">visiting</span> <span style="color: #6c006c006c00;">file</span><span style="color: #8686ae;">)</span>
                               <span style="color: #8686ae;">(</span><span style="color: #a36673883b99; text-decoration: underline;">find</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">file</span><span style="text-decoration: underline;">-</span><span style="color: #700070007000; text-decoration: underline;">noselect</span> <span style="color: #6c006c006c00;">file</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
        <span style="color: #858253;">(</span><span style="color: #a6ffad95b400;">org</span>-<span style="color: #a6ffad95b400;">datetree</span>-<span style="color: #6c006c006c00;">file</span>-<span style="color: #909990999099;">entry</span>-<span style="color: #a6cca6cca6cc;">under</span> <span style="color: #8686ae;">(</span><span style="color: #86aed5;">or</span> <span style="color: #909990999099;">entry</span> <span style="color: #858253;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">car</span> <span style="color: #78cc78cc78cc;">kill</span>-<span style="color: #afaa9b418aed;">ring</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span> <span style="color: #9a009a009a00;">date</span><span style="color: #858253;">)</span>
        <span style="color: #858253;">(</span><span style="color: #b0668cf47099; text-decoration: underline;">save</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">buffer</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #dd8844;">error</span> <span style="color: #858253;">(</span><span style="color: #9a009a009a00;">unless</span> <span style="color: #909990999099;">entry</span>
             <span style="color: #8686ae;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #700070007000; text-decoration: underline;">paste</span><span style="text-decoration: underline;">-</span><span style="color: #afaa9b418aed; text-decoration: underline;">subtree</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
           <span style="color: #858253;">(</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">message</span> <span style="color: #858253;">"Unable to refile! %s"</span> <span style="color: #a36673883b99;">err</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org0033a67" class="outline-3">
<h3 id="org0033a67"><code>org-return-dwim</code></h3>
<div class="outline-text-3" id="text-org0033a67">
<p>
A helpful replacement for <code>org-return</code>.  With prefix, call <code>org-return</code>.
</p>

<p>
On headings, move point to position after entry content.  In lists, insert a new item or end the list, with checkbox if appropriate.  In tables, insert a new row or end the table.
</p>

<p>
Inspired by <a href="http://kitchingroup.cheme.cmu.edu/blog/2017/04/09/A-better-return-in-org-mode/">John Kitchin</a>.
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #9aaccb;">(</span><span style="color: #86aed5;">defun</span> <span style="color: #fdfdd5;">unpackaged/org-return-dwim</span> <span style="color: #5b8583;">(</span><span style="color: #8686ae;">&amp;optional</span> <span style="color: #9a009a009a00;">default</span><span style="color: #5b8583;">)</span>
  <span style="color: #52534d; font-weight: bold; font-style: italic;">"A helpful replacement for `</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">org-return</span><span style="color: #52534d; font-weight: bold; font-style: italic;">'.  With prefix, call `</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">org-return</span><span style="color: #52534d; font-weight: bold; font-style: italic;">'.</span>

<span style="color: #52534d; font-weight: bold; font-style: italic;">On headings, move point to position after entry content.  In</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">lists, insert a new item or end the list, with checkbox if</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">appropriate.  In tables, insert a new row or end the table."</span>
  <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Inspired by John Kitchin: http://kitchingroup.cheme.cmu.edu/blog/2017/04/09/A-better-return-in-org-mode/</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">interactive</span> <span style="color: #858253;">"P"</span><span style="color: #5b8583;">)</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">if</span> <span style="color: #9a009a009a00;">default</span>
      <span style="color: #6688aa;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #a36673883b99; text-decoration: underline;">return</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #86aed5;">cond</span>
     <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Act depending on context around point.</span>

     <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #2aa198;">NOTE</span><span style="color: #586e75; font-weight: bold; font-style: italic;">: I prefer RET to not follow links, but by uncommenting this block, links will be</span>
     <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">followed.</span>

     <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">((</span><span style="color: #586e75; font-weight: bold; font-style: italic; text-decoration: underline;">eq</span><span style="color: #586e75; font-weight: bold; font-style: italic;"> 'link (</span><span style="color: #586e75; font-weight: bold; font-style: italic; text-decoration: underline;">car</span><span style="color: #586e75; font-weight: bold; font-style: italic;"> (</span><span style="color: #586e75; font-weight: bold; font-style: italic; text-decoration: underline;">org-element-context</span><span style="color: #586e75; font-weight: bold; font-style: italic;">)))</span>
     <span style="color: #586e75; font-weight: bold; font-style: italic;">;;  </span><span style="color: #586e75; font-weight: bold; font-style: italic;">;; Link: Open it.</span>
     <span style="color: #586e75; font-weight: bold; font-style: italic;">;;  </span><span style="color: #586e75; font-weight: bold; font-style: italic;">(</span><span style="color: #586e75; font-weight: bold; font-style: italic; text-decoration: underline;">org-open-at-point-global</span><span style="color: #586e75; font-weight: bold; font-style: italic;">))</span>

     <span style="color: #858253;">(</span><span style="color: #8686ae;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">at</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">heading</span><span style="text-decoration: underline;">-</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">p</span><span style="color: #8686ae;">)</span>
      <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Heading: Move to position after entry content.</span>
      <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #2aa198;">NOTE</span><span style="color: #586e75; font-weight: bold; font-style: italic;">: This is probably the most interesting feature of this function.</span>
      <span style="color: #8686ae;">(</span><span style="color: #86aed5;">let</span> <span style="color: #858253;">(</span><span style="color: #dd8844;">(</span><span style="color: #6c006c006c00;">heading</span>-<span style="color: #a6cca6cca6cc;">start</span> <span style="color: #a2b6da;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">entry</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">beginning</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">position</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span>
        <span style="color: #858253;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">char</span> <span style="color: #dd8844;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">entry</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">end</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">position</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span>
        <span style="color: #858253;">(</span><span style="color: #86aed5;">cond</span> <span style="color: #dd8844;">(</span><span style="color: #a2b6da;">(</span><span style="color: #86aed5;">and</span> <span style="color: #9cb6ad;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">at</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">heading</span><span style="text-decoration: underline;">-</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">p</span><span style="color: #9cb6ad;">)</span>
                    <span style="color: #9cb6ad;">(</span>= <span style="color: #6c006c006c00;">heading</span>-<span style="color: #a6cca6cca6cc;">start</span> <span style="color: #9aaccb;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">entry</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">beginning</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">position</span><span style="color: #9aaccb;">)</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span>
               <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Entry ends on its heading; add newline after</span>
               <span style="color: #a2b6da;">(</span><span style="color: #909990999099; text-decoration: underline;">end</span><span style="text-decoration: underline;">-</span><span style="color: #700070007000; text-decoration: underline;">of</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">line</span><span style="color: #a2b6da;">)</span>
               <span style="color: #a2b6da;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">insert</span> <span style="color: #858253;">"\n\n"</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span>
              <span style="color: #dd8844;">(</span><span style="color: #9a009a009a00;">t</span>
               <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Entry ends after its heading; back up</span>
               <span style="color: #a2b6da;">(</span><span style="color: #b0668cf47099; text-decoration: underline;">forward</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">line</span> -<span style="color: #ba4cba4cba4c;">1</span><span style="color: #a2b6da;">)</span>
               <span style="color: #a2b6da;">(</span><span style="color: #909990999099; text-decoration: underline;">end</span><span style="text-decoration: underline;">-</span><span style="color: #700070007000; text-decoration: underline;">of</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">line</span><span style="color: #a2b6da;">)</span>
               <span style="color: #a2b6da;">(</span><span style="color: #86aed5;">when</span> <span style="color: #9cb6ad;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">at</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">heading</span><span style="text-decoration: underline;">-</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">p</span><span style="color: #9cb6ad;">)</span>
                 <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">At the same heading</span>
                 <span style="color: #9cb6ad;">(</span><span style="color: #b0668cf47099; text-decoration: underline;">forward</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">line</span><span style="color: #9cb6ad;">)</span>
                 <span style="color: #9cb6ad;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">insert</span> <span style="color: #858253;">"\n"</span><span style="color: #9cb6ad;">)</span>
                 <span style="color: #9cb6ad;">(</span><span style="color: #b0668cf47099; text-decoration: underline;">forward</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">line</span> -<span style="color: #ba4cba4cba4c;">1</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span>
               <span style="color: #a2b6da;">(</span><span style="color: #86aed5;">while</span> <span style="color: #9cb6ad;">(</span><span style="color: #cb4b16; font-weight: bold;">not</span> <span style="color: #9aaccb;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">looking</span><span style="text-decoration: underline;">-</span><span style="color: #700070007000; text-decoration: underline;">back</span> <span style="color: #5b8583;">(</span><span style="color: #86aed5;">rx</span> <span style="color: #6688aa;">(</span><span style="color: #b0668cf47099; text-decoration: underline;">repeat</span> <span style="color: #ba4cba4cba4c;">3</span> <span style="color: #858253;">(</span><span style="color: #a6cca6cca6cc;">seq</span> <span style="color: #8686ae;">(</span><span style="color: #a36673883b99;">optional</span> <span style="color: #909990999099;">blank</span><span style="color: #8686ae;">)</span> <span style="color: #858253;">"\n"</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span><span style="color: #9cb6ad;">)</span>
                 <span style="color: #9cb6ad;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">insert</span> <span style="color: #858253;">"\n"</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span>
               <span style="color: #a2b6da;">(</span><span style="color: #b0668cf47099; text-decoration: underline;">forward</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">line</span> -<span style="color: #ba4cba4cba4c;">1</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>

     <span style="color: #858253;">(</span><span style="color: #8686ae;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">at</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">item</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">checkbox</span><span style="text-decoration: underline;">-</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">p</span><span style="color: #8686ae;">)</span>
      <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Checkbox: Insert new item with checkbox.</span>
      <span style="color: #8686ae;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">insert</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">todo</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">heading</span> <span style="color: #a6cca6cca6cc;">nil</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>

     <span style="color: #858253;">(</span><span style="color: #8686ae;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">in</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">item</span><span style="text-decoration: underline;">-</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">p</span><span style="color: #8686ae;">)</span>
      <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Plain list</span>
      <span style="color: #8686ae;">(</span><span style="color: #86aed5;">cond</span> <span style="color: #858253;">(</span><span style="color: #dd8844;">(</span><span style="color: #86aed5;">save-excursion</span>
               <span style="color: #a2b6da;">(</span><span style="color: #909990999099; text-decoration: underline;">end</span><span style="text-decoration: underline;">-</span><span style="color: #700070007000; text-decoration: underline;">of</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">line</span><span style="color: #a2b6da;">)</span>
               <span style="color: #a2b6da;">(</span><span style="color: #cb4b16; font-weight: bold;">not</span> <span style="color: #9cb6ad;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">element</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">property</span> <span style="color: #86aed5;">:contents-begin</span> <span style="color: #9aaccb;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">element</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">context</span><span style="color: #9aaccb;">)</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span>
             <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Empty item: Close the list.</span>

             <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #859900;">TODO</span><span style="color: #586e75; font-weight: bold; font-style: italic;">: Do this with org functions rather than operating on the text. Can't seem to</span>
             <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">find the right function.</span>
             <span style="color: #dd8844;">(</span><span style="color: #83cc83cc83cc; text-decoration: underline;">delete</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">region</span> <span style="color: #a2b6da;">(</span><span style="color: #83cc83cc83cc; text-decoration: underline;">line</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">beginning</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">position</span><span style="color: #a2b6da;">)</span> <span style="color: #a2b6da;">(</span><span style="color: #83cc83cc83cc; text-decoration: underline;">line</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">end</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">position</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span>
             <span style="color: #dd8844;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">insert</span> <span style="color: #858253;">"\n"</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span>
            <span style="color: #858253;">(</span><span style="color: #9a009a009a00;">t</span>
             <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Non-empty item: Add new item.</span>
             <span style="color: #dd8844;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">insert</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">heading</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>

     <span style="color: #858253;">(</span><span style="color: #8686ae;">(</span><span style="color: #86aed5;">when</span> <span style="color: #858253;">(</span><span style="color: #6c006c006c00; text-decoration: underline;">fboundp</span> <span style="color: #5b8583;">'</span><span style="color: #a6ffad95b400;">org</span>-<span style="color: #9a009a009a00;">inlinetask</span>-<span style="color: #909990999099;">in</span>-<span style="color: #afaa9b418aed;">task</span>-<span style="color: #a9ba7fd34edf;">p</span><span style="color: #858253;">)</span>
        <span style="color: #858253;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">inlinetask</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">in</span><span style="text-decoration: underline;">-</span><span style="color: #afaa9b418aed; text-decoration: underline;">task</span><span style="text-decoration: underline;">-</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">p</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span>
      <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Inline task: Don't insert a new heading.</span>
      <span style="color: #8686ae;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #a36673883b99; text-decoration: underline;">return</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>

     <span style="color: #858253;">(</span><span style="color: #8686ae;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">at</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">table</span><span style="text-decoration: underline;">-</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">p</span><span style="color: #8686ae;">)</span>
      <span style="color: #8686ae;">(</span><span style="color: #86aed5;">cond</span> <span style="color: #858253;">(</span><span style="color: #dd8844;">(</span><span style="color: #86aed5;">save-excursion</span>
               <span style="color: #a2b6da;">(</span><span style="color: #6c006c006c00; text-decoration: underline;">beginning</span><span style="text-decoration: underline;">-</span><span style="color: #700070007000; text-decoration: underline;">of</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">line</span><span style="color: #a2b6da;">)</span>
               <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">See `</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">org-table-next-field</span><span style="color: #586e75; font-weight: bold; font-style: italic;">'.</span>
               <span style="color: #a2b6da;">(</span><span style="color: #86aed5;">cl-loop</span> <span style="color: #a6cca6cca6cc;">with</span> <span style="color: #909990999099;">end</span> = <span style="color: #9cb6ad;">(</span><span style="color: #83cc83cc83cc; text-decoration: underline;">line</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">end</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">position</span><span style="color: #9cb6ad;">)</span>
                        <span style="color: #ba4cba4cba4c;">for</span> <span style="color: #7ccc7ccc7ccc;">cell</span> = <span style="color: #9cb6ad;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">element</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">table</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">cell</span><span style="text-decoration: underline;">-</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">parser</span><span style="color: #9cb6ad;">)</span>
                        <span style="color: #6c006c006c00;">always</span> <span style="color: #9cb6ad;">(</span><span style="color: #b0668cf47099; text-decoration: underline;">equal</span> <span style="color: #9aaccb;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">element</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">property</span> <span style="color: #86aed5;">:contents-begin</span> <span style="color: #7ccc7ccc7ccc;">cell</span><span style="color: #9aaccb;">)</span>
                                      <span style="color: #9aaccb;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">element</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">property</span> <span style="color: #86aed5;">:contents-end</span> <span style="color: #7ccc7ccc7ccc;">cell</span><span style="color: #9aaccb;">)</span><span style="color: #9cb6ad;">)</span>
                        <span style="color: #b0668cf47099;">while</span> <span style="color: #9cb6ad;">(</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">re</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">search</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">forward</span> <span style="color: #858253;">"|"</span> <span style="color: #909990999099;">end</span> <span style="color: #9a009a009a00;">t</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span>
             <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Empty row: end the table.</span>
             <span style="color: #dd8844;">(</span><span style="color: #83cc83cc83cc; text-decoration: underline;">delete</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">region</span> <span style="color: #a2b6da;">(</span><span style="color: #83cc83cc83cc; text-decoration: underline;">line</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">beginning</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">position</span><span style="color: #a2b6da;">)</span> <span style="color: #a2b6da;">(</span><span style="color: #83cc83cc83cc; text-decoration: underline;">line</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">end</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">position</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span>
             <span style="color: #dd8844;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #a36673883b99; text-decoration: underline;">return</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span>
            <span style="color: #858253;">(</span><span style="color: #9a009a009a00;">t</span>
             <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Non-empty row: call `</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">org-return</span><span style="color: #586e75; font-weight: bold; font-style: italic;">'.</span>
             <span style="color: #dd8844;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #a36673883b99; text-decoration: underline;">return</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
     <span style="color: #858253;">(</span><span style="color: #9a009a009a00;">t</span>
      <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">All other cases: call `</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">org-return</span><span style="color: #586e75; font-weight: bold; font-style: italic;">'.</span>
      <span style="color: #8686ae;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #a36673883b99; text-decoration: underline;">return</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdff242d" class="outline-3">
<h3 id="orgdff242d">Read-only trees</h3>
<div class="outline-text-3" id="text-orgdff242d">
<p>
This code applies the <code>read-only</code> text-property to trees tagged <code>read_only</code>, preventing them from being modified accidentally.  (Note: If read-only headings appear in an Agenda buffer, it can cause slightly unusual behavior.  Usually this is not an issue.)  This was originally inspired by John Kitchin's <a href="http://kitchingroup.cheme.cmu.edu/blog/2014/09/13/Make-some-org-sections-read-only/">blog article</a> and later <a href="https://www.reddit.com/r/emacs/comments/92k7n1/guide_to_profiling_and_optimizing_an_orgrelated/">rewritten</a> in a faster version.
</p>

<p>
To use, load these functions, and then add to this hook to automatically mark read-only sections when an Org file is loaded:
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #9aaccb;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">add</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">hook</span> <span style="color: #5b8583;">'</span><span style="color: #a6ffad95b400;">org</span>-<span style="color: #7ccc7ccc7ccc;">mode</span>-<span style="color: #83cc83cc83cc;">hook</span> <span style="color: #5b8583;">'</span><span style="color: #909990999099;">unpackaged</span>/<span style="color: #a6ffad95b400;">org</span>-<span style="color: #700070007000;">mark</span>-<span style="color: #909990999099;">read</span>-<span style="color: #ba4cba4cba4c;">only</span><span style="color: #9aaccb;">)</span>
</pre>
</div>

<p>
The functions may also be called interactively as needed.
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #9aaccb;">(</span><span style="color: #86aed5;">defun</span> <span style="color: #fdfdd5;">unpackaged/org-next-heading-tagged</span> <span style="color: #5b8583;">(</span><span style="color: #6c006c006c00;">tag</span><span style="color: #5b8583;">)</span>
  <span style="color: #52534d; font-weight: bold; font-style: italic;">"Move to beginning of next heading tagged with TAG and return point, or return nil if none found."</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">when</span> <span style="color: #6688aa;">(</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">re</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">search</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">forward</span> <span style="color: #858253;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">rx</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">to</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">string</span> <span style="color: #5b8583;">`</span><span style="color: #8686ae;">(</span><span style="color: #a6cca6cca6cc;">seq</span> <span style="color: #ba4cba4cba4c;">bol</span> <span style="color: #858253;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">1</span><span style="text-decoration: underline;">+</span> <span style="color: #858253;">"*"</span><span style="color: #858253;">)</span> <span style="color: #858253;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">1</span><span style="text-decoration: underline;">+</span> <span style="color: #909990999099;">blank</span><span style="color: #858253;">)</span> <span style="color: #858253;">(</span><span style="color: #a36673883b99;">optional</span> <span style="color: #dd8844;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">1</span><span style="text-decoration: underline;">+</span> <span style="color: #a6ffad95b400;">not</span>-<span style="color: #700070007000;">newline</span><span style="color: #dd8844;">)</span> <span style="color: #dd8844;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">1</span><span style="text-decoration: underline;">+</span> <span style="color: #909990999099;">blank</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span>
                                               <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Beginning of tags</span>
                                               <span style="color: #858253;">":"</span>
                                               <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Possible other tags</span>
                                               <span style="color: #858253;">(</span><span style="color: #7ccc7ccc7ccc;">0</span>+ <span style="color: #dd8844;">(</span><span style="color: #a6cca6cca6cc;">seq</span> <span style="color: #a2b6da;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">1</span><span style="text-decoration: underline;">+</span> <span style="color: #9cb6ad;">(</span><span style="color: #cb4b16; font-weight: bold;">not</span> <span style="color: #9aaccb;">(</span><span style="color: #b0668cf47099;">any</span> <span style="color: #858253;">":"</span> <span style="color: #909990999099;">blank</span><span style="color: #9aaccb;">)</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span> <span style="color: #858253;">":"</span><span style="color: #dd8844;">)</span> <span style="color: #858253;">)</span>
                                               <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">The tag that matters</span>
                                               ,<span style="color: #6c006c006c00;">tag</span> <span style="color: #858253;">":"</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
                           <span style="color: #a6cca6cca6cc;">nil</span> <span style="color: #5b8583;">'</span><span style="color: #700070007000;">noerror</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">char</span> <span style="color: #858253;">(</span><span style="color: #78cc78cc78cc; text-decoration: underline;">match</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">beginning</span> <span style="color: #7ccc7ccc7ccc;">0</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span>

<span style="color: #9aaccb;">(</span><span style="color: #86aed5;">defun</span> <span style="color: #fdfdd5;">unpackaged/org-mark-read-only</span> <span style="color: #5b8583;">()</span>
  <span style="color: #52534d; font-weight: bold; font-style: italic;">"Mark all entries in the buffer tagged \"read_only\" with read-only text properties."</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">interactive</span><span style="color: #5b8583;">)</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">org-with-wide-buffer</span>
   <span style="color: #6688aa;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">char</span> <span style="color: #858253;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">min</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span>
   <span style="color: #6688aa;">(</span><span style="color: #86aed5;">while</span> <span style="color: #858253;">(</span><span style="color: #909990999099; text-decoration: underline;">unpackaged</span><span style="text-decoration: underline;">/</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">next</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">heading</span><span style="text-decoration: underline;">-</span><span style="color: #78cc78cc78cc; text-decoration: underline;">tagged</span> <span style="color: #858253;">"read_only"</span><span style="color: #858253;">)</span>
     <span style="color: #858253;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">add</span><span style="text-decoration: underline;">-</span><span style="color: #78cc78cc78cc; text-decoration: underline;">text</span><span style="text-decoration: underline;">-</span><span style="color: #78cc78cc78cc; text-decoration: underline;">properties</span> <span style="color: #8686ae;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">point</span><span style="color: #8686ae;">)</span> <span style="color: #8686ae;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">end</span><span style="text-decoration: underline;">-</span><span style="color: #700070007000; text-decoration: underline;">of</span><span style="text-decoration: underline;">-</span><span style="color: #afaa9b418aed; text-decoration: underline;">subtree</span> <span style="color: #9a009a009a00;">t</span><span style="color: #8686ae;">)</span>
                          <span style="color: #5b8583;">'</span><span style="color: #8686ae;">(</span><span style="color: #909990999099;">read</span>-<span style="color: #ba4cba4cba4c;">only</span> <span style="color: #9a009a009a00;">t</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span>

<span style="color: #9aaccb;">(</span><span style="color: #86aed5;">defun</span> <span style="color: #fdfdd5;">unpackaged/org-remove-read-only</span> <span style="color: #5b8583;">()</span>
  <span style="color: #52534d; font-weight: bold; font-style: italic;">"Remove read-only text properties from Org entries tagged \"read_only\" in current buffer."</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">let</span> <span style="color: #6688aa;">(</span><span style="color: #858253;">(</span><span style="color: #a6ffad95b400;">inhibit</span>-<span style="color: #909990999099;">read</span>-<span style="color: #ba4cba4cba4c;">only</span> <span style="color: #9a009a009a00;">t</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #86aed5;">org-with-wide-buffer</span>
     <span style="color: #858253;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">char</span> <span style="color: #8686ae;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">min</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
     <span style="color: #858253;">(</span><span style="color: #86aed5;">while</span> <span style="color: #8686ae;">(</span><span style="color: #909990999099; text-decoration: underline;">unpackaged</span><span style="text-decoration: underline;">/</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">next</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">heading</span><span style="text-decoration: underline;">-</span><span style="color: #78cc78cc78cc; text-decoration: underline;">tagged</span> <span style="color: #858253;">"read_only"</span><span style="color: #8686ae;">)</span>
       <span style="color: #8686ae;">(</span><span style="color: #909990999099; text-decoration: underline;">remove</span><span style="text-decoration: underline;">-</span><span style="color: #78cc78cc78cc; text-decoration: underline;">text</span><span style="text-decoration: underline;">-</span><span style="color: #78cc78cc78cc; text-decoration: underline;">properties</span> <span style="color: #858253;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">point</span><span style="color: #858253;">)</span> <span style="color: #858253;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">end</span><span style="text-decoration: underline;">-</span><span style="color: #700070007000; text-decoration: underline;">of</span><span style="text-decoration: underline;">-</span><span style="color: #afaa9b418aed; text-decoration: underline;">subtree</span> <span style="color: #9a009a009a00;">t</span><span style="color: #858253;">)</span>
                               <span style="color: #5b8583;">'</span><span style="color: #858253;">(</span><span style="color: #909990999099;">read</span>-<span style="color: #ba4cba4cba4c;">only</span> <span style="color: #9a009a009a00;">t</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbb432b1" class="outline-3">
<h3 id="orgbb432b1">Sort tree by multiple methods at once</h3>
<div class="outline-text-3" id="text-orgbb432b1">
<p>
Call <code>org-sort-entries</code> with multiple sorting methods specified in <code>KEYS</code>.
</p>

<p>
This is much easier than doing <kbd>C-c ^ KEY</kbd> several times in a row.
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #9aaccb;">(</span><span style="color: #86aed5;">defun</span> <span style="color: #fdfdd5;">unpackaged/org-sort-multi</span> <span style="color: #5b8583;">(</span><span style="color: #ba4cba4cba4c;">keys</span><span style="color: #5b8583;">)</span>
    <span style="color: #52534d; font-weight: bold; font-style: italic;">"Call `</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">org-sort-entries</span><span style="color: #52534d; font-weight: bold; font-style: italic;">' with multiple sorting methods specified in KEYS."</span>
    <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Message copied from `</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">org-sort-entries</span><span style="color: #586e75; font-weight: bold; font-style: italic;">'.</span>
    <span style="color: #5b8583;">(</span><span style="color: #86aed5;">interactive</span> <span style="color: #6688aa;">(</span><span style="color: #83cc83cc83cc; text-decoration: underline;">list</span> <span style="color: #858253;">(</span><span style="color: #909990999099; text-decoration: underline;">read</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">string</span> <span style="color: #858253;">"Sort by: [a]lpha  [n]umeric  [p]riority  p[r]operty  todo[o]rder  [f]unc</span>
<span style="color: #858253;">         [t]ime [s]cheduled  [d]eadline  [c]reated  cloc[k]ing</span>
<span style="color: #858253;">         A/N/P/R/O/F/T/S/D/C/K means reversed: "</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span>
    <span style="color: #5b8583;">(</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">seq</span><span style="text-decoration: underline;">-</span><span style="color: #78cc78cc78cc; text-decoration: underline;">do</span> <span style="color: #6688aa;">(</span><span style="color: #86aed5;">lambda</span> <span style="color: #858253;">(</span><span style="color: #a6cca6cca6cc;">key</span><span style="color: #858253;">)</span>
              <span style="color: #858253;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">sort</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">entries</span> <span style="color: #a6cca6cca6cc;">nil</span> <span style="color: #a6cca6cca6cc;">key</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span>
            <span style="color: #6688aa;">(</span><span style="color: #78cc78cc78cc; text-decoration: underline;">nreverse</span> <span style="color: #ba4cba4cba4c;">keys</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc9ecae2" class="outline-2">
<h2 id="orgc9ecae2">Packages&#xa0;&#xa0;&#xa0;<span class="tag"><span class="packages">packages</span></span></h2>
<div class="outline-text-2" id="text-orgc9ecae2">
</div><div id="outline-container-org1e3db48" class="outline-3">
<h3 id="org1e3db48">Delete all installed versions of a package</h3>
<div class="outline-text-3" id="text-org1e3db48">
<p>
Delete all versions of package named <code>NAME</code>.  <code>NAME</code> may be a string or symbol.
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #9aaccb;">(</span><span style="color: #86aed5;">defun</span> <span style="color: #fdfdd5;">unpackaged/package-delete-all-versions</span> <span style="color: #5b8583;">(</span><span style="color: #7ccc7ccc7ccc;">name</span> <span style="color: #8686ae;">&amp;optional</span> <span style="color: #a6cca6cca6cc;">force</span><span style="color: #5b8583;">)</span>
  <span style="color: #52534d; font-weight: bold; font-style: italic;">"Delete all versions of package named NAME.</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">NAME may be a string or symbol."</span>
  <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Copied from `</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">package-delete</span><span style="color: #586e75; font-weight: bold; font-style: italic;">'.</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">let*</span> <span style="color: #6688aa;">(</span><span style="color: #858253;">(</span><span style="color: #78cc78cc78cc;">package</span>-<span style="color: #7ccc7ccc7ccc;">name</span> <span style="color: #8686ae;">(</span><span style="color: #86aed5;">cl-typecase</span> <span style="color: #7ccc7ccc7ccc;">name</span>
                         <span style="color: #858253;">(</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">string</span> <span style="color: #dd8844;">(</span><span style="color: #6c006c006c00; text-decoration: underline;">intern</span> <span style="color: #7ccc7ccc7ccc;">name</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span>
                         <span style="color: #858253;">(</span><span style="color: #a6cca6cca6cc;">symbol</span> <span style="color: #7ccc7ccc7ccc;">name</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
         <span style="color: #858253;">(</span><span style="color: #a9ba7fd34edf;">user</span>-<span style="color: #9a009a009a00;">packages</span>-<span style="color: #83cc83cc83cc;">list</span> <span style="color: #8686ae;">(</span><span style="color: #86aed5;">-&gt;&gt;</span> <span style="color: #78cc78cc78cc;">package</span>-<span style="color: #b0668cf47099;">alist</span>
                                  <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Just to be safe, we ignore built-ins.</span>
                                  <span style="color: #858253;">(</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">select</span> <span style="color: #dd8844;">(</span><span style="text-decoration: underline;">-</span><span style="color: #a6ffad95b400; text-decoration: underline;">not</span> <span style="color: #5b8583;">#'</span><span style="color: #78cc78cc78cc;">package</span>-<span style="color: #6c006c006c00;">built</span>-<span style="color: #909990999099;">in</span>-<span style="color: #a9ba7fd34edf;">p</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
         <span style="color: #858253;">(</span><span style="color: #a6cca6cca6cc;">matching</span>-<span style="color: #afaa9b418aed;">versions</span> <span style="color: #8686ae;">(</span><span style="color: #86aed5;">--select</span> <span style="color: #858253;">(</span><span style="color: #78cc78cc78cc; text-decoration: underline;">eql</span> <span style="color: #dd8844;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">car</span> <span style="color: #fdfdd5;">it</span><span style="color: #dd8844;">)</span> <span style="color: #78cc78cc78cc;">package</span>-<span style="color: #7ccc7ccc7ccc;">name</span><span style="color: #858253;">)</span> <span style="color: #a9ba7fd34edf;">user</span>-<span style="color: #9a009a009a00;">packages</span>-<span style="color: #83cc83cc83cc;">list</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span>
    <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Safety checks.</span>
    <span style="color: #6688aa;">(</span><span style="color: #86aed5;">cl-loop</span> <span style="color: #ba4cba4cba4c;">for</span> <span style="color: #858253;">(</span><span style="color: #a6cca6cca6cc;">symbol</span> <span style="color: #a36673883b99;">first</span>-<span style="color: #9a009a009a00;">desc</span> . <span style="color: #6c006c006c00;">rest</span><span style="color: #858253;">)</span> <span style="color: #909990999099;">in</span> <span style="color: #a6cca6cca6cc;">matching</span>-<span style="color: #afaa9b418aed;">versions</span>
             <span style="color: #78cc78cc78cc;">do</span> <span style="color: #858253;">(</span><span style="color: #86aed5;">progn</span>
                  <span style="color: #8686ae;">(</span><span style="color: #86aed5;">unless</span> <span style="color: #a6cca6cca6cc;">force</span>
                    <span style="color: #858253;">(</span><span style="color: #86aed5;">when-let*</span> <span style="color: #dd8844;">(</span><span style="color: #a2b6da;">(</span><span style="color: #a6cca6cca6cc;">dependent</span> <span style="color: #9cb6ad;">(</span><span style="color: #78cc78cc78cc; text-decoration: underline;">package</span><span style="text-decoration: underline;">--</span><span style="color: #b0668cf47099; text-decoration: underline;">used</span><span style="text-decoration: underline;">-</span><span style="color: #78cc78cc78cc; text-decoration: underline;">elsewhere</span><span style="text-decoration: underline;">-</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">p</span> <span style="color: #a36673883b99;">first</span>-<span style="color: #9a009a009a00;">desc</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span>
                      <span style="color: #dd8844;">(</span><span style="color: #dd8844;">error</span> <span style="color: #858253;">"Package `</span><span style="color: #5b8583;">%s</span><span style="color: #858253;">' depends on `</span><span style="color: #5b8583;">%s</span><span style="color: #858253;">'"</span> <span style="color: #a2b6da;">(</span><span style="color: #78cc78cc78cc; text-decoration: underline;">package</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">desc</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">name</span> <span style="color: #a6cca6cca6cc;">dependent</span><span style="color: #a2b6da;">)</span> <span style="color: #78cc78cc78cc;">package</span>-<span style="color: #7ccc7ccc7ccc;">name</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span>
                  <span style="color: #8686ae;">(</span><span style="color: #86aed5;">unless</span> <span style="color: #858253;">(</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">string</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">prefix</span><span style="text-decoration: underline;">-</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">p</span> <span style="color: #dd8844;">(</span><span style="color: #6c006c006c00; text-decoration: underline;">file</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">name</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">as</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">directory</span> <span style="color: #a2b6da;">(</span><span style="color: #78cc78cc78cc; text-decoration: underline;">expand</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">file</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">name</span> <span style="color: #78cc78cc78cc;">package</span>-<span style="color: #a9ba7fd34edf;">user</span>-<span style="color: #afaa9b418aed;">dir</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span>
                                           <span style="color: #dd8844;">(</span><span style="color: #78cc78cc78cc; text-decoration: underline;">expand</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">file</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">name</span> <span style="color: #a2b6da;">(</span><span style="color: #78cc78cc78cc; text-decoration: underline;">package</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">desc</span><span style="text-decoration: underline;">-</span><span style="color: #afaa9b418aed; text-decoration: underline;">dir</span> <span style="color: #a36673883b99;">first</span>-<span style="color: #9a009a009a00;">desc</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span>
                    <span style="color: #858253;">(</span><span style="color: #dd8844;">error</span> <span style="color: #858253;">"Package `</span><span style="color: #5b8583;">%s</span><span style="color: #858253;">' is a system package"</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span>
    <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Checks passed: delete packages.</span>
    <span style="color: #6688aa;">(</span><span style="color: #86aed5;">cl-loop</span> <span style="color: #ba4cba4cba4c;">for</span> <span style="color: #858253;">(</span><span style="color: #a6cca6cca6cc;">symbol</span> . <span style="color: #9a009a009a00;">descs</span><span style="color: #858253;">)</span> <span style="color: #909990999099;">in</span> <span style="color: #a6cca6cca6cc;">matching</span>-<span style="color: #afaa9b418aed;">versions</span>
             <span style="color: #78cc78cc78cc;">do</span> <span style="color: #858253;">(</span><span style="color: #86aed5;">--each</span> <span style="color: #9a009a009a00;">descs</span>
                  <span style="color: #8686ae;">(</span><span style="color: #78cc78cc78cc; text-decoration: underline;">package</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">delete</span> <span style="color: #fdfdd5;">it</span> <span style="color: #a6cca6cca6cc;">force</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org121bcc8" class="outline-3">
<h3 id="org121bcc8">Upgrade a <code>quelpa-use-package</code> form's package</h3>
<div class="outline-text-3" id="text-org121bcc8">
<p>
Eval the current <code>use-package</code> form with <code>quelpa-upgrade-p</code> true.  Deletes old versions of the package first to remove obsolete versions.
</p>

<p>
This makes it easy to upgrade a package you install with <a href="https://framagit.org/steckerhalter/quelpa-use-package">quelpa-use-package</a> without having to add <code>:upgrade t</code> to the form, which would cause Quelpa to <i>always</i> upgrade the package every time Emacs loads.
</p>

<p>
<b>Requires:</b>
</p>

<ul class="org-ul">
<li></li>
</ul>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #9aaccb;">(</span><span style="color: #86aed5;">defun</span> <span style="color: #fdfdd5;">unpackaged/quelpa-use-package-upgrade</span> <span style="color: #5b8583;">()</span>
  <span style="color: #52534d; font-weight: bold; font-style: italic;">"Eval the current `</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">use-package</span><span style="color: #52534d; font-weight: bold; font-style: italic;">' form with `</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">quelpa-upgrade-p</span><span style="color: #52534d; font-weight: bold; font-style: italic;">' true.</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">Deletes the package first to remove obsolete versions."</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">interactive</span><span style="color: #5b8583;">)</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">save-excursion</span>
    <span style="color: #6688aa;">(</span><span style="color: #86aed5;">if</span> <span style="color: #858253;">(</span><span style="color: #86aed5;">or</span> <span style="color: #8686ae;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">looking</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">at</span> <span style="color: #858253;">(</span><span style="color: #86aed5;">rx</span> <span style="color: #858253;">"(use-package "</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span>
            <span style="color: #8686ae;">(</span><span style="color: #86aed5;">let</span> <span style="color: #858253;">(</span><span style="color: #dd8844;">(</span><span style="color: #9a009a009a00;">limit</span> <span style="color: #a2b6da;">(</span><span style="color: #86aed5;">save-excursion</span>
                           <span style="color: #9cb6ad;">(</span><span style="color: #86aed5;">or</span> <span style="color: #9aaccb;">(</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">re</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">search</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">backward</span> <span style="color: #5b8583;">(</span><span style="color: #86aed5;">rx</span> <span style="color: #ba4cba4cba4c;">bol</span> <span style="color: #858253;">"("</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span>
                               <span style="color: #9aaccb;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">min</span><span style="color: #9aaccb;">)</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span>
              <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Don't go past previous top-level form</span>
              <span style="color: #858253;">(</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">re</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">search</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">backward</span> <span style="color: #dd8844;">(</span><span style="color: #86aed5;">rx</span> <span style="color: #858253;">"(use-package "</span><span style="color: #dd8844;">)</span> <span style="color: #9a009a009a00;">limit</span> <span style="color: #9a009a009a00;">t</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
        <span style="color: #858253;">(</span><span style="color: #86aed5;">progn</span>
          <span style="color: #8686ae;">(</span><span style="color: #86aed5;">pcase-let*</span> <span style="color: #858253;">(</span><span style="color: #dd8844;">(</span><span style="color: #5b8583;">`</span><span style="color: #a2b6da;">(</span><span style="color: #86aed5;">use-package</span> ,<span style="color: #78cc78cc78cc;">package</span>-<span style="color: #7ccc7ccc7ccc;">name</span> . ,<span style="color: #6c006c006c00;">rest</span><span style="color: #a2b6da;">)</span> <span style="color: #a2b6da;">(</span><span style="color: #909990999099; text-decoration: underline;">read</span> <span style="color: #9cb6ad;">(</span><span style="color: #909990999099; text-decoration: underline;">current</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">buffer</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span>
            <span style="color: #858253;">(</span><span style="color: #dd8844;">cl-assert</span> <span style="color: #78cc78cc78cc;">package</span>-<span style="color: #7ccc7ccc7ccc;">name</span> <span style="color: #a6cca6cca6cc;">nil</span> <span style="color: #858253;">"Can't determine package name"</span><span style="color: #858253;">)</span>
            <span style="color: #858253;">(</span><span style="color: #dd8844;">cl-assert</span> <span style="color: #dd8844;">(</span><span style="color: #86aed5;">cl-loop</span> <span style="color: #ba4cba4cba4c;">for</span> <span style="color: #9a009a009a00;">sexp</span> <span style="color: #909990999099;">in</span> <span style="color: #6c006c006c00;">rest</span>
                                <span style="color: #a6ffad95b400;">thereis</span> <span style="color: #a2b6da;">(</span><span style="color: #78cc78cc78cc; text-decoration: underline;">eql</span> <span style="color: #9a009a009a00;">sexp</span> <span style="color: #86aed5;">:quelpa</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span>
                       <span style="color: #a6cca6cca6cc;">nil</span> <span style="color: #858253;">"`</span><span style="color: #5b8583;">:quelpa</span><span style="color: #858253;">' form not found"</span><span style="color: #858253;">)</span>
            <span style="color: #858253;">(</span><span style="color: #909990999099; text-decoration: underline;">unpackaged</span><span style="text-decoration: underline;">/</span><span style="color: #78cc78cc78cc; text-decoration: underline;">package</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">delete</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">all</span><span style="text-decoration: underline;">-</span><span style="color: #afaa9b418aed; text-decoration: underline;">versions</span> <span style="color: #78cc78cc78cc;">package</span>-<span style="color: #7ccc7ccc7ccc;">name</span> <span style="color: #5b8583;">'</span><span style="color: #a6cca6cca6cc;">force</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span>
          <span style="color: #8686ae;">(</span><span style="color: #86aed5;">let</span> <span style="color: #858253;">(</span><span style="color: #dd8844;">(</span><span style="color: #9a009a009a00;">quelpa</span>-<span style="color: #a6cca6cca6cc;">upgrade</span>-<span style="color: #a9ba7fd34edf;">p</span> <span style="color: #9a009a009a00;">t</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span>
            <span style="color: #858253;">(</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">call</span><span style="text-decoration: underline;">-</span><span style="color: #afaa9b418aed; text-decoration: underline;">interactively</span> <span style="color: #5b8583;">#'</span><span style="color: #a36673883b99;">eval</span>-<span style="color: #afaa9b418aed;">defun</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
      <span style="color: #858253;">(</span><span style="color: #dd8844;">user-error</span> <span style="color: #858253;">"Not in a `</span><span style="color: #5b8583;">use-package</span><span style="color: #858253;">' form"</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2578630" class="outline-3">
<h3 id="org2578630">Upgrade one package in the package menu</h3>
<div class="outline-text-3" id="text-org2578630">
<p>
Mark current package for upgrading (i.e. also mark obsolete version for deletion.)
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #9aaccb;">(</span><span style="color: #86aed5;">use-package</span> <span style="color: #5b8583;">package</span>
  <span style="color: #86aed5;">:bind</span> <span style="color: #5b8583;">(</span><span style="color: #86aed5;">:map</span> <span style="color: #78cc78cc78cc;">package</span>-<span style="color: #afaa9b418aed;">menu</span>-<span style="color: #7ccc7ccc7ccc;">mode</span>-<span style="color: #a9ba7fd34edf;">map</span>
              <span style="color: #6688aa;">(</span><span style="color: #858253;">"t"</span> . <span style="color: #5b8583;">#'</span><span style="color: #909990999099;">unpackaged</span>/<span style="color: #78cc78cc78cc;">package</span>-<span style="color: #afaa9b418aed;">menu</span>-<span style="color: #a6cca6cca6cc;">upgrade</span>-<span style="color: #78cc78cc78cc;">package</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span>
  <span style="color: #86aed5;">:config</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">defun</span> <span style="color: #fdfdd5;">unpackaged/package-menu-upgrade-package</span> <span style="color: #6688aa;">()</span>
    <span style="color: #52534d; font-weight: bold; font-style: italic;">"Mark current package for upgrading (i.e. also mark obsolete version for deletion.)"</span>
    <span style="color: #6688aa;">(</span><span style="color: #86aed5;">interactive</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #86aed5;">when-let</span> <span style="color: #858253;">(</span><span style="color: #8686ae;">(</span><span style="color: #83cc83cc83cc;">upgrades</span> <span style="color: #858253;">(</span><span style="color: #78cc78cc78cc; text-decoration: underline;">package</span><span style="text-decoration: underline;">-</span><span style="color: #afaa9b418aed; text-decoration: underline;">menu</span><span style="text-decoration: underline;">--</span><span style="color: #a36673883b99; text-decoration: underline;">find</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">upgrades</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span>
               <span style="color: #8686ae;">(</span><span style="color: #78cc78cc78cc;">description</span> <span style="color: #858253;">(</span><span style="color: #78cc78cc78cc; text-decoration: underline;">tabulated</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">list</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">get</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">id</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span>
               <span style="color: #8686ae;">(</span><span style="color: #7ccc7ccc7ccc;">name</span> <span style="color: #858253;">(</span><span style="color: #78cc78cc78cc; text-decoration: underline;">package</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">desc</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">name</span> <span style="color: #78cc78cc78cc;">description</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span>
               <span style="color: #8686ae;">(</span><span style="color: #b0668cf47099;">upgradable</span> <span style="color: #858253;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">cdr</span> <span style="color: #dd8844;">(</span><span style="color: #83cc83cc83cc; text-decoration: underline;">assq</span> <span style="color: #7ccc7ccc7ccc;">name</span> <span style="color: #83cc83cc83cc;">upgrades</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
      <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Package is upgradable</span>
      <span style="color: #858253;">(</span><span style="color: #86aed5;">save-excursion</span>
        <span style="color: #8686ae;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">char</span> <span style="color: #858253;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">min</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span>
        <span style="color: #8686ae;">(</span><span style="color: #86aed5;">while</span> <span style="color: #858253;">(</span><span style="color: #cb4b16; font-weight: bold;">not</span> <span style="color: #dd8844;">(</span><span style="color: #a36673883b99; text-decoration: underline;">eobp</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span>
          <span style="color: #858253;">(</span><span style="color: #86aed5;">let*</span> <span style="color: #dd8844;">(</span><span style="color: #a2b6da;">(</span><span style="color: #909990999099;">current</span>-<span style="color: #78cc78cc78cc;">description</span> <span style="color: #9cb6ad;">(</span><span style="color: #78cc78cc78cc; text-decoration: underline;">tabulated</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">list</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">get</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">id</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span>
                 <span style="color: #a2b6da;">(</span><span style="color: #909990999099;">current</span>-<span style="color: #7ccc7ccc7ccc;">name</span> <span style="color: #9cb6ad;">(</span><span style="color: #78cc78cc78cc; text-decoration: underline;">package</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">desc</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">name</span> <span style="color: #909990999099;">current</span>-<span style="color: #78cc78cc78cc;">description</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span>
            <span style="color: #dd8844;">(</span><span style="color: #86aed5;">when</span> <span style="color: #a2b6da;">(</span><span style="color: #b0668cf47099; text-decoration: underline;">equal</span> <span style="color: #909990999099;">current</span>-<span style="color: #7ccc7ccc7ccc;">name</span> <span style="color: #7ccc7ccc7ccc;">name</span><span style="color: #a2b6da;">)</span>
              <span style="color: #a2b6da;">(</span><span style="color: #86aed5;">cond</span> <span style="color: #9cb6ad;">(</span><span style="color: #9aaccb;">(</span><span style="color: #b0668cf47099; text-decoration: underline;">equal</span> <span style="color: #78cc78cc78cc;">description</span> <span style="color: #909990999099;">current</span>-<span style="color: #78cc78cc78cc;">description</span><span style="color: #9aaccb;">)</span>
                     <span style="color: #9aaccb;">(</span><span style="color: #78cc78cc78cc; text-decoration: underline;">package</span><span style="text-decoration: underline;">-</span><span style="color: #afaa9b418aed; text-decoration: underline;">menu</span><span style="text-decoration: underline;">-</span><span style="color: #700070007000; text-decoration: underline;">mark</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">install</span><span style="color: #9aaccb;">)</span>
                     <span style="color: #9aaccb;">(</span><span style="color: #b0668cf47099; text-decoration: underline;">forward</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">line</span> -<span style="color: #ba4cba4cba4c;">1</span><span style="color: #9aaccb;">)</span><span style="color: #9cb6ad;">)</span>
                    <span style="color: #9cb6ad;">(</span><span style="color: #9a009a009a00;">t</span> <span style="color: #9aaccb;">(</span><span style="color: #78cc78cc78cc; text-decoration: underline;">package</span><span style="text-decoration: underline;">-</span><span style="color: #afaa9b418aed; text-decoration: underline;">menu</span><span style="text-decoration: underline;">-</span><span style="color: #700070007000; text-decoration: underline;">mark</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">delete</span><span style="color: #9aaccb;">)</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span>
          <span style="color: #858253;">(</span><span style="color: #b0668cf47099; text-decoration: underline;">forward</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">line</span> <span style="color: #ba4cba4cba4c;">1</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga38630c" class="outline-2">
<h2 id="orga38630c">Programming&#xa0;&#xa0;&#xa0;<span class="tag"><span class="programming">programming</span></span></h2>
<div class="outline-text-2" id="text-orga38630c">
</div><div id="outline-container-orgfbcf0e1" class="outline-3">
<h3 id="orgfbcf0e1">Flexibly fill/unfill paragraphs</h3>
<div class="outline-text-3" id="text-orgfbcf0e1">
<p>
Fill paragraph, incrementing fill column each time this command is repeated.  When the command is called for the first time in a sequence, unfill to the default <code>fill-column</code>.  With prefix, unfill completely.  This command does not modify the stored value of <code>fill-column</code>.
</p>

<p>

</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #9aaccb;">(</span><span style="color: #86aed5;">defvar</span> <span style="color: #fdfdd5;">unpackaged/flex-fill-paragraph-column</span> <span style="color: #a6cca6cca6cc;">nil</span>
  <span style="color: #52534d; font-weight: bold; font-style: italic;">"Last fill column used in command `</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">unpackaged/flex-fill-paragraph</span><span style="color: #52534d; font-weight: bold; font-style: italic;">'."</span><span style="color: #9aaccb;">)</span>

<span style="color: #9aaccb;">(</span><span style="color: #86aed5;">defun</span> <span style="color: #fdfdd5;">unpackaged/flex-fill-paragraph</span> <span style="color: #5b8583;">(</span><span style="color: #8686ae;">&amp;optional</span> <span style="color: #9a009a009a00;">unfill</span><span style="color: #5b8583;">)</span>
  <span style="color: #52534d; font-weight: bold; font-style: italic;">"Fill paragraph, incrementing fill column each time this command is repeated.</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">When the command is called for the first time in a sequence,</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">unfill to the default `</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">fill-column</span><span style="color: #52534d; font-weight: bold; font-style: italic;">'.  With prefix, unfill</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">completely.  This command does not modify the stored value of</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">`</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">fill-column</span><span style="color: #52534d; font-weight: bold; font-style: italic;">'."</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">interactive</span> <span style="color: #858253;">"P"</span><span style="color: #5b8583;">)</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">let</span> <span style="color: #6688aa;">(</span><span style="color: #858253;">(</span><span style="color: #700070007000;">fill</span>-<span style="color: #9a009a009a00;">column</span>
         <span style="color: #8686ae;">(</span><span style="color: #86aed5;">cond</span> <span style="color: #858253;">(</span><span style="color: #9a009a009a00;">unfill</span> <span style="color: #dd8844;">(</span><span style="color: #86aed5;">setf</span> <span style="color: #909990999099;">unpackaged</span>/<span style="color: #700070007000;">flex</span>-<span style="color: #700070007000;">fill</span>-<span style="color: #afaa9b418aed;">paragraph</span>-<span style="color: #9a009a009a00;">column</span> <span style="color: #a6cca6cca6cc;">nil</span><span style="color: #dd8844;">)</span>
                       <span style="color: #83cc83cc83cc;">most</span>-<span style="color: #83cc83cc83cc;">positive</span>-<span style="color: #909990999099;">fixnum</span><span style="color: #858253;">)</span>
               <span style="color: #858253;">(</span><span style="color: #9a009a009a00;">t</span> <span style="color: #dd8844;">(</span><span style="color: #86aed5;">setf</span> <span style="color: #909990999099;">unpackaged</span>/<span style="color: #700070007000;">flex</span>-<span style="color: #700070007000;">fill</span>-<span style="color: #afaa9b418aed;">paragraph</span>-<span style="color: #9a009a009a00;">column</span>
                        <span style="color: #a2b6da;">(</span><span style="color: #86aed5;">if</span> <span style="color: #9cb6ad;">(</span><span style="color: #b0668cf47099; text-decoration: underline;">equal</span> <span style="color: #a6cca6cca6cc;">last</span>-<span style="color: #a6cca6cca6cc;">command</span> <span style="color: #a6cca6cca6cc;">this</span>-<span style="color: #a6cca6cca6cc;">command</span><span style="color: #9cb6ad;">)</span>
                            <span style="color: #9cb6ad;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">1</span><span style="text-decoration: underline;">+</span> <span style="color: #9aaccb;">(</span><span style="color: #86aed5;">or</span> <span style="color: #909990999099;">unpackaged</span>/<span style="color: #700070007000;">flex</span>-<span style="color: #700070007000;">fill</span>-<span style="color: #afaa9b418aed;">paragraph</span>-<span style="color: #9a009a009a00;">column</span>
                                    <span style="color: #700070007000;">fill</span>-<span style="color: #9a009a009a00;">column</span><span style="color: #9aaccb;">)</span><span style="color: #9cb6ad;">)</span>
                          <span style="color: #700070007000;">fill</span>-<span style="color: #9a009a009a00;">column</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #700070007000; text-decoration: underline;">fill</span><span style="text-decoration: underline;">-</span><span style="color: #afaa9b418aed; text-decoration: underline;">paragraph</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">message</span> <span style="color: #858253;">"Fill column: %s"</span> <span style="color: #700070007000;">fill</span>-<span style="color: #9a009a009a00;">column</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3602adb" class="outline-3">
<h3 id="org3602adb"><code>iedit</code>&#xa0;&#xa0;&#xa0;<span class="tag"><span class="iedit">iedit</span>&#xa0;<span class="refactoring">refactoring</span></span></h3>
<div class="outline-text-3" id="text-org3602adb">
<p>
These commands make <code>iedit-mode</code> a bit easier to use.
</p>
</div>

<div id="outline-container-org2aac221" class="outline-4">
<h4 id="org2aac221"><code>iedit-scoped</code></h4>
<div class="outline-text-4" id="text-org2aac221">
<p>
Call <code>iedit-mode</code> with function-local scope, or global scope if called with a universal prefix.
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #9aaccb;">(</span><span style="color: #86aed5;">defun</span> <span style="color: #fdfdd5;">unpackaged/iedit-scoped</span> <span style="color: #5b8583;">(</span><span style="color: #7ccc7ccc7ccc;">orig</span>-<span style="color: #a6ffad95b400;">fn</span><span style="color: #5b8583;">)</span>
  <span style="color: #52534d; font-weight: bold; font-style: italic;">"Call `</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">iedit-mode</span><span style="color: #52534d; font-weight: bold; font-style: italic;">' with function-local scope, or global scope if called with a universal prefix."</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">interactive</span><span style="color: #5b8583;">)</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">pcase-exhaustive</span> <span style="color: #909990999099;">current</span>-<span style="color: #a6cca6cca6cc;">prefix</span>-<span style="color: #7ccc7ccc7ccc;">arg</span>
    <span style="color: #6688aa;">(</span><span style="color: #5b8583;">'</span><span style="color: #a6cca6cca6cc;">nil</span> <span style="color: #858253;">(</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">funcall</span> <span style="color: #7ccc7ccc7ccc;">orig</span>-<span style="color: #a6ffad95b400;">fn</span> <span style="color: #5b8583;">'</span><span style="color: #8686ae;">(</span><span style="color: #7ccc7ccc7ccc;">0</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #5b8583;">'</span><span style="color: #858253;">(</span><span style="color: #78cc78cc78cc;">4</span><span style="color: #858253;">)</span> <span style="color: #858253;">(</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">funcall</span> <span style="color: #7ccc7ccc7ccc;">orig</span>-<span style="color: #a6ffad95b400;">fn</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span>

<span style="color: #9aaccb;">(</span><span style="color: #6c006c006c00; text-decoration: underline;">advice</span><span style="text-decoration: underline;">-</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">add</span> <span style="color: #5b8583;">#'</span><span style="color: #9a009a009a00;">iedit</span>-<span style="color: #7ccc7ccc7ccc;">mode</span> <span style="color: #86aed5;">:around</span> <span style="color: #5b8583;">#'</span><span style="color: #909990999099;">unpackaged</span>/<span style="color: #9a009a009a00;">iedit</span>-<span style="color: #6c006c006c00;">scoped</span><span style="color: #9aaccb;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbd7ee18" class="outline-4">
<h4 id="orgbd7ee18"><code>iedit-or-flyspell</code>&#xa0;&#xa0;&#xa0;<span class="tag"><span class="flyspell">flyspell</span>&#xa0;<span class="spell_checking">spell_checking</span></span></h4>
<div class="outline-text-4" id="text-orgbd7ee18">
<p>
Toggle <code>iedit-mode</code> or correct previous misspelling with <code>flyspell</code>, depending on context.
</p>

<p>
With point in code or when <code>iedit-mode</code> is already active, toggle <code>iedit-mode</code>.  With point in a comment or string, and when <code>iedit-mode</code> is not already active, auto-correct previous misspelled word with <code>flyspell</code>.  Call this command a second time to choose a different correction.
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #9aaccb;">(</span><span style="color: #86aed5;">defun</span> <span style="color: #fdfdd5;">unpackaged/iedit-or-flyspell</span> <span style="color: #5b8583;">()</span>
  <span style="color: #52534d; font-weight: bold; font-style: italic;">"Toggle `</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">iedit-mode</span><span style="color: #52534d; font-weight: bold; font-style: italic;">' or correct previous misspelling with `</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">flyspell</span><span style="color: #52534d; font-weight: bold; font-style: italic;">', depending on context.</span>

<span style="color: #52534d; font-weight: bold; font-style: italic;">With point in code or when `</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">iedit-mode</span><span style="color: #52534d; font-weight: bold; font-style: italic;">' is already active, toggle</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">`</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">iedit-mode</span><span style="color: #52534d; font-weight: bold; font-style: italic;">'.  With point in a comment or string, and when</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">`</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">iedit-mode</span><span style="color: #52534d; font-weight: bold; font-style: italic;">' is not already active, auto-correct previous</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">misspelled word with `</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">flyspell</span><span style="color: #52534d; font-weight: bold; font-style: italic;">'.  Call this command a second time</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">to choose a different correction."</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">interactive</span><span style="color: #5b8583;">)</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">if</span> <span style="color: #6688aa;">(</span><span style="color: #86aed5;">or</span> <span style="color: #9a009a009a00;">iedit</span>-<span style="color: #7ccc7ccc7ccc;">mode</span>
          <span style="color: #858253;">(</span><span style="color: #86aed5;">and</span> <span style="color: #8686ae;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">derived</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">mode</span><span style="text-decoration: underline;">-</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">p</span> <span style="color: #5b8583;">'</span><span style="color: #9a009a009a00;">prog</span>-<span style="color: #7ccc7ccc7ccc;">mode</span><span style="color: #8686ae;">)</span>
               <span style="color: #8686ae;">(</span><span style="color: #cb4b16; font-weight: bold;">not</span> <span style="color: #858253;">(</span><span style="color: #86aed5;">or</span> <span style="color: #dd8844;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">nth</span> <span style="color: #78cc78cc78cc;">4</span> <span style="color: #a2b6da;">(</span><span style="color: #6c006c006c00; text-decoration: underline;">syntax</span><span style="text-decoration: underline;">-</span><span style="color: #a6ffad95b400; text-decoration: underline;">ppss</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span>
                        <span style="color: #dd8844;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">nth</span> <span style="color: #ba4cba4cba4c;">3</span> <span style="color: #a2b6da;">(</span><span style="color: #6c006c006c00; text-decoration: underline;">syntax</span><span style="text-decoration: underline;">-</span><span style="color: #a6ffad95b400; text-decoration: underline;">ppss</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span>
      <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">prog-mode is active and point is in a comment, string, or</span>
      <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">already in iedit-mode</span>
      <span style="color: #6688aa;">(</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">call</span><span style="text-decoration: underline;">-</span><span style="color: #afaa9b418aed; text-decoration: underline;">interactively</span> <span style="color: #5b8583;">#'</span><span style="color: #9a009a009a00;">iedit</span>-<span style="color: #7ccc7ccc7ccc;">mode</span><span style="color: #6688aa;">)</span>
    <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Not prog-mode or not in comment or string</span>
    <span style="color: #6688aa;">(</span><span style="color: #86aed5;">if</span> <span style="color: #858253;">(</span><span style="color: #cb4b16; font-weight: bold;">not</span> <span style="color: #8686ae;">(</span><span style="color: #b0668cf47099; text-decoration: underline;">equal</span> <span style="color: #ba4cba4cba4c;">flyspell</span>-<span style="color: #83cc83cc83cc;">previous</span>-<span style="color: #a6cca6cca6cc;">command</span> <span style="color: #a6cca6cca6cc;">this</span>-<span style="color: #a6cca6cca6cc;">command</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
        <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #cb4b16;">FIXME</span><span style="color: #586e75; font-weight: bold; font-style: italic;">: This mostly works, but if there are two words on the</span>
        <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">same line that are misspelled, it doesn't work quite right</span>
        <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">when correcting the earlier word after correcting the later</span>
        <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">one</span>

        <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">First correction; autocorrect</span>
        <span style="color: #858253;">(</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">call</span><span style="text-decoration: underline;">-</span><span style="color: #afaa9b418aed; text-decoration: underline;">interactively</span> <span style="color: #5b8583;">'</span><span style="color: #ba4cba4cba4c;">flyspell</span>-<span style="color: #afaa9b418aed;">auto</span>-<span style="color: #9a009a009a00;">correct</span>-<span style="color: #83cc83cc83cc;">previous</span>-<span style="color: #a6ffad95b400;">word</span><span style="color: #858253;">)</span>
      <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">First correction was not wanted; use popup to choose</span>
      <span style="color: #858253;">(</span><span style="color: #86aed5;">progn</span>
        <span style="color: #8686ae;">(</span><span style="color: #86aed5;">save-excursion</span>
          <span style="color: #858253;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">undo</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span>                       <span style="color: #586e75; font-weight: bold; font-style: italic;">; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">This doesn't move point, which I think may be the problem.</span>
        <span style="color: #8686ae;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">flyspell</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">region</span> <span style="color: #858253;">(</span><span style="color: #83cc83cc83cc; text-decoration: underline;">line</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">beginning</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">position</span><span style="color: #858253;">)</span> <span style="color: #858253;">(</span><span style="color: #83cc83cc83cc; text-decoration: underline;">line</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">end</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">position</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span>
        <span style="color: #8686ae;">(</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">call</span><span style="text-decoration: underline;">-</span><span style="color: #afaa9b418aed; text-decoration: underline;">interactively</span> <span style="color: #5b8583;">'</span><span style="color: #ba4cba4cba4c;">flyspell</span>-<span style="color: #9a009a009a00;">correct</span>-<span style="color: #83cc83cc83cc;">previous</span>-<span style="color: #a6ffad95b400;">word</span>-<span style="color: #a9ba7fd34edf;">generic</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgac2ff5c" class="outline-3">
<h3 id="orgac2ff5c">Sort sexps</h3>
<div class="outline-text-3" id="text-orgac2ff5c">
<p>
Sort sexps in region.  Comments stay with the code below.
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #9aaccb;">(</span><span style="color: #86aed5;">defun</span> <span style="color: #fdfdd5;">unpackaged/sort-sexps</span> <span style="color: #5b8583;">(</span><span style="color: #a36673883b99;">beg</span> <span style="color: #909990999099;">end</span><span style="color: #5b8583;">)</span>
  <span style="color: #52534d; font-weight: bold; font-style: italic;">"Sort sexps in region.</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">Comments stay with the code below."</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">interactive</span> <span style="color: #858253;">"r"</span><span style="color: #5b8583;">)</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">cl-flet</span> <span style="color: #6688aa;">(</span><span style="color: #858253;">(</span><span style="color: #a6cca6cca6cc;">skip</span>-<span style="color: #6c006c006c00;">whitespace</span> <span style="color: #8686ae;">()</span> <span style="color: #8686ae;">(</span><span style="color: #86aed5;">while</span> <span style="color: #858253;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">looking</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">at</span> <span style="color: #dd8844;">(</span><span style="color: #86aed5;">rx</span> <span style="color: #a2b6da;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">1</span><span style="text-decoration: underline;">+</span> <span style="color: #9cb6ad;">(</span><span style="color: #86aed5;">or</span> <span style="color: #6c006c006c00;">space</span> <span style="color: #858253;">"\n"</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span>
                                  <span style="color: #858253;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">char</span> <span style="color: #dd8844;">(</span><span style="color: #78cc78cc78cc; text-decoration: underline;">match</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">end</span> <span style="color: #7ccc7ccc7ccc;">0</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
            <span style="color: #858253;">(</span><span style="color: #a6cca6cca6cc;">skip</span>-<span style="color: #b0668cf47099;">both</span> <span style="color: #8686ae;">()</span> <span style="color: #8686ae;">(</span><span style="color: #86aed5;">while</span> <span style="color: #858253;">(</span><span style="color: #86aed5;">cond</span> <span style="color: #dd8844;">(</span><span style="color: #a2b6da;">(</span><span style="color: #86aed5;">or</span> <span style="color: #9cb6ad;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">nth</span> <span style="color: #78cc78cc78cc;">4</span> <span style="color: #9aaccb;">(</span><span style="color: #6c006c006c00; text-decoration: underline;">syntax</span><span style="text-decoration: underline;">-</span><span style="color: #a6ffad95b400; text-decoration: underline;">ppss</span><span style="color: #9aaccb;">)</span><span style="color: #9cb6ad;">)</span>
                                            <span style="color: #9cb6ad;">(</span><span style="color: #86aed5;">ignore-errors</span>
                                              <span style="color: #9aaccb;">(</span><span style="color: #86aed5;">save-excursion</span>
                                                <span style="color: #5b8583;">(</span><span style="color: #b0668cf47099; text-decoration: underline;">forward</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">char</span> <span style="color: #ba4cba4cba4c;">1</span><span style="color: #5b8583;">)</span>
                                                <span style="color: #5b8583;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">nth</span> <span style="color: #78cc78cc78cc;">4</span> <span style="color: #6688aa;">(</span><span style="color: #6c006c006c00; text-decoration: underline;">syntax</span><span style="text-decoration: underline;">-</span><span style="color: #a6ffad95b400; text-decoration: underline;">ppss</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span>
                                        <span style="color: #a2b6da;">(</span><span style="color: #b0668cf47099; text-decoration: underline;">forward</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">line</span> <span style="color: #ba4cba4cba4c;">1</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span>
                                       <span style="color: #dd8844;">(</span><span style="color: #a2b6da;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">looking</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">at</span> <span style="color: #9cb6ad;">(</span><span style="color: #86aed5;">rx</span> <span style="color: #9aaccb;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">1</span><span style="text-decoration: underline;">+</span> <span style="color: #5b8583;">(</span><span style="color: #86aed5;">or</span> <span style="color: #6c006c006c00;">space</span> <span style="color: #858253;">"\n"</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span>
                                        <span style="color: #a2b6da;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">char</span> <span style="color: #9cb6ad;">(</span><span style="color: #78cc78cc78cc; text-decoration: underline;">match</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">end</span> <span style="color: #7ccc7ccc7ccc;">0</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #86aed5;">save-excursion</span>
      <span style="color: #858253;">(</span><span style="color: #86aed5;">save-restriction</span>
        <span style="color: #8686ae;">(</span><span style="color: #a36673883b99; text-decoration: underline;">narrow</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">to</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">region</span> <span style="color: #a36673883b99;">beg</span> <span style="color: #909990999099;">end</span><span style="color: #8686ae;">)</span>
        <span style="color: #8686ae;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">char</span> <span style="color: #a36673883b99;">beg</span><span style="color: #8686ae;">)</span>
        <span style="color: #8686ae;">(</span><span style="color: #a6cca6cca6cc;">skip</span>-<span style="color: #b0668cf47099;">both</span><span style="color: #8686ae;">)</span>
        <span style="color: #8686ae;">(</span><span style="color: #86aed5;">cl-destructuring-bind</span> <span style="color: #858253;">(</span><span style="color: #a6cca6cca6cc;">sexps</span> <span style="color: #909990999099;">markers</span><span style="color: #858253;">)</span>
            <span style="color: #858253;">(</span><span style="color: #86aed5;">cl-loop</span> <span style="color: #78cc78cc78cc;">do</span> <span style="color: #dd8844;">(</span><span style="color: #a6cca6cca6cc;">skip</span>-<span style="color: #6c006c006c00;">whitespace</span><span style="color: #dd8844;">)</span>
                     <span style="color: #ba4cba4cba4c;">for</span> <span style="color: #a6cca6cca6cc;">start</span> = <span style="color: #dd8844;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #78cc78cc78cc; text-decoration: underline;">marker</span><span style="color: #dd8844;">)</span>
                     <span style="color: #ba4cba4cba4c;">for</span> <span style="color: #9a009a009a00;">sexp</span> = <span style="color: #dd8844;">(</span><span style="color: #86aed5;">ignore-errors</span>
                                  <span style="color: #a2b6da;">(</span><span style="color: #909990999099; text-decoration: underline;">read</span> <span style="color: #9cb6ad;">(</span><span style="color: #909990999099; text-decoration: underline;">current</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">buffer</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span>
                     <span style="color: #ba4cba4cba4c;">for</span> <span style="color: #909990999099;">end</span> = <span style="color: #dd8844;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #78cc78cc78cc; text-decoration: underline;">marker</span><span style="color: #dd8844;">)</span>
                     <span style="color: #b0668cf47099;">while</span> <span style="color: #9a009a009a00;">sexp</span>
                     <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Collect the real string, then one used for sorting.</span>
                     <span style="color: #a6cca6cca6cc;">collect</span> <span style="color: #dd8844;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">cons</span> <span style="color: #a2b6da;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">buffer</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">substring</span> <span style="color: #9cb6ad;">(</span><span style="color: #78cc78cc78cc; text-decoration: underline;">marker</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">position</span> <span style="color: #a6cca6cca6cc;">start</span><span style="color: #9cb6ad;">)</span> <span style="color: #9cb6ad;">(</span><span style="color: #78cc78cc78cc; text-decoration: underline;">marker</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">position</span> <span style="color: #909990999099;">end</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span>
                                   <span style="color: #a2b6da;">(</span><span style="color: #86aed5;">save-excursion</span>
                                     <span style="color: #9cb6ad;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">char</span> <span style="color: #9aaccb;">(</span><span style="color: #78cc78cc78cc; text-decoration: underline;">marker</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">position</span> <span style="color: #a6cca6cca6cc;">start</span><span style="color: #9aaccb;">)</span><span style="color: #9cb6ad;">)</span>
                                     <span style="color: #9cb6ad;">(</span><span style="color: #a6cca6cca6cc;">skip</span>-<span style="color: #b0668cf47099;">both</span><span style="color: #9cb6ad;">)</span>
                                     <span style="color: #9cb6ad;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">buffer</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">substring</span> <span style="color: #9aaccb;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">point</span><span style="color: #9aaccb;">)</span> <span style="color: #9aaccb;">(</span><span style="color: #78cc78cc78cc; text-decoration: underline;">marker</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">position</span> <span style="color: #909990999099;">end</span><span style="color: #9aaccb;">)</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span>
                     <span style="color: #909990999099;">into</span> <span style="color: #a6cca6cca6cc;">sexps</span>
                     <span style="color: #a6cca6cca6cc;">collect</span> <span style="color: #dd8844;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">cons</span> <span style="color: #a6cca6cca6cc;">start</span> <span style="color: #909990999099;">end</span><span style="color: #dd8844;">)</span>
                     <span style="color: #909990999099;">into</span> <span style="color: #909990999099;">markers</span>
                     <span style="color: #700070007000;">finally</span> <span style="color: #a36673883b99;">return</span> <span style="color: #dd8844;">(</span><span style="color: #83cc83cc83cc; text-decoration: underline;">list</span> <span style="color: #a6cca6cca6cc;">sexps</span> <span style="color: #909990999099;">markers</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span>
          <span style="color: #858253;">(</span><span style="color: #86aed5;">setq</span> <span style="color: #a6cca6cca6cc;">sexps</span> <span style="color: #dd8844;">(</span><span style="color: #6c006c006c00; text-decoration: underline;">sort</span> <span style="color: #a6cca6cca6cc;">sexps</span> <span style="color: #a2b6da;">(</span><span style="color: #86aed5;">lambda</span> <span style="color: #9cb6ad;">(</span><span style="color: #afaa9b418aed;">a</span> <span style="color: #afaa9b418aed;">b</span><span style="color: #9cb6ad;">)</span>
                                    <span style="color: #9cb6ad;">(</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">string</span><span style="text-decoration: underline;">&lt;</span> <span style="color: #9aaccb;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">cdr</span> <span style="color: #afaa9b418aed;">a</span><span style="color: #9aaccb;">)</span> <span style="color: #9aaccb;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">cdr</span> <span style="color: #afaa9b418aed;">b</span><span style="color: #9aaccb;">)</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span>
          <span style="color: #858253;">(</span><span style="color: #86aed5;">cl-loop</span> <span style="color: #ba4cba4cba4c;">for</span> <span style="color: #dd8844;">(</span><span style="color: #b0668cf47099;">real</span> . <span style="color: #6c006c006c00;">sort</span><span style="color: #dd8844;">)</span> <span style="color: #909990999099;">in</span> <span style="color: #a6cca6cca6cc;">sexps</span>
                   <span style="color: #ba4cba4cba4c;">for</span> <span style="color: #dd8844;">(</span><span style="color: #a6cca6cca6cc;">start</span> . <span style="color: #909990999099;">end</span><span style="color: #dd8844;">)</span> <span style="color: #909990999099;">in</span> <span style="color: #909990999099;">markers</span>
                   <span style="color: #78cc78cc78cc;">do</span> <span style="color: #dd8844;">(</span><span style="color: #86aed5;">progn</span>
                        <span style="color: #a2b6da;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">char</span> <span style="color: #9cb6ad;">(</span><span style="color: #78cc78cc78cc; text-decoration: underline;">marker</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">position</span> <span style="color: #a6cca6cca6cc;">start</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span>
                        <span style="color: #a2b6da;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">insert</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">before</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">markers</span> <span style="color: #b0668cf47099;">real</span><span style="color: #a2b6da;">)</span>
                        <span style="color: #a2b6da;">(</span><span style="color: #83cc83cc83cc; text-decoration: underline;">delete</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">region</span> <span style="color: #9cb6ad;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">point</span><span style="color: #9cb6ad;">)</span> <span style="color: #9cb6ad;">(</span><span style="color: #78cc78cc78cc; text-decoration: underline;">marker</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">position</span> <span style="color: #909990999099;">end</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org57a1311" class="outline-2">
<h2 id="org57a1311">Regular expressions&#xa0;&#xa0;&#xa0;<span class="tag"><span class="regular_expressions">regular_expressions</span></span></h2>
<div class="outline-text-2" id="text-org57a1311">
</div><div id="outline-container-org8f60cdc" class="outline-3">
<h3 id="org8f60cdc">query-replace-rx</h3>
<div class="outline-text-3" id="text-org8f60cdc">
<p>
Call <code>query-replace-regexp</code>, reading regexp in <code>rx</code> syntax.  Automatically wraps in parens and adds <code>seq</code> to the beginning of the form.
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #9aaccb;">(</span><span style="color: #86aed5;">defun</span> <span style="color: #fdfdd5;">unpackaged/query-replace-rx</span> <span style="color: #5b8583;">(</span><span style="color: #8686ae;">&amp;rest</span> _<span style="color: #5b8583;">)</span>
  <span style="color: #52534d; font-weight: bold; font-style: italic;">"Call `</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">query-replace-regexp</span><span style="color: #52534d; font-weight: bold; font-style: italic;">', reading regexp in `</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">rx</span><span style="color: #52534d; font-weight: bold; font-style: italic;">' syntax.</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">Automatically wraps in parens and adds `</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">seq</span><span style="color: #52534d; font-weight: bold; font-style: italic;">' to the beginning of</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">the form."</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">interactive</span><span style="color: #5b8583;">)</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">cl-letf</span> <span style="color: #6688aa;">(</span><span style="color: #858253;">(</span><span style="color: #8686ae;">(</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">symbol</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">function</span> <span style="color: #5b8583;">#'</span><span style="color: #6c006c006c00;">query</span>-<span style="color: #a6cca6cca6cc;">replace</span>-<span style="color: #909990999099;">read</span>-<span style="color: #a6cca6cca6cc;">from</span><span style="color: #8686ae;">)</span> <span style="color: #8686ae;">(</span><span style="color: #86aed5;">lambda</span> <span style="color: #858253;">(</span><span style="color: #8686ae;">&amp;rest</span> _<span style="color: #858253;">)</span>
                                                           <span style="color: #858253;">(</span><span style="color: #86aed5;">--&gt;</span> <span style="color: #dd8844;">(</span><span style="color: #909990999099; text-decoration: underline;">read</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">string</span> <span style="color: #858253;">"rx form: "</span><span style="color: #dd8844;">)</span>
                                                                <span style="color: #dd8844;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">concat</span> <span style="color: #858253;">"'(seq "</span> <span style="color: #fdfdd5;">it</span> <span style="color: #858253;">")"</span><span style="color: #dd8844;">)</span>
                                                                <span style="color: #dd8844;">(</span><span style="color: #909990999099; text-decoration: underline;">read</span> <span style="color: #fdfdd5;">it</span><span style="color: #dd8844;">)</span>
                                                                <span style="color: #dd8844;">(</span><span style="color: #6c006c006c00; text-decoration: underline;">cadr</span> <span style="color: #fdfdd5;">it</span><span style="color: #dd8844;">)</span>
                                                                <span style="color: #dd8844;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">rx</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">to</span><span style="text-decoration: underline;">-</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">string</span> <span style="color: #fdfdd5;">it</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">call</span><span style="text-decoration: underline;">-</span><span style="color: #afaa9b418aed; text-decoration: underline;">interactively</span> <span style="color: #5b8583;">#'</span><span style="color: #6c006c006c00;">query</span>-<span style="color: #a6cca6cca6cc;">replace</span>-<span style="color: #700070007000;">regexp</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org31c4239" class="outline-2">
<h2 id="org31c4239">Version control&#xa0;&#xa0;&#xa0;<span class="tag"><span class="version_control">version_control</span></span></h2>
<div class="outline-text-2" id="text-org31c4239">
</div><div id="outline-container-org64ad416" class="outline-3">
<h3 id="org64ad416">Magit&#xa0;&#xa0;&#xa0;<span class="tag"><span class="Magit">Magit</span></span></h3>
<div class="outline-text-3" id="text-org64ad416">
</div><div id="outline-container-org3d9ea45" class="outline-4">
<h4 id="org3d9ea45">Improved <code>magit-status</code> command</h4>
<div class="outline-text-4" id="text-org3d9ea45">
<p>
Open a <code>magit-status</code> buffer and close the other window so only Magit is visible.  If a file was visited in the buffer that was active when this command was called, go to its unstaged changes section.
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #9aaccb;">(</span><span style="color: #86aed5;">defun</span> <span style="color: #fdfdd5;">unpackaged/magit-status</span> <span style="color: #5b8583;">()</span>
  <span style="color: #52534d; font-weight: bold; font-style: italic;">"Open a `</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">magit-status</span><span style="color: #52534d; font-weight: bold; font-style: italic;">' buffer and close the other window so only Magit is visible.</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">If a file was visited in the buffer that was active when this</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">command was called, go to its unstaged changes section."</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">interactive</span><span style="color: #5b8583;">)</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">let*</span> <span style="color: #6688aa;">(</span><span style="color: #858253;">(</span><span style="color: #9a009a009a00;">buffer</span>-<span style="color: #6c006c006c00;">file</span>-<span style="color: #700070007000;">path</span> <span style="color: #8686ae;">(</span><span style="color: #86aed5;">when</span> <span style="color: #9a009a009a00;">buffer</span>-<span style="color: #6c006c006c00;">file</span>-<span style="color: #7ccc7ccc7ccc;">name</span>
                             <span style="color: #858253;">(</span><span style="color: #6c006c006c00; text-decoration: underline;">file</span><span style="text-decoration: underline;">-</span><span style="color: #a6ffad95b400; text-decoration: underline;">relative</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">name</span> <span style="color: #9a009a009a00;">buffer</span>-<span style="color: #6c006c006c00;">file</span>-<span style="color: #7ccc7ccc7ccc;">name</span>
                                                 <span style="color: #dd8844;">(</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">locate</span><span style="text-decoration: underline;">-</span><span style="color: #a6ffad95b400; text-decoration: underline;">dominating</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">file</span> <span style="color: #9a009a009a00;">buffer</span>-<span style="color: #6c006c006c00;">file</span>-<span style="color: #7ccc7ccc7ccc;">name</span> <span style="color: #858253;">".git"</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
         <span style="color: #858253;">(</span><span style="color: #6c006c006c00;">section</span>-<span style="color: #909990999099;">ident</span> <span style="color: #5b8583;">`</span><span style="color: #8686ae;">(</span><span style="color: #858253;">(</span><span style="color: #6c006c006c00;">file</span> . ,<span style="color: #9a009a009a00;">buffer</span>-<span style="color: #6c006c006c00;">file</span>-<span style="color: #700070007000;">path</span><span style="color: #858253;">)</span> <span style="color: #858253;">(</span><span style="color: #78cc78cc78cc;">unstaged</span><span style="color: #858253;">)</span> <span style="color: #858253;">(</span><span style="color: #ba4cba4cba4c;">status</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #a36673883b99; text-decoration: underline;">magit</span><span style="text-decoration: underline;">-</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">status</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #83cc83cc83cc; text-decoration: underline;">delete</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">other</span><span style="text-decoration: underline;">-</span><span style="color: #700070007000; text-decoration: underline;">windows</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #86aed5;">when</span> <span style="color: #9a009a009a00;">buffer</span>-<span style="color: #6c006c006c00;">file</span>-<span style="color: #700070007000;">path</span>
      <span style="color: #858253;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">char</span> <span style="color: #8686ae;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">min</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
      <span style="color: #858253;">(</span><span style="color: #86aed5;">cl-loop</span> <span style="color: #83cc83cc83cc;">until</span> <span style="color: #8686ae;">(</span><span style="color: #86aed5;">when</span> <span style="color: #858253;">(</span><span style="color: #b0668cf47099; text-decoration: underline;">equal</span> <span style="color: #6c006c006c00;">section</span>-<span style="color: #909990999099;">ident</span> <span style="color: #dd8844;">(</span><span style="color: #a36673883b99; text-decoration: underline;">magit</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">section</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">ident</span> <span style="color: #a2b6da;">(</span><span style="color: #a36673883b99; text-decoration: underline;">magit</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">current</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">section</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span>
                       <span style="color: #858253;">(</span><span style="color: #a36673883b99; text-decoration: underline;">magit</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">section</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">show</span> <span style="color: #dd8844;">(</span><span style="color: #a36673883b99; text-decoration: underline;">magit</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">current</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">section</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span>
                       <span style="color: #858253;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">recenter</span><span style="color: #858253;">)</span>
                       <span style="color: #9a009a009a00;">t</span><span style="color: #8686ae;">)</span>
               <span style="color: #78cc78cc78cc;">do</span> <span style="color: #8686ae;">(</span><span style="color: #86aed5;">condition-case</span> <span style="color: #a6cca6cca6cc;">nil</span>
                      <span style="color: #858253;">(</span><span style="color: #a36673883b99; text-decoration: underline;">magit</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">section</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">forward</span><span style="color: #858253;">)</span>
                    <span style="color: #858253;">(</span><span style="color: #dd8844;">error</span> <span style="color: #dd8844;">(</span><span style="color: #83cc83cc83cc;">cl</span>-<span style="color: #a36673883b99;">return</span> <span style="color: #a2b6da;">(</span><span style="color: #a36673883b99; text-decoration: underline;">magit</span><span style="text-decoration: underline;">-</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">status</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #afaa9b418aed; text-decoration: underline;">initial</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">section</span><span style="text-decoration: underline;">-</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">1</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org181ac38" class="outline-4">
<h4 id="org181ac38">magit-log date headers</h4>
<div class="outline-text-4" id="text-org181ac38">
<p>
Add date headers to Magit log buffers.
</p>

<p>
<b>Requires:</b>
</p>
<ul class="org-ul">
<li><a href="https://github.com/ShingoFukuyama/ov.el">ov.el</a></li>
</ul>

<p>

</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #9aaccb;">(</span><span style="color: #86aed5;">defun</span> <span style="color: #fdfdd5;">unpackaged/magit-log--add-date-headers</span> <span style="color: #5b8583;">(</span><span style="color: #8686ae;">&amp;rest</span> _<span style="color: #a6cca6cca6cc;">ignore</span><span style="color: #5b8583;">)</span>
  <span style="color: #52534d; font-weight: bold; font-style: italic;">"Add date headers to Magit log buffers."</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">when</span> <span style="color: #6688aa;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">derived</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">mode</span><span style="text-decoration: underline;">-</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">p</span> <span style="color: #5b8583;">'</span><span style="color: #a36673883b99;">magit</span>-<span style="color: #a6cca6cca6cc;">log</span>-<span style="color: #7ccc7ccc7ccc;">mode</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #86aed5;">save-excursion</span>
      <span style="color: #858253;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">ov</span><span style="text-decoration: underline;">-</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">clear</span> <span style="color: #5b8583;">'</span><span style="color: #9a009a009a00;">date</span>-<span style="color: #a36673883b99;">header</span> <span style="color: #9a009a009a00;">t</span><span style="color: #858253;">)</span>
      <span style="color: #858253;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">goto</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">char</span> <span style="color: #8686ae;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">min</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
      <span style="color: #858253;">(</span><span style="color: #86aed5;">cl-loop</span> <span style="color: #a6cca6cca6cc;">with</span> <span style="color: #a6cca6cca6cc;">last</span>-<span style="color: #6c006c006c00;">age</span>
               <span style="color: #ba4cba4cba4c;">for</span> <span style="color: #a6cca6cca6cc;">this</span>-<span style="color: #6c006c006c00;">age</span> = <span style="color: #8686ae;">(</span><span style="color: #86aed5;">-some--&gt;</span> <span style="color: #858253;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">ov</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">in</span> <span style="color: #5b8583;">'</span><span style="color: #a6cca6cca6cc;">before</span>-<span style="color: #a6cca6cca6cc;">string</span> <span style="color: #5b8583;">'</span><span style="color: #b0668cf47099;">any</span> <span style="color: #dd8844;">(</span><span style="color: #83cc83cc83cc; text-decoration: underline;">line</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">beginning</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">position</span><span style="color: #dd8844;">)</span> <span style="color: #dd8844;">(</span><span style="color: #83cc83cc83cc; text-decoration: underline;">line</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">end</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">position</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span>
                                        <span style="color: #9a009a009a00;">car</span>
                                        <span style="color: #858253;">(</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">overlay</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">get</span> <span style="color: #fdfdd5;">it</span> <span style="color: #5b8583;">'</span><span style="color: #a6cca6cca6cc;">before</span>-<span style="color: #a6cca6cca6cc;">string</span><span style="color: #858253;">)</span>
                                        <span style="color: #858253;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">get</span><span style="text-decoration: underline;">-</span><span style="color: #78cc78cc78cc; text-decoration: underline;">text</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">property</span> <span style="color: #7ccc7ccc7ccc;">0</span> <span style="color: #5b8583;">'</span><span style="color: #9a009a009a00;">display</span> <span style="color: #fdfdd5;">it</span><span style="color: #858253;">)</span>
                                        <span style="color: #6c006c006c00;">cadr</span>
                                        <span style="color: #858253;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">s</span><span style="text-decoration: underline;">-</span><span style="color: #78cc78cc78cc; text-decoration: underline;">match</span> <span style="color: #dd8844;">(</span><span style="color: #86aed5;">rx</span> <span style="color: #a2b6da;">(</span><span style="color: #a6cca6cca6cc;">group</span> <span style="color: #9cb6ad;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">1</span><span style="text-decoration: underline;">+</span> <span style="color: #78cc78cc78cc;">digit</span><span style="color: #9cb6ad;">)</span> <span style="color: #586e75; font-weight: bold; font-style: italic;">; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">number</span>
                                                            <span style="color: #858253;">" "</span>
                                                            <span style="color: #9cb6ad;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">1</span><span style="text-decoration: underline;">+</span> <span style="color: #9aaccb;">(</span><span style="color: #cb4b16; font-weight: bold;">not</span> <span style="color: #909990999099;">blank</span><span style="color: #9aaccb;">)</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span> <span style="color: #586e75; font-weight: bold; font-style: italic;">; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">unit</span>
                                                     <span style="color: #a2b6da;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">1</span><span style="text-decoration: underline;">+</span> <span style="color: #909990999099;">blank</span><span style="color: #a2b6da;">)</span> <span style="color: #afaa9b418aed;">eos</span><span style="color: #dd8844;">)</span>
                                                 <span style="color: #fdfdd5;">it</span><span style="color: #858253;">)</span>
                                        <span style="color: #6c006c006c00;">cadr</span><span style="color: #8686ae;">)</span>
               <span style="color: #78cc78cc78cc;">do</span> <span style="color: #8686ae;">(</span><span style="color: #86aed5;">when</span> <span style="color: #858253;">(</span><span style="color: #86aed5;">and</span> <span style="color: #a6cca6cca6cc;">this</span>-<span style="color: #6c006c006c00;">age</span>
                             <span style="color: #dd8844;">(</span><span style="color: #cb4b16; font-weight: bold;">not</span> <span style="color: #a2b6da;">(</span><span style="color: #b0668cf47099; text-decoration: underline;">equal</span> <span style="color: #a6cca6cca6cc;">this</span>-<span style="color: #6c006c006c00;">age</span> <span style="color: #a6cca6cca6cc;">last</span>-<span style="color: #6c006c006c00;">age</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span>
                    <span style="color: #858253;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">ov</span> <span style="color: #dd8844;">(</span><span style="color: #83cc83cc83cc; text-decoration: underline;">line</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">beginning</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">position</span><span style="color: #dd8844;">)</span> <span style="color: #dd8844;">(</span><span style="color: #83cc83cc83cc; text-decoration: underline;">line</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">beginning</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">position</span><span style="color: #dd8844;">)</span>
                        <span style="color: #5b8583;">'</span><span style="color: #ba4cba4cba4c;">after</span>-<span style="color: #a6cca6cca6cc;">string</span> <span style="color: #dd8844;">(</span><span style="color: #a36673883b99; text-decoration: underline;">propertize</span> <span style="color: #a2b6da;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">concat</span> <span style="color: #858253;">" "</span> <span style="color: #a6cca6cca6cc;">this</span>-<span style="color: #6c006c006c00;">age</span> <span style="color: #858253;">"\n"</span><span style="color: #a2b6da;">)</span>
                                                  <span style="color: #5b8583;">'</span><span style="color: #700070007000;">face</span> <span style="color: #5b8583;">'</span><span style="color: #a36673883b99;">magit</span>-<span style="color: #6c006c006c00;">section</span>-<span style="color: #6c006c006c00;">heading</span><span style="color: #dd8844;">)</span>
                        <span style="color: #5b8583;">'</span><span style="color: #9a009a009a00;">date</span>-<span style="color: #a36673883b99;">header</span> <span style="color: #9a009a009a00;">t</span><span style="color: #858253;">)</span>
                    <span style="color: #858253;">(</span><span style="color: #86aed5;">setq</span> <span style="color: #a6cca6cca6cc;">last</span>-<span style="color: #6c006c006c00;">age</span> <span style="color: #a6cca6cca6cc;">this</span>-<span style="color: #6c006c006c00;">age</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span>
               <span style="color: #78cc78cc78cc;">do</span> <span style="color: #8686ae;">(</span><span style="color: #b0668cf47099; text-decoration: underline;">forward</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">line</span> <span style="color: #ba4cba4cba4c;">1</span><span style="color: #8686ae;">)</span>
               <span style="color: #83cc83cc83cc;">until</span> <span style="color: #8686ae;">(</span><span style="color: #a36673883b99; text-decoration: underline;">eobp</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span>

<span style="color: #9aaccb;">(</span><span style="color: #86aed5;">define-minor-mode</span> <span style="color: #fdfdd5;">unpackaged/magit-log-date-headers-mode</span>
  <span style="color: #52534d; font-weight: bold; font-style: italic;">"Display date/time headers in `</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">magit-log</span><span style="color: #52534d; font-weight: bold; font-style: italic;">' buffers."</span>
  <span style="color: #86aed5;">:global</span> <span style="color: #9a009a009a00;">t</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">if</span> <span style="color: #a36673883b99;">magit</span>-<span style="color: #a6cca6cca6cc;">log</span>-<span style="color: #9a009a009a00;">date</span>-<span style="color: #909990999099;">headers</span>-<span style="color: #7ccc7ccc7ccc;">mode</span>
      <span style="color: #6688aa;">(</span><span style="color: #86aed5;">progn</span>
        <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Enable mode</span>
        <span style="color: #858253;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">add</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">hook</span> <span style="color: #5b8583;">'</span><span style="color: #a36673883b99;">magit</span>-<span style="color: #9a009a009a00;">post</span>-<span style="color: #a6ffad95b400;">refresh</span>-<span style="color: #83cc83cc83cc;">hook</span> <span style="color: #5b8583;">#'</span><span style="color: #909990999099;">unpackaged</span>/<span style="color: #a36673883b99;">magit</span>-<span style="color: #a6cca6cca6cc;">log</span>--<span style="color: #ba4cba4cba4c;">add</span>-<span style="color: #9a009a009a00;">date</span>-<span style="color: #909990999099;">headers</span><span style="color: #858253;">)</span>
        <span style="color: #858253;">(</span><span style="color: #6c006c006c00; text-decoration: underline;">advice</span><span style="text-decoration: underline;">-</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">add</span> <span style="color: #5b8583;">#'</span><span style="color: #a36673883b99;">magit</span>-<span style="color: #7ccc7ccc7ccc;">mode</span>-<span style="color: #78cc78cc78cc;">setup</span> <span style="color: #86aed5;">:after</span> <span style="color: #5b8583;">#'</span><span style="color: #909990999099;">unpackaged</span>/<span style="color: #a36673883b99;">magit</span>-<span style="color: #a6cca6cca6cc;">log</span>--<span style="color: #ba4cba4cba4c;">add</span>-<span style="color: #9a009a009a00;">date</span>-<span style="color: #909990999099;">headers</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span>
    <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Disable mode</span>
    <span style="color: #6688aa;">(</span><span style="color: #909990999099; text-decoration: underline;">remove</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">hook</span> <span style="color: #5b8583;">'</span><span style="color: #a36673883b99;">magit</span>-<span style="color: #9a009a009a00;">post</span>-<span style="color: #a6ffad95b400;">refresh</span>-<span style="color: #83cc83cc83cc;">hook</span> <span style="color: #5b8583;">#'</span><span style="color: #909990999099;">unpackaged</span>/<span style="color: #a36673883b99;">magit</span>-<span style="color: #a6cca6cca6cc;">log</span>--<span style="color: #ba4cba4cba4c;">add</span>-<span style="color: #9a009a009a00;">date</span>-<span style="color: #909990999099;">headers</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #6c006c006c00; text-decoration: underline;">advice</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">remove</span> <span style="color: #5b8583;">#'</span><span style="color: #a36673883b99;">magit</span>-<span style="color: #7ccc7ccc7ccc;">mode</span>-<span style="color: #78cc78cc78cc;">setup</span> <span style="color: #5b8583;">#'</span><span style="color: #909990999099;">unpackaged</span>/<span style="color: #a36673883b99;">magit</span>-<span style="color: #a6cca6cca6cc;">log</span>--<span style="color: #ba4cba4cba4c;">add</span>-<span style="color: #9a009a009a00;">date</span>-<span style="color: #909990999099;">headers</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span>
</pre>
</div>

<p>
This isn't always perfect, because dates in a git commit log are not always in order (e.g. when commits are merged at a later date), but it's often very helpful to visually group commits by their age.
</p>
</div>
</div>
</div>

<div id="outline-container-org4e7db72" class="outline-3">
<h3 id="org4e7db72"><a id="ID-9d6983a6-3765-45c2-a140-34c23f381361"></a><code>smerge-mode</code></h3>
<div class="outline-text-3" id="text-org4e7db72">
</div>
<div id="outline-container-orge21f20f" class="outline-4">
<h4 id="orge21f20f">Hydra</h4>
<div class="outline-text-4" id="text-orge21f20f">
<p>
This configuration automatically activates a helpful <code>smerge-mode</code> hydra when a file containing merge conflicts is visited from a Magit diff section.  You can manually activate the hydra with the command <code>unpackaged/smerge-hydra/body</code>.  (Inspired by <a href="https://github.com/kaushalmodi/.emacs.d/blob/master/setup-files/setup-diff.el">Kaushal Modi's Emacs config</a>.)
</p>

<p>
<b>Requires</b>:
</p>
<ul class="org-ul">
<li><a href="https://github.com/abo-abo/hydra">hydra</a></li>
<li><a href="https://magit.vc/">Magit</a></li>
</ul>

<p>

</p>

<p>
See these screencasts comparing what it's like to resolve the conflict with and with this .
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #9aaccb;">(</span><span style="color: #86aed5;">use-package</span> <span style="color: #5b8583;">smerge-mode</span>
  <span style="color: #86aed5;">:after</span> <span style="color: #a9ba7fd34edf;">hydra</span>
  <span style="color: #86aed5;">:config</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">defhydra</span> <span style="color: #909990999099;">unpackaged</span>/<span style="color: #9a009a009a00;">smerge</span>-<span style="color: #a9ba7fd34edf;">hydra</span>
    <span style="color: #6688aa;">(</span><span style="color: #86aed5;">:color</span> <span style="color: #78cc78cc78cc;">pink</span> <span style="color: #86aed5;">:hint</span> <span style="color: #a6cca6cca6cc;">nil</span> <span style="color: #86aed5;">:post</span> <span style="color: #858253;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">smerge</span><span style="text-decoration: underline;">-</span><span style="color: #afaa9b418aed; text-decoration: underline;">auto</span><span style="text-decoration: underline;">-</span><span style="color: #83cc83cc83cc; text-decoration: underline;">leave</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span>
    <span style="color: #52534d; font-weight: bold; font-style: italic;">"</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">^Move^       ^Keep^               ^Diff^                 ^Other^</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">^^-----------^^-------------------^^---------------------^^-------</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">_n_ext       _b_ase               _&lt;_: upper/base        _C_ombine</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">_p_rev       _u_pper              _=_: upper/lower       _r_esolve</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">^^           _l_ower              _&gt;_: base/lower        _k_ill current</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">^^           _a_ll                _R_efine</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">^^           _RET_: current       _E_diff</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">"</span>
    <span style="color: #6688aa;">(</span><span style="color: #858253;">"n"</span> <span style="color: #9a009a009a00;">smerge</span>-<span style="color: #6c006c006c00;">next</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #858253;">"p"</span> <span style="color: #9a009a009a00;">smerge</span>-<span style="color: #7ccc7ccc7ccc;">prev</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #858253;">"b"</span> <span style="color: #9a009a009a00;">smerge</span>-<span style="color: #7ccc7ccc7ccc;">keep</span>-<span style="color: #700070007000;">base</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #858253;">"u"</span> <span style="color: #9a009a009a00;">smerge</span>-<span style="color: #7ccc7ccc7ccc;">keep</span>-<span style="color: #83cc83cc83cc;">upper</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #858253;">"l"</span> <span style="color: #9a009a009a00;">smerge</span>-<span style="color: #7ccc7ccc7ccc;">keep</span>-<span style="color: #b0668cf47099;">lower</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #858253;">"a"</span> <span style="color: #9a009a009a00;">smerge</span>-<span style="color: #7ccc7ccc7ccc;">keep</span>-<span style="color: #b0668cf47099;">all</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #858253;">"RET"</span> <span style="color: #9a009a009a00;">smerge</span>-<span style="color: #7ccc7ccc7ccc;">keep</span>-<span style="color: #909990999099;">current</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #858253;">"\C-m"</span> <span style="color: #9a009a009a00;">smerge</span>-<span style="color: #7ccc7ccc7ccc;">keep</span>-<span style="color: #909990999099;">current</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #858253;">"&lt;"</span> <span style="color: #9a009a009a00;">smerge</span>-<span style="color: #7ccc7ccc7ccc;">diff</span>-<span style="color: #700070007000;">base</span>-<span style="color: #83cc83cc83cc;">upper</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #858253;">"="</span> <span style="color: #9a009a009a00;">smerge</span>-<span style="color: #7ccc7ccc7ccc;">diff</span>-<span style="color: #83cc83cc83cc;">upper</span>-<span style="color: #b0668cf47099;">lower</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #858253;">"&gt;"</span> <span style="color: #9a009a009a00;">smerge</span>-<span style="color: #7ccc7ccc7ccc;">diff</span>-<span style="color: #700070007000;">base</span>-<span style="color: #b0668cf47099;">lower</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #858253;">"R"</span> <span style="color: #9a009a009a00;">smerge</span>-<span style="color: #ba4cba4cba4c;">refine</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #858253;">"E"</span> <span style="color: #9a009a009a00;">smerge</span>-<span style="color: #afaa9b418aed;">ediff</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #858253;">"C"</span> <span style="color: #9a009a009a00;">smerge</span>-<span style="color: #ba4cba4cba4c;">combine</span>-<span style="color: #a6cca6cca6cc;">with</span>-<span style="color: #6c006c006c00;">next</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #858253;">"r"</span> <span style="color: #9a009a009a00;">smerge</span>-<span style="color: #a6ffad95b400;">resolve</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #858253;">"k"</span> <span style="color: #9a009a009a00;">smerge</span>-<span style="color: #78cc78cc78cc;">kill</span>-<span style="color: #909990999099;">current</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #858253;">"ZZ"</span> <span style="color: #858253;">(</span><span style="color: #86aed5;">lambda</span> <span style="color: #8686ae;">()</span>
            <span style="color: #8686ae;">(</span><span style="color: #86aed5;">interactive</span><span style="color: #8686ae;">)</span>
            <span style="color: #8686ae;">(</span><span style="color: #b0668cf47099; text-decoration: underline;">save</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">buffer</span><span style="color: #8686ae;">)</span>
            <span style="color: #8686ae;">(</span><span style="color: #a36673883b99; text-decoration: underline;">bury</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">buffer</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
     <span style="color: #858253;">"Save and bury buffer"</span> <span style="color: #86aed5;">:color</span> <span style="color: #a9ba7fd34edf;">blue</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #858253;">"q"</span> <span style="color: #a6cca6cca6cc;">nil</span> <span style="color: #858253;">"cancel"</span> <span style="color: #86aed5;">:color</span> <span style="color: #a9ba7fd34edf;">blue</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span>
  <span style="color: #86aed5;">:hook</span> <span style="color: #5b8583;">(</span><span style="color: #a36673883b99; text-decoration: underline;">magit</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">diff</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">visit</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">file</span> . <span style="color: #6688aa;">(</span><span style="color: #86aed5;">lambda</span> <span style="color: #858253;">()</span>
                                   <span style="color: #858253;">(</span><span style="color: #86aed5;">when</span> <span style="color: #9a009a009a00;">smerge</span>-<span style="color: #7ccc7ccc7ccc;">mode</span>
                                     <span style="color: #8686ae;">(</span><span style="color: #909990999099; text-decoration: underline;">unpackaged</span><span style="text-decoration: underline;">/</span><span style="color: #9a009a009a00; text-decoration: underline;">smerge</span><span style="text-decoration: underline;">-</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">hydra</span><span style="text-decoration: underline;">/</span><span style="color: #700070007000; text-decoration: underline;">body</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span>
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org7ea7337" class="outline-2">
<h2 id="org7ea7337">Web&#xa0;&#xa0;&#xa0;<span class="tag"><span class="web">web</span></span></h2>
<div class="outline-text-2" id="text-org7ea7337">
</div><div id="outline-container-orgf046479" class="outline-3">
<h3 id="orgf046479">feed-for-url&#xa0;&#xa0;&#xa0;<span class="tag"><span class="RSS">RSS</span>&#xa0;<span class="Atom">Atom</span>&#xa0;<span class="XML">XML</span></span></h3>
<div class="outline-text-3" id="text-orgf046479">
<p>
Return ATOM or RSS feed <code>URL</code> for web page at <code>URL</code>.  Interactively, insert the <code>URL</code> at point.  <code>PREFER</code> may be <code>atom</code> (the default) or <code>rss</code>.  When <code>ALL</code> is non-nil, return all feed URLs of all types; otherwise, return only one feed <code>URL</code>, preferring the preferred type.
</p>

<p>
<b>Requires:</b>
</p>
<ul class="org-ul">
<li><a href="https://github.com/tali713/esxml">esxml</a></li>
<li><a href="https://github.com/alphapapa/org-web-tools">org-web-tools</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #9aaccb;">(</span><span style="color: #86aed5;">cl-defun</span> <span style="color: #fdfdd5;">unpackaged/feed-for-url</span> <span style="color: #5b8583;">(</span><span style="color: #7ccc7ccc7ccc;">url</span> <span style="color: #8686ae;">&amp;key</span> <span style="color: #6688aa;">(</span><span style="color: #909990999099;">prefer</span> <span style="color: #5b8583;">'</span><span style="color: #a9ba7fd34edf;">atom</span><span style="color: #6688aa;">)</span> <span style="color: #6688aa;">(</span><span style="color: #b0668cf47099;">all</span> <span style="color: #a6cca6cca6cc;">nil</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span>
  <span style="color: #52534d; font-weight: bold; font-style: italic;">"Return feed URL for web page at URL.</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">Interactively, insert the URL at point.  PREFER may be</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">`</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">atom</span><span style="color: #52534d; font-weight: bold; font-style: italic;">' (the default) or `</span><span style="color: #5b8583; font-weight: bold; font-style: italic;">rss</span><span style="color: #52534d; font-weight: bold; font-style: italic;">'.  When ALL is non-nil, return all</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">feed URLs of all types; otherwise, return only one feed URL,</span>
<span style="color: #52534d; font-weight: bold; font-style: italic;">preferring the preferred type."</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">interactive</span> <span style="color: #6688aa;">(</span><span style="color: #83cc83cc83cc; text-decoration: underline;">list</span> <span style="color: #858253;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #afaa9b418aed; text-decoration: underline;">web</span><span style="text-decoration: underline;">-</span><span style="color: #a36673883b99; text-decoration: underline;">tools</span><span style="text-decoration: underline;">--</span><span style="color: #9a009a009a00; text-decoration: underline;">get</span><span style="text-decoration: underline;">-</span><span style="color: #a36673883b99; text-decoration: underline;">first</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">url</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">require</span> <span style="color: #5b8583;">'</span><span style="color: #5b8583;">esxml-query</span><span style="color: #5b8583;">)</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">require</span> <span style="color: #5b8583;">'</span><span style="color: #5b8583;">org-web-tools</span><span style="color: #5b8583;">)</span>
  <span style="color: #5b8583;">(</span><span style="color: #86aed5;">cl-flet</span> <span style="color: #6688aa;">(</span><span style="color: #858253;">(</span><span style="color: #7ccc7ccc7ccc;">feed</span>-<span style="color: #a9ba7fd34edf;">p</span> <span style="color: #8686ae;">(</span><span style="color: #a9ba7fd34edf;">type</span><span style="color: #8686ae;">)</span>
                    <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Return t if TYPE appears to be an RSS/ATOM feed</span>
                    <span style="color: #8686ae;">(</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">string</span><span style="text-decoration: underline;">-</span><span style="color: #78cc78cc78cc; text-decoration: underline;">match</span><span style="text-decoration: underline;">-</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">p</span> <span style="color: #858253;">(</span><span style="color: #86aed5;">rx</span> <span style="color: #858253;">"application/"</span> <span style="color: #dd8844;">(</span><span style="color: #86aed5;">or</span> <span style="color: #858253;">"rss"</span> <span style="color: #858253;">"atom"</span><span style="color: #dd8844;">)</span> <span style="color: #858253;">"+xml"</span><span style="color: #858253;">)</span>
                                    <span style="color: #a9ba7fd34edf;">type</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span>
    <span style="color: #6688aa;">(</span><span style="color: #86aed5;">let*</span> <span style="color: #858253;">(</span><span style="color: #8686ae;">(</span><span style="color: #7ccc7ccc7ccc;">preferred</span>-<span style="color: #a9ba7fd34edf;">type</span> <span style="color: #858253;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">format</span> <span style="color: #858253;">"application/%s+xml"</span> <span style="color: #dd8844;">(</span><span style="color: #a6cca6cca6cc; text-decoration: underline;">symbol</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">name</span> <span style="color: #909990999099;">prefer</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span>
           <span style="color: #8686ae;">(</span><span style="color: #909990999099;">html</span> <span style="color: #858253;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">org</span><span style="text-decoration: underline;">-</span><span style="color: #afaa9b418aed; text-decoration: underline;">web</span><span style="text-decoration: underline;">-</span><span style="color: #a36673883b99; text-decoration: underline;">tools</span><span style="text-decoration: underline;">--</span><span style="color: #9a009a009a00; text-decoration: underline;">get</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">url</span> <span style="color: #7ccc7ccc7ccc;">url</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span>
           <span style="color: #8686ae;">(</span><span style="color: #9a009a009a00;">dom</span> <span style="color: #858253;">(</span><span style="color: #86aed5;">with-temp-buffer</span>
                  <span style="color: #dd8844;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">insert</span> <span style="color: #909990999099;">html</span><span style="color: #dd8844;">)</span>
                  <span style="color: #dd8844;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">libxml</span><span style="text-decoration: underline;">-</span><span style="color: #a6ffad95b400; text-decoration: underline;">parse</span><span style="text-decoration: underline;">-</span><span style="color: #909990999099; text-decoration: underline;">html</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">region</span> <span style="color: #a2b6da;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">min</span><span style="color: #a2b6da;">)</span> <span style="color: #a2b6da;">(</span><span style="color: #afaa9b418aed; text-decoration: underline;">point</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">max</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span>
           <span style="color: #8686ae;">(</span><span style="color: #a6ffad95b400;">potential</span>-<span style="color: #7ccc7ccc7ccc;">feeds</span> <span style="color: #858253;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">esxml</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">query</span><span style="text-decoration: underline;">-</span><span style="color: #b0668cf47099; text-decoration: underline;">all</span> <span style="color: #858253;">"link[rel=alternate]"</span> <span style="color: #9a009a009a00;">dom</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span>
           <span style="color: #8686ae;">(</span><span style="color: #a36673883b99;">return</span> <span style="color: #858253;">(</span><span style="color: #86aed5;">if</span> <span style="color: #b0668cf47099;">all</span>
                       <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Return all URLs</span>
                       <span style="color: #dd8844;">(</span><span style="color: #86aed5;">cl-loop</span> <span style="color: #ba4cba4cba4c;">for</span> <span style="color: #a2b6da;">(</span><span style="color: #6c006c006c00;">tag</span> <span style="color: #ba4cba4cba4c;">attrs</span><span style="color: #a2b6da;">)</span> <span style="color: #909990999099;">in</span> <span style="color: #a6ffad95b400;">potential</span>-<span style="color: #7ccc7ccc7ccc;">feeds</span>
                                <span style="color: #a6cca6cca6cc;">when</span> <span style="color: #a2b6da;">(</span><span style="color: #7ccc7ccc7ccc;">feed</span>-<span style="color: #a9ba7fd34edf;">p</span> <span style="color: #9cb6ad;">(</span><span style="color: #b0668cf47099; text-decoration: underline;">alist</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">get</span> <span style="color: #5b8583;">'</span><span style="color: #a9ba7fd34edf;">type</span> <span style="color: #ba4cba4cba4c;">attrs</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span>
                                <span style="color: #a6cca6cca6cc;">collect</span> <span style="color: #a2b6da;">(</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">url</span><span style="text-decoration: underline;">-</span><span style="color: #78cc78cc78cc; text-decoration: underline;">expand</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">file</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">name</span> <span style="color: #9cb6ad;">(</span><span style="color: #b0668cf47099; text-decoration: underline;">alist</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">get</span> <span style="color: #5b8583;">'</span><span style="color: #7ccc7ccc7ccc;">href</span> <span style="color: #ba4cba4cba4c;">attrs</span><span style="color: #9cb6ad;">)</span> <span style="color: #7ccc7ccc7ccc;">url</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span>
                     <span style="color: #dd8844;">(</span><span style="color: #86aed5;">or</span>
                      <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Return the first URL of preferred type</span>
                      <span style="color: #a2b6da;">(</span><span style="color: #86aed5;">cl-loop</span> <span style="color: #ba4cba4cba4c;">for</span> <span style="color: #9cb6ad;">(</span><span style="color: #6c006c006c00;">tag</span> <span style="color: #ba4cba4cba4c;">attrs</span><span style="color: #9cb6ad;">)</span> <span style="color: #909990999099;">in</span> <span style="color: #a6ffad95b400;">potential</span>-<span style="color: #7ccc7ccc7ccc;">feeds</span>
                               <span style="color: #a6cca6cca6cc;">when</span> <span style="color: #9cb6ad;">(</span><span style="color: #b0668cf47099; text-decoration: underline;">equal</span> <span style="color: #7ccc7ccc7ccc;">preferred</span>-<span style="color: #a9ba7fd34edf;">type</span> <span style="color: #9aaccb;">(</span><span style="color: #b0668cf47099; text-decoration: underline;">alist</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">get</span> <span style="color: #5b8583;">'</span><span style="color: #a9ba7fd34edf;">type</span> <span style="color: #ba4cba4cba4c;">attrs</span><span style="color: #9aaccb;">)</span><span style="color: #9cb6ad;">)</span>
                               <span style="color: #a36673883b99;">return</span> <span style="color: #9cb6ad;">(</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">url</span><span style="text-decoration: underline;">-</span><span style="color: #78cc78cc78cc; text-decoration: underline;">expand</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">file</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">name</span> <span style="color: #9aaccb;">(</span><span style="color: #b0668cf47099; text-decoration: underline;">alist</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">get</span> <span style="color: #5b8583;">'</span><span style="color: #7ccc7ccc7ccc;">href</span> <span style="color: #ba4cba4cba4c;">attrs</span><span style="color: #9aaccb;">)</span> <span style="color: #7ccc7ccc7ccc;">url</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span>
                      <span style="color: #586e75; font-weight: bold; font-style: italic;">;; </span><span style="color: #586e75; font-weight: bold; font-style: italic;">Return the first URL of non-preferred type</span>
                      <span style="color: #a2b6da;">(</span><span style="color: #86aed5;">cl-loop</span> <span style="color: #ba4cba4cba4c;">for</span> <span style="color: #9cb6ad;">(</span><span style="color: #6c006c006c00;">tag</span> <span style="color: #ba4cba4cba4c;">attrs</span><span style="color: #9cb6ad;">)</span> <span style="color: #909990999099;">in</span> <span style="color: #a6ffad95b400;">potential</span>-<span style="color: #7ccc7ccc7ccc;">feeds</span>
                               <span style="color: #a6cca6cca6cc;">when</span> <span style="color: #9cb6ad;">(</span><span style="color: #7ccc7ccc7ccc;">feed</span>-<span style="color: #a9ba7fd34edf;">p</span> <span style="color: #9aaccb;">(</span><span style="color: #b0668cf47099; text-decoration: underline;">alist</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">get</span> <span style="color: #5b8583;">'</span><span style="color: #a9ba7fd34edf;">type</span> <span style="color: #ba4cba4cba4c;">attrs</span><span style="color: #9aaccb;">)</span><span style="color: #9cb6ad;">)</span>
                               <span style="color: #a36673883b99;">return</span> <span style="color: #9cb6ad;">(</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">url</span><span style="text-decoration: underline;">-</span><span style="color: #78cc78cc78cc; text-decoration: underline;">expand</span><span style="text-decoration: underline;">-</span><span style="color: #6c006c006c00; text-decoration: underline;">file</span><span style="text-decoration: underline;">-</span><span style="color: #7ccc7ccc7ccc; text-decoration: underline;">name</span> <span style="color: #9aaccb;">(</span><span style="color: #b0668cf47099; text-decoration: underline;">alist</span><span style="text-decoration: underline;">-</span><span style="color: #9a009a009a00; text-decoration: underline;">get</span> <span style="color: #5b8583;">'</span><span style="color: #7ccc7ccc7ccc;">href</span> <span style="color: #ba4cba4cba4c;">attrs</span><span style="color: #9aaccb;">)</span> <span style="color: #7ccc7ccc7ccc;">url</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #dd8844;">)</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span><span style="color: #858253;">)</span>
      <span style="color: #858253;">(</span><span style="color: #86aed5;">if</span> <span style="color: #8686ae;">(</span><span style="color: #909990999099; text-decoration: underline;">called</span><span style="text-decoration: underline;">-</span><span style="color: #afaa9b418aed; text-decoration: underline;">interactively</span><span style="text-decoration: underline;">-</span><span style="color: #a9ba7fd34edf; text-decoration: underline;">p</span><span style="color: #8686ae;">)</span>
          <span style="color: #8686ae;">(</span><span style="color: #ba4cba4cba4c; text-decoration: underline;">insert</span> <span style="color: #858253;">(</span><span style="color: #86aed5;">if</span> <span style="color: #dd8844;">(</span><span style="color: #9a009a009a00; text-decoration: underline;">listp</span> <span style="color: #a36673883b99;">return</span><span style="color: #dd8844;">)</span>
                      <span style="color: #dd8844;">(</span><span style="color: #a6ffad95b400; text-decoration: underline;">s</span><span style="text-decoration: underline;">-</span><span style="color: #700070007000; text-decoration: underline;">join</span> <span style="color: #858253;">" "</span> <span style="color: #a36673883b99;">return</span><span style="color: #dd8844;">)</span>
                    <span style="color: #a36673883b99;">return</span><span style="color: #858253;">)</span><span style="color: #8686ae;">)</span>
        <span style="color: #a36673883b99;">return</span><span style="color: #858253;">)</span><span style="color: #6688aa;">)</span><span style="color: #5b8583;">)</span><span style="color: #9aaccb;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org7e9d2a5" class="outline-2">
<h2 id="org7e9d2a5">License</h2>
<div class="outline-text-2" id="text-org7e9d2a5">
<p>
GPLv3
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Adam Porter</p>
<p class="date">Created: 2019-01-04 Fri 00:13</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
